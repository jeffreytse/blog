<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://markchenyutian.github.io//blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://markchenyutian.github.io//blog/" rel="alternate" type="text/html" /><updated>2022-05-06T21:35:21+00:00</updated><id>https://markchenyutian.github.io//blog/feed.xml</id><title type="html">Yutianâ€™s Blog</title><subtitle>Where I Learn, Create and Share with everyone. </subtitle><author><name>Yutian (Mark) Chen</name></author><entry><title type="html">A* Search and its Variants</title><link href="https://markchenyutian.github.io//blog/2022/Multi-heuristic-Astar.html" rel="alternate" type="text/html" title="A* Search and its Variants" /><published>2022-04-20T00:00:00+00:00</published><updated>2022-04-20T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2022/Multi-heuristic-Astar</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2022/Multi-heuristic-Astar.html"><![CDATA[<p>Let $g(s)$ denote the cost of a least-cost path from $s_{start}$ to $s$, we then have
$$
g(s) = \min_{sâ€™\in pred(s)}{(g(sâ€™) + c(sâ€™, s))}
$$
That is, the minimum cost from $s_{start}$ to $s$ equals to the min cost to get to the predecessor of $s$ (a.k.a. $sâ€™$ in the formula above) add the actual cost from $sâ€™$ to $s$.</p>

<h2 id="a-search">A* Search</h2>

<blockquote>
  <p>:package: A* Search is guaranteed to <strong>Return an optimal path</strong></p>

  <p>Perform <strong>minimal number of state expansions</strong> required to guarantee optimality.</p>
</blockquote>

<p>The predicted cost to get from $s_{start}$ to $s_{goal}$ through state $s$ can be estimated through
$$
f(s_{start}, s, s_{goal}) = g(s_{start}, s) + h(s, s_{goal})
$$
$g$ represents the <strong>actual</strong> minimum cost of getting to $s$ from the starting state. $h$ represents a <strong>heuristic estimation</strong> of cost to get to $s_{goal}$ from $s$.</p>

<h3 id="requirement-of-heuristic-function">Requirement of Heuristic Function</h3>

<p>Heuristic function must be</p>

<p><strong>Admissible</strong> - The heuristic function must <em>underestimate / accurately predict the cost</em>.
$$
h(s) \leq \min{c(s, s_{goal})}
$$
<strong>Consistent</strong> - the function $h$ should satisfy the triangle inequality.
$$
h(s_{goal}, s_{goal}) = 0,\quad h(S) \leq c(s, sâ€™) + h(sâ€™)
$$</p>

<p><mark>A consistent heuristic function $h$ must be admissible.</mark></p>

<h2 id="multi-goal-a-search-with-imaginary-goal-state">Multi-goal A* Search (With Imaginary Goal State)</h2>

<p>When there are multiple goals, we can construct an <em>imaginary goal</em> in the graph that connects all goals.</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_C066319B49CB-1.jpeg" alt="IMG_C066319B49CB-1" /></p>

<p>If goals have different weights (we have preference to certain goal over others), we can adjust the weights of edge between each goal state to <code class="language-plaintext highlighter-rouge">Imaginary Goal</code> state.</p>

<h2 id="weighted-a-search">Weighted A* Search</h2>

<blockquote>
  <p>:package: The weighted A* allow us to get sub-optimal result with less state expansion, which consumes less memory and computation time.</p>
</blockquote>

<p>The scale of explored nodes in A* search is much smaller than in the dijkastra algorithm. This is because $f(s) = h(s) + g(s)$ provides two constraints on the nodes to explore.</p>

<p>However, for high dimensional graph, the algorithm will soon out of memory. We need some stronger constraint to the expansion of nodes. <strong>Weighted A*</strong>, is one of the algorithm that apply a stronger constraint on expansion, with the cost of losing optimality of A* search.</p>

<p>Instead of using $f(s) = h(s) + g(s)$, the weighted A* puts a weight $\epsilon$ on heuristic function
$$
f(s) = g(s) + \epsilon h(s)
$$
This will make the algorithm has more <strong>bias towards states that are closer to goal.</strong></p>

<p><strong>Definition ($\varepsilon$-suboptimal)</strong> $cost(solution) \leq \varepsilon\cdot cost(optimal\;solution)$</p>

<h2 id="common-heuristic-functions">Common Heuristic Functions</h2>

<table>
  <thead>
    <tr>
      <th>Heuristic Function</th>
      <th>Equation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Euclidean Distance</td>
      <td>$h(x, y) = \sqrt{(x - x_{goal})^2 + (y - y_{goal})^2}$</td>
    </tr>
    <tr>
      <td>Manhattan Distance</td>
      <td>$h(x, y) = abs(x - x_{goal}) + abs(y - y_{goal})$</td>
    </tr>
    <tr>
      <td>Diagonal Distance</td>
      <td>$h(x, y) = max(abs(x - x_{goal}), abs(y - y_{goal}))$</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>These heuristic functions are both <strong>consistent</strong> and <strong>admissible</strong>.</p>
</blockquote>

<hr />

<h2 id="zap-useful-properties-of-heuristic-functions">:zap: Useful Properties of Heuristic Functions</h2>

<ol>
  <li>
    <p>If $h_1(s)$, $h_2(s)$ are consistent, then - $h(s) = \max(h_1(s), h_2(s))$ is also consistent.</p>
  </li>
  <li>
    <p>If A* uses $\varepsilon$-consistent heuristics
 $$
 \forall s\neq s_{goal}\quad h(s_{goal}) = 0 \wedge h(s) \leq \varepsilon c(s, succ(s)) + h(succ(s))
 $$
 then A* is $\varepsilon$-suboptimal
 $$
 Cost(solution) \leq \varepsilon \cdot Cost(optimal\;solution)
 $$</p>
  </li>
  <li>
    <p>Weighted A* with $f(s) = g(s) + \varepsilon h(s)$ is A* with $\varepsilon$ -consistent heuristics.</p>
  </li>
  <li>
    <p>$h_1(s)$, $h_2(s)$ are both consistent, then $h_1(s) + h_2(s)$ is $\varepsilon$-consistent.</p>

    <p>:question: what is $\varepsilon$ here? There is no such variable in the $h_1$ and $h_2$â€¦</p>
  </li>
</ol>

<h2 id="why-we-need-multiple-heuristic">Why we Need Multiple Heuristic?</h2>

<blockquote>
  <p>:package: Can we use a bunch of <strong>inadmissible heuristics simultaneously</strong> while preserving guarantees on completeness and bounded sub-optimality?</p>
</blockquote>

<p>To solve real-world problem with high DoF robots, we need to use a series of <strong>arbitrary, inadmissible</strong> heuristic functions! How can we reach this result â€¦? :drum::drum::drum: <strong><em>Multi-heuristic A*!</em></strong></p>

<p><strong>Why not taking <code class="language-plaintext highlighter-rouge">max</code> directly?</strong></p>

<ol>
  <li>Information is lost when using <code class="language-plaintext highlighter-rouge">max</code> function</li>
  <li>Creates local minima inside the search space</li>
  <li>Requires all heuristics to be admissible :arrow_left: <em>this is a real problem</em></li>
</ol>

<h2 id="multi-heuristic-a-search">Multi-Heuristic A* Search</h2>

<h3 id="version-1---parallel-a">Version 1 - Parallel A*</h3>

<p>Run $N$ independent, inadmissible A* searches. If one of them find the solution, then the whole algorithm finds the solution.</p>

<h3 id="version-2---shared-a-search">Version 2 - Shared A* Search</h3>

<p>Share information between searches</p>

<blockquote>
  <p>Share the <code class="language-plaintext highlighter-rouge">Open</code> and <code class="language-plaintext highlighter-rouge">Closed</code> between algorithms. When one search algorithm adds a node into <code class="language-plaintext highlighter-rouge">Open</code>, add to other algorithmâ€™s <code class="language-plaintext highlighter-rouge">Open</code> as well.</p>
</blockquote>

<p>Such shared information have several advantages:</p>

<ol>
  <li>Different inadmissive A* search algorithms can <em>help each other</em> to get out the local minimas.</li>
  <li>Since the <code class="language-plaintext highlighter-rouge">Closed</code> are also shared between algorithms, states are expanded at most <strong>once</strong> across ALL searches</li>
</ol>

<p>Yet, there are still some problems:</p>

<ol>
  <li>No completeness guarantees or bounds on solution quality.</li>
</ol>

<h3 id="version-3---anchor-search">Version 3 - Anchor Search</h3>

<p>Search with admissible heuristic function to <strong>control expansions</strong>.</p>

<blockquote>
  <p>:package: In this way, the algorithm is <strong>complete</strong> and <strong>provide bounds on solution quality</strong>.</p>
</blockquote>

<p>The A* that use admissible heuristic function is called <code class="language-plaintext highlighter-rouge">Anchor Search</code>.</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/Screen%20Shot%202022-03-15%20at%2022.49.22.png" alt="Screen Shot 2022-03-15 at 22.49.22" style="zoom: 25%;" /></p>

<p>The <code class="language-plaintext highlighter-rouge">Anchor</code> search can help ensure the completness of multi-heuristic A*.</p>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Machine Learning&quot;]" /><category term="Machine Learning" /><category term="Notes" /><summary type="html"><![CDATA[Let $g(s)$ denote the cost of a least-cost path from $s_{start}$ to $s$, we then have $$ g(s) = \min_{sâ€™\in pred(s)}{(g(sâ€™) + c(sâ€™, s))} $$ That is, the minimum cost from $s_{start}$ to $s$ equals to the min cost to get to the predecessor of $s$ (a.k.a. $sâ€™$ in the formula above) add the actual cost from $sâ€™$ to $s$.]]></summary></entry><entry><title type="html">Embeddable Clac Execution Environment</title><link href="https://markchenyutian.github.io//blog/2022/clac-embeddable.html" rel="alternate" type="text/html" title="Embeddable Clac Execution Environment" /><published>2022-04-05T00:00:00+00:00</published><updated>2022-04-05T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2022/clac-embeddable</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2022/clac-embeddable.html"><![CDATA[<h2 id="demo">Demo</h2>

<p>An open-to-use, embeddable clac execution implemented with <code class="language-plaintext highlighter-rouge">React</code> and <code class="language-plaintext highlighter-rouge">TypeScript</code>. You can try it below!</p>

<p>For example, try to input the instruction <code class="language-plaintext highlighter-rouge">: square 1 pick * ; 2 square print</code> into the wedget below and see what will happen!</p>

<div id="claculator-interactive" data-mode="embeddable"></div>

<h2 id="about-this-project">About This Project</h2>

<p>This is an attempt to build interactive web-based runtimes of a toy language used in <em>15-122 Principle of Imperative Computation</em>, <code class="language-plaintext highlighter-rouge">Clac</code>,  with TypeScript and React. You can find the source code at <a href="https://github.com/MarkChenYutian/TypeScript-Claculator">https://github.com/MarkChenYutian/TypeScript-Claculator</a>.</p>

<h2 id="so-cool-how-can-i-deploy-it-on-my-site">So Cool! How Can I deploy it on my site?</h2>

<p>Download the <code class="language-plaintext highlighter-rouge">index.min.js</code> file from <a href="/blog/apps/clac/index.min.js">Here</a>, link it to your webpage with</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Place this line at the end of your page --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"&lt;your-installation-dir&gt;/index.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div></div>

<p>Then, at where you want to insert the widget, insert this line:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"claculator-interactive"</span> <span class="na">data-mode=</span><span class="s">"embeddable"</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div></div>

<h2 id="about-the-clac-language">About The Clac Language</h2>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/Screen%20Shot%202022-04-05%20at%2021.10.44.png" alt="Screen Shot 2022-04-05 at 21.10.44" /></p>

<p>Notes*:</p>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">print</code> token causes ğ‘›n to be printed, followed by a newline.</li>
  <li>The <code class="language-plaintext highlighter-rouge">quit</code> token causes the interpreter to stop.</li>
  <li>This is a 32 bit, twoâ€™s complement language, so addition, subtraction, multiplication, and exponentiation should behave just as in C0 without raising any overflow errors.</li>
  <li>Division or modulus by 0, or division/modulus of <code class="language-plaintext highlighter-rouge">int_min()</code> by -1, which would result in an arithmetic error according to the definition of C0 (see page 4 of the <a href="https://c0.cs.cmu.edu/docs/c0-reference.pdf">C0 Reference</a>), should raise an error in Clac. Negative exponents are undefined and should also raise an error.</li>
  <li>The <code class="language-plaintext highlighter-rouge">pick</code> token should raise an error if ğ‘›n, the value on the top of the stack, is not strictly positive. The <code class="language-plaintext highlighter-rouge">skip</code> token should raise an error if ğ‘›n is negative; 0 is acceptable.</li>
</ol>

<p><strong>* Notes of Notes: Since we are implementing its core with <code class="language-plaintext highlighter-rouge">JavaScript</code>, some specific numerical calculation may not match the original, <code class="language-plaintext highlighter-rouge">C0</code> versionâ€™s result.</strong></p>

<script src="/blog/apps/clac/index.min.js"></script>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Frontend&quot;]" /><category term="Web" /><category term="React" /><summary type="html"><![CDATA[Demo]]></summary></entry><entry><title type="html">How to Type LaTeX Fast &amp;amp; Elegant - A Guide from &amp;amp; for Beginner</title><link href="https://markchenyutian.github.io//blog/2022/type-LaTeX-fast.html" rel="alternate" type="text/html" title="How to Type LaTeX Fast &amp;amp; Elegant - A Guide from &amp;amp; for Beginner" /><published>2022-02-16T00:00:00+00:00</published><updated>2022-02-16T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2022/type-LaTeX-fast</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2022/type-LaTeX-fast.html"><![CDATA[<h2 id="1-ç”¨-latex-è€Œä¸æ˜¯ä¸-latex-ææ–—">1 ç”¨ LaTeX, è€Œä¸æ˜¯ä¸ LaTeX ææ–—</h2>

<blockquote>
  <p>LaTeX çš„è®¾è®¡å“²å­¦æ˜¯ï¼šè®©ä½¿ç”¨è€…ä»˜å‡ºæœ€å°‘çš„åŠªåŠ›å°±èƒ½å¾—åˆ°å·¥æ•´ç¾è§‚çš„æ’ç‰ˆ</p>
</blockquote>

<p>ç„¶è€Œï¼Œè®½åˆºçš„æ˜¯ï¼Œå¤§éƒ¨åˆ†äººï¼ˆè‡³å°‘ä¸€å¼€å§‹ï¼‰çš„ä½“éªŒä¼¼ä¹éƒ½ä¸è¿™ä¸ªè®¾è®¡å“²å­¦æ­£å¥½ç›¸åã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬éƒ½ä¹ æƒ¯äº†ä½¿ç”¨ Word è¿™æ ·â€œæ‰€è§å³æ‰€å¾—â€çš„æ’ç‰ˆè½¯ä»¶/æ–‡å­—ç¼–è¾‘å™¨ã€‚å½“æˆ‘ä»¬æŒ‰ä¸‹ç©ºæ ¼çš„æ—¶å€™ï¼Œå±å¹•ä¸Šå°±ä¸€å®šä¼šå‡ºç°ä¸€ä¸ªç©ºæ ¼ã€‚</p>

<p>åœ¨ LaTeX ä¸­ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯â€œç¼–è¾‘ - ç¼–è¯‘ - æ’ç‰ˆâ€çš„æµç¨‹ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´è§‚çš„ç«‹åˆ»çœ‹åˆ°æˆ‘ä»¬åœ¨<code class="language-plaintext highlighter-rouge">TeX</code>æ–‡ä»¶ä¸­åšå‡ºçš„æ”¹å˜ã€‚å½“æˆ‘ä»¬åœ¨å•è¯ä¹‹é—´è¾“å…¥å¥½å‡ ä¸ªç©ºæ ¼å´å‘ç°æ’ç‰ˆç»“æœä¸­åªæœ‰ä¸€ä¸ªç©ºæ ¼æ—¶ï¼Œè‡ªç„¶ä¼šæ„Ÿè§‰éå¸¸å¥‡æ€ªå’Œä¸é€‚åº”ã€‚</p>

<blockquote>
  <p>å®é™…ä¸Šï¼Œå¾ˆå¤šæ—¶å€™åœ¨ä½¿ç”¨ LaTeX æ—¶å¦‚æœå‘ç°æ‰“èµ·æ¥éå¸¸éº»çƒ¦/ç»“æœç‰¹åˆ«ä¸‘ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯æˆ‘ä»¬åœ¨ä½œèŒ§è‡ªç¼šï¼Œä¸‹é¢ä¸¾å‡ ä¸ªå¸¸è§çš„ä¾‹å­ ï¼ˆç‚¹å‡»å±•å¼€ï¼‰ï¼š</p>
</blockquote>

<ol>
  <li>
    <details>
      <summary>
        <p><strong>é€šè¿‡ <code class="language-plaintext highlighter-rouge">//</code> æˆ–è€… <code class="language-plaintext highlighter-rouge">\newline</code> æ¥æ‰“â€œå›è½¦â€ï¼ŒæŠ±æ€¨è¡Œå’Œè¡Œéƒ½â€œæŒ¤åœ¨ä¸€èµ·â€</strong></p>
      </summary>

      <p>åœ¨ LaTeX ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">//</code> ä»£è¡¨â€œæ–­è¡Œâ€ - ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹ä¸€è¡Œçš„å†…å®¹ä¸å½“å‰åœ¨åŒä¸€æ®µä¸­ï¼Œä½†æ˜¯å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡æ¢è¡Œã€‚æ‰€ä»¥ LaTeX ä¸ä¼šåœ¨è¿™ä¸¤è¡Œä¹‹é—´æ·»åŠ é¢å¤–çš„ç©ºä½ã€‚</p>

      <p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å°†ä¸€æ•´æ®µè¯è¿ç»­çš„å†™åœ¨åŒä¸€è¡Œä¸­ã€‚LaTeX ä¼šè‡ªåŠ¨æ ¹æ®é¡µé¢å®½åº¦å¤„ç†æ¢è¡Œé—®é¢˜ã€‚å¦‚æœä½ éœ€è¦å¼€å¯ä¸€ä¸ªæ–°çš„æ®µè½ï¼Œåœ¨è¡Œå’Œè¡Œä¹‹é—´æ·»åŠ ä¸€ä¸ªç©ºè¡Œå³å¯ã€‚</p>

      <p>æ­£ç¡®çš„æ®µè½ï¼š</p>

      <blockquote>
        <pre><code class="tex"> [Paragraph 1] , random text with correct paragraph Pellentesque interdum sapien sed nulla. Proin tincidunt. 
Aliquam volutpat est vel massa. Sed dolor lacus, imperdiet non, ornare non, commodo eu, neque. Integer pretium semper justo. Proin risus. Nullam id quam. Nam neque. 

[Paragraph 2] , random text with correct paragraph Duis vitae wisi ullamcorper diam congue ultricies. Quisque ligula. Mauris vehicula.</code></pre>
        <p><img src="https://markdown-img-1304853431.file.myqcloud.com/Screen Shot 2022-02-17 at 12.51.14 AM.png" alt="Screen Shot 2022-02-17 at 12.51.14 AM" /></p>
      </blockquote>

      <p>é”™è¯¯çš„æ®µè½ï¼ˆç”¨æ–­è¡Œï¼Œè€Œä¸æ˜¯æ–°æ®µè½ï¼‰ï¼š</p>

      <blockquote>
        <pre><code class="tex"> \textbf{[Paragraph 1]} , random text with line break Pellentesque interdum sapien sed nulla. Proin tincidunt. 
Aliquam volutpat est vel massa. Sed dolor lacus, imperdiet non, ornare non, commodo eu, neque. Integer pretium semper justo. Proin risus. Nullam id quam. Nam neque. \\
\textbf{[Paragraph 2]} , random text with line break Duis vitae wisi ullamcorper diam congue ultricies. Quisque ligula. Mauris vehicula.</code></pre>
        <p><img src="https://markdown-img-1304853431.file.myqcloud.com/20220217005251.png" alt="20220217005251" />
ç»å…¸é”™ä¸ŠåŠ é”™ï¼šåœ¨æ–­è¡Œçš„åŸºç¡€ä¸Šå¼ºè¡Œç”¨ <code class="language-plaintext highlighter-rouge">\vspace</code> ç­‰æŒ‡ä»¤æ‹‰å¤§è¡Œä¹‹é—´çš„ç©ºç™½ï¼Œè¥é€ ä¸€ç§â€œåˆ†æ®µâ€çš„æ„Ÿè§‰</p>
      </blockquote>
    </details>
  </li>
  <li>
    <details>
      <summary>
        <p><strong>é€šè¿‡ <code class="language-plaintext highlighter-rouge">$...$</code> å†™å…¬å¼ï¼ŒæŠ±æ€¨å…¬å¼éƒ½å †åˆ°å·¦è¾¹ï¼Œå¹¶ä¸”æŒ¤æˆä¸€å›¢</strong></p>
      </summary>

      <p>ç”¨ <code class="language-plaintext highlighter-rouge">$...$</code> ç¬¦å·æ‹¬èµ·æ¥å†™çš„å…¬å¼æ˜¯â€œè¡Œå†…å…¬å¼â€ - ä¹Ÿå°±æ˜¯è¯´ï¼ŒLaTeX è®¤ä¸ºè¿™äº›å…¬å¼æ˜¯è·Ÿæ™®é€šæ–‡å­—å†™åœ¨åŒä¸€è¡Œä¸Šçš„ï¼Œæ‰€ä»¥ä¼šå°½å¯èƒ½çš„å‹ç¼©è¿™äº›å…¬å¼çš„é«˜åº¦ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨è¡Œå’Œè¡Œä¹‹é—´ç•™ä¸‹é¢å¤–çš„ç©ºä½</p>

      <blockquote>
        <p>è¡Œå†…å…¬å¼ï¼š</p>
        <pre><code class="tex">$-\frac{2a \pm \sqrt{b^2 - 4ac}}{b}$</code></pre>
        <p>ç»“æœï¼š$-\frac{2a \pm \sqrt{b^2 - 4ac}}{b}$</p>
      </blockquote>

      <p>å¦‚æœéœ€è¦æ‰“å¤§å…¬å¼ï¼Œéœ€è¦ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">$$...$$</code>ï¼ˆæˆ–è€… <code class="language-plaintext highlighter-rouge">\begin{equation}...\end{equation}</code>ï¼‰ æ‰“ä¸€ä¸ªâ€œå…¬å¼å—â€ - è¿™æ ·æ¸²æŸ“å‡ºæ¥çš„å…¬å¼ä¼šè‡ªåŠ¨å±…ä¸­å¹¶ä¸”å ç”¨ä¸€ä¸ªæ®µè½çš„ç©ºé—´</p>

      <blockquote>
        <p>å¤šè¡Œå…¬å¼ï¼š</p>

        <pre><code class="tex">\begin{equation*}
    -\frac{2a \pm \sqrt{b^2 - 4ac}}{b}
\end{equation*} </code></pre>

        <p>ç»“æœï¼š$$ -\frac{2a \pm \sqrt{b^2 - 4ac}}{b} $$</p>
      </blockquote>

      <p>å¦‚æœä½ éœ€è¦å¯¹é½å¤šè¡Œå…¬å¼ï¼ˆæ¯”å¦‚æ¨å¯¼/åŒ–ç®€é•¿å¼å­ï¼‰ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">\begin{equation}\begin{aligned}</code>â€¦<code class="language-plaintext highlighter-rouge">\end{aligned}\end{equation}</code>ã€‚</p>

      <blockquote>
        <p>å¸¦å¯¹é½çš„å¤šè¡Œå…¬å¼ï¼š</p>
        <pre><code class="tex">\begin{equation*}
    \begin{aligned}
           E[X + Y] &amp;= \sum_{j = 1}{s_j\cdot P[X + Y = s_j]}\\
                    &amp;= \sum_{j = 1}{s_j\cdot \sum_{k, l \text{ s.t. } x_k + y_l = s_j}{P[X = x_k, Y = y_l]}}\\
                    &amp;= \sum_{j}{\sum_{k, l \text{ s.t. } x_k + y_l = s_j}{(x_k + y_l)\cdot P[X = x_k, Y = y_l]}}\\
                    &amp;= \sum_{k, l}{(x_k + y_l)\cdot P[X = x_k, Y = y_l]}\\
                    &amp;= \sum_{k, l}{x_k\cdot P[X = x_k, Y = y_l]} + \sum_{k, l}{y_l\cdot P[X = x_k, Y = y_l]}\\
                    &amp;= \sum_{k}x_k \cdot \sum_{l}{P[X = x_k, Y = y_l]} + \cdots \\
                    &amp;= E[X] + E[Y]
    \end{aligned}
\end{equation*}</code></pre>
        <p>ç»“æœï¼š</p>

        <p><img src="https://markdown-img-1304853431.file.myqcloud.com/20220217124654.png" alt="20220217124654" /></p>
      </blockquote>
    </details>
  </li>
  <li>ç±»ä¼¼çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šâ€¦â€¦ æ¯”å¦‚ç–¯ç‹‚ç”¨ <code class="language-plaintext highlighter-rouge">\;</code> æ¥ä»£æ›¿wordé‡Œçš„â€œç©ºæ ¼â€ï¼Œ etc.</li>
</ol>

<p>å®é™…ä¸Šï¼Œå¯¹äºæ’ç‰ˆæ—¶é‡åˆ°çš„å¤§éƒ¨åˆ†åœºæ™¯ï¼ŒLaTeX éƒ½æœ‰æä¾›å¯¹åº”çš„æŒ‡ä»¤æˆ–ç¯å¢ƒï¼Œå¦‚æœä¸çŸ¥é“å¯¹åº”çš„æŒ‡ä»¤ç”¨ <code class="language-plaintext highlighter-rouge">\vspace</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">\;</code> æ¥ â€œè›®å¹²â€ï¼Œâ€œç¡¬å¹²â€ï¼Œç›¸å½“äºæ˜¯åœ¨å’Œ $\LaTeX$ ææ–—ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å®ƒã€‚</p>

<p>å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº›æƒ…å†µï¼Œ$\LaTeX$ è‡ªå¸¦çš„æ’ç‰ˆæ²¡æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™ç§æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥åˆ›å»ºè‡ªå·±çš„ç¯å¢ƒ/æ¨¡ç‰ˆ/æ ·å¼ï¼Œæˆ–è€…æ‰¾åˆé€‚çš„ Packageä¸templateï¼Œè€Œä¸æ˜¯å¼ºè¡Œæ‹‰æ‰¯ $\LaTeX$ æä¾›çš„é»˜è®¤æ’ç‰ˆã€‚</p>

<table>
  <thead>
    <tr>
      <th>å‘½ä»¤/ç¯å¢ƒ/è¯­æ³•</th>
      <th>è§£é‡Š</th>
      <th>æ•ˆæœ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>![20220217124421](https://markdown-img-1304853431.file.myqcloud.com/20220217124421.png)</td>
      <td>å¤šè¡Œå…¬å¼</td>
      <td>![20220217124434](https://markdown-img-1304853431.file.myqcloud.com/20220217124434.png)</td>
    </tr>
    <tr>
      <td>![20220217124547](https://markdown-img-1304853431.file.myqcloud.com/20220217124547.png)</td>
      <td>è¡Œå†…å…¬å¼</td>
      <td>![20220217124604](https://markdown-img-1304853431.file.myqcloud.com/20220217124604.png)</td>
    </tr>
    <tr>
      <td>![20220217125002](https://markdown-img-1304853431.file.myqcloud.com/20220217125002.png)</td>
      <td>å¤šè¡Œå¯¹é½å…¬å¼</td>
      <td>![Screen Shot 2022-02-17 at 12.50.19 PM](https://markdown-img-1304853431.file.myqcloud.com/Screen Shot 2022-02-17 at 12.50.19 PM.png)</td>
    </tr>
    <tr>
      <td>![20220217124317](https://markdown-img-1304853431.file.myqcloud.com/20220217124317.png)</td>
      <td>åˆ†é¡µ</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>![20220217125308](https://markdown-img-1304853431.file.myqcloud.com/20220217125308.png)</td>
      <td>æ— åºåˆ—è¡¨</td>
      <td>![20220217125319](https://markdown-img-1304853431.file.myqcloud.com/20220217125319.png)</td>
    </tr>
    <tr>
      <td>![20220217125340](https://markdown-img-1304853431.file.myqcloud.com/20220217125340.png)</td>
      <td>æœ‰åºåˆ—è¡¨</td>
      <td>![20220217125357](https://markdown-img-1304853431.file.myqcloud.com/20220217125357.png)</td>
    </tr>
    <tr>
      <td>![20220217125456](https://markdown-img-1304853431.file.myqcloud.com/20220217125456.png)</td>
      <td>æ— åºåˆ—è¡¨ï¼ˆè‡ªå®šä¹‰ç¼–å·ï¼‰</td>
      <td>![20220217125511](https://markdown-img-1304853431.file.myqcloud.com/20220217125511.png)</td>
    </tr>
  </tbody>
</table>

<h2 id="2-åˆ›å»ºå¿«æ·æŒ‡ä»¤">2 åˆ›å»ºå¿«æ·æŒ‡ä»¤</h2>

<h3 id="21-åŸºç¡€å¿«æ·æŒ‡ä»¤">2.1 åŸºç¡€å¿«æ·æŒ‡ä»¤</h3>

<p>ä½†æ˜¯è¿™åˆå¸¦æ¥äº†æ–°çš„é—®é¢˜</p>

<blockquote>
  <p>â€œæ˜¯å•Šï¼ŒLaTeX æœ‰è¿™äº›é»˜è®¤çš„æ¨¡ç‰ˆï¼Œä½†æ˜¯ç”¨èµ·æ¥éº»çƒ¦æ­»äº†ï¼Œä½ çœ‹è¾“å…¥ä¸€ä¸ªå¤šè¡Œå…¬å¼å‰å‰åååŠ èµ·æ¥è¦æ‰“å››è¡Œï¼Œå¤ªæµªè´¹æ—¶é—´äº†â€</p>
</blockquote>

<blockquote>
  <p>â€œè™½ç„¶ LaTeX æ‰“çš„å…¬å¼å¾ˆå¥½çœ‹ï¼Œä½†æ˜¯çœŸçš„å¥½éº»çƒ¦ï¼Œæ‰“ä¸€ä¸ªè‡ªç„¶æ•°çš„ç¬¦å· $\mathbb{N}$ è¦ <code class="language-plaintext highlighter-rouge">\mathbb{N}</code> è¿™ä¹ˆå¤šä¸ªå­—ç¬¦ï¼â€</p>
</blockquote>

<p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒLaTeX è‡ªç„¶ä¹Ÿæœ‰å¯¹åº”çš„è§£å†³æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">\setnewcommand</code> å‘½ä»¤ä¸ºè‡ªå·±å¸¸ç”¨çš„ç¬¦å·è®¾ç½®â€œå¿«æ·é”®â€ã€‚æ¯”å¦‚ä¸‹é¢çš„<code class="language-plaintext highlighter-rouge">TeX</code>æŒ‡ä»¤å…è®¸æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„ LaTeX ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">\N</code> æ›¿ä»£ <code class="language-plaintext highlighter-rouge">\mathbb{N}</code>ã€‚</p>

<div class="language-tex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\newcommand</span><span class="p">{</span><span class="k">\N</span><span class="p">}</span>[0]<span class="p">{</span><span class="k">\mathbb</span><span class="p">{</span>N<span class="p">}}</span>
</code></pre></div></div>

<p>å®é™…ä¸Šï¼Œä½ å¯ä»¥å°†ä»»ä½•å¸¸ç”¨ï¼Œä½†æ˜¯å¾ˆéº»çƒ¦çš„æŒ‡ä»¤ç”¨è¿™ç§å¿«æ·é”®çš„å½¢å¼ç®€åŒ–ï¼Œåˆ›å»ºå¿«æ·é”®çš„è¯­æ³•æ˜¯</p>

<div class="language-tex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\newcommand</span><span class="p">{</span>ä½ æƒ³ç”¨çš„å¿«æ·æŒ‡ä»¤<span class="p">}</span>[0]<span class="p">{</span>å®é™…ä¸Šçš„å¤æ‚é•¿æŒ‡ä»¤<span class="p">}</span>
</code></pre></div></div>

<div class="notification">
  <p>æ³¨æ„ï¼šè¿™äº›å‘½ä»¤åº”è¯¥æ”¾åœ¨ <code class="language-plaintext highlighter-rouge">\begin{document}</code> å‰ï¼Œ <code class="language-plaintext highlighter-rouge">\usepackage{...}</code> åçš„ä½ç½®</p>
</div>

<div class="notification">
  <p>:warning: æ¯æ–°å»ºå®Œä¸€ä¸ªæŒ‡ä»¤ä»¥åï¼Œæœ€å¥½<strong>é©¬ä¸Šå°è¯•é‡æ–°ç¼–è¯‘ä¸€ä¸‹æ–‡ä»¶</strong>ï¼Œå› ä¸ºæœ‰æ—¶å€™æ–°åˆ›å»ºçš„å¿«æ·é”®ä¼šå’Œ LaTeX åŸæœ‰æŒ‡ä»¤å†²çªï¼Œè¿™ç§æ—¶å€™å°±ä¼šå‡ºç°ä¸€äº›å¥‡æ€ªçš„ç¼–è¯‘é”™è¯¯ã€‚ï¼ˆæ¯”å¦‚ <code class="language-plaintext highlighter-rouge">\and</code> å°±æ˜¯ä¸€ä¸ªTeXçš„å…³é”®å­—ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¹–ä¹–æ‰“ <code class="language-plaintext highlighter-rouge">\wedge</code> å§ï¼ˆç‹—å¤´ï¼‰ï¼‰</p>
</div>

<h3 id="22-å¸¦å‚æ•°çš„å¿«æ·æŒ‡ä»¤">2.2 å¸¦å‚æ•°çš„å¿«æ·æŒ‡ä»¤</h3>

<p>ä½¿ç”¨ä¸€äº›å…¶å®ƒå‘½ä»¤ï¼Œä½ è¿˜å¯ä»¥åˆ›å»ºæœ‰å‚æ•°ï¼ˆç”šè‡³å¯ä»¥è®¾å®šå¯é€‰å‚æ•°å’Œå…¶ç¼ºçœå€¼ï¼‰çš„å¿«æ·æŒ‡ä»¤ã€‚æ¯”å¦‚ä¸‹é¢çš„ TeX å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªå« <code class="language-plaintext highlighter-rouge">\pic</code> çš„å¿«æ·æŒ‡ä»¤</p>

<div class="language-tex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="p">{</span>xparse<span class="p">}</span>   <span class="c">% è¿™ä¸ªåŒ…è®©æˆ‘ä»¬èƒ½å¤Ÿç”Ÿæˆå¸¦â€œå¯é€‰å‚æ•°â€çš„å¿«æ·æŒ‡ä»¤</span>
<span class="c">% ...</span>
<span class="k">\NewDocumentCommand</span><span class="p">{</span><span class="k">\pic</span><span class="p">}{</span> O<span class="p">{</span><span class="k">\textwidth</span><span class="p">}</span> m <span class="p">}</span>    <span class="c">% O = å¯é€‰å‚æ•°ï¼Œå¤§æ‹¬å·å†…ä¸ºç¼ºçœå€¼ï¼Œm = å¿…é¡»å‚æ•°</span>
<span class="p">{</span>
  <span class="nt">\begin{center}</span>
    <span class="nt">\begin{figure}</span>[ht]
      <span class="k">\centering\includegraphics</span><span class="na">[width=#1]</span><span class="p">{</span>assets/#2<span class="p">}</span>   <span class="c">% å°†å‚æ•°1å¡«åˆ° #1 çš„ä½ç½®ï¼Œå‚æ•°2å¡«åˆ° #2 çš„ä½ç½®</span>
    <span class="nt">\end{figure}</span>
  <span class="nt">\end{center}</span><span class="k">\FloatBarrier</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨è¿™ä¸ªå®šä¹‰ä¹‹å‰ï¼Œåœ¨ LaTeX ä¸­æ’å…¥ä¸é¡µé¢ç­‰å®½çš„å›¾ç‰‡ <code class="language-plaintext highlighter-rouge">assets/1.jpeg</code> è¦ç”¨è¿™ä¹ˆé•¿ä¸€æ®µï¼š</p>

<div class="language-tex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{center}</span>
    <span class="nt">\begin{figure}</span>[ht]
      <span class="k">\centering\includegraphics</span><span class="na">[width=\textwidth]</span><span class="p">{</span>assets/1.jpeg<span class="p">}</span>
    <span class="nt">\end{figure}</span>
<span class="nt">\end{center}</span>
<span class="k">\FloatBarrier</span>
</code></pre></div></div>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ <code class="language-plaintext highlighter-rouge">\pic{1.jpeg}</code> å°±å¯ä»¥åšåˆ°ä¸€æ ·çš„äº‹æƒ…ã€‚å¦‚æœæˆ‘ä»¬æƒ³æŒ‡å®šå›¾ç‰‡å®½åº¦ä¸º<code class="language-plaintext highlighter-rouge">300pt</code>ï¼Œä½¿ç”¨å®šä¹‰çš„å¯é€‰å‚æ•° <code class="language-plaintext highlighter-rouge">\pic[300pt]{1.jpeg}</code> å³å¯ã€‚</p>

<h2 id="3-ä½¿ç”¨-vs-code-æ’ä»¶-latex-workshop">3 ä½¿ç”¨ VS Code æ’ä»¶ LaTeX Workshop</h2>

<div class="info">

  <p><a href="https://marketplace.visualstudio.com/items?itemName=James-Yu.latex-workshop">LaTeX Workshop æ’ä»¶é“¾æ¥</a></p>

  <p>åœ¨ VS Code ä¸Šé…ç½®å’Œä½¿ç”¨ LaTeX çš„æ–¹æ³•è¯¦è§æ’ä»¶ Latex Workshop çš„å®‰è£…è¯´æ˜</p>
</div>

<h3 id="31-åˆ›å»ºä»£ç ç‰‡æ®µ">3.1 åˆ›å»ºä»£ç ç‰‡æ®µ</h3>

<p>ä½¿ç”¨è‡ªå®šä¹‰çš„å¿«æ·æŒ‡ä»¤å¯ä»¥å¤§å¹…æé«˜å†™ LaTeX é€Ÿåº¦ï¼Œä½†æ˜¯ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§å’Œçµæ´»æ€§ï¼ˆæ¯”å¦‚ï¼Œåœ¨åˆšåˆš <code class="language-plaintext highlighter-rouge">\pic</code> çš„å‘½ä»¤ä¸­ï¼Œå¦‚æœæˆ‘æƒ³è¯»å–çš„ç…§ç‰‡ä¸åœ¨ <code class="language-plaintext highlighter-rouge">assets</code> æ–‡ä»¶å¤¹ä¸­ï¼Œå°±ä¸èƒ½ä½¿ç”¨è¿™ä¸ªå‘½ä»¤äº†ï¼‰ã€‚åŒæ—¶ï¼Œå¦‚æœåˆ«äººè¦è¯»æˆ‘çš„ <code class="language-plaintext highlighter-rouge">TeX</code> æ–‡ä»¶ï¼Œä»–çœ‹åˆ° <code class="language-plaintext highlighter-rouge">\pic</code> è¿™ä¸ªå‘½ä»¤å¯èƒ½ä¼šä¸€å¤´é›¾æ°´ï¼Œå› ä¸ºè¿™ä¸æ˜¯æ ‡å‡†æŒ‡ä»¤ã€‚</p>

<p>è¿™ç§æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ VS Code çš„ â€œCode Snippetâ€ åŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ªâ€œä»£ç æ¨¡ç‰ˆâ€ã€‚è¾“å…¥ç‰¹å®šæŒ‡ä»¤åï¼Œåœ¨è‡ªåŠ¨è¡¥å…¨é€‰é¡¹ä¸­é€‰æ‹©å¯¹åº”çš„é€‰é¡¹ï¼ŒVS Code ä¼šè‡ªåŠ¨å‘å…‰æ ‡ä½ç½®æ’å…¥é¢„åˆ¶å¥½çš„æ¨¡ç‰ˆä»£ç ã€‚è¿™æ ·ï¼Œåœ¨ä¿è¯è¾“å…¥æ•ˆç‡çš„å‰æä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å…¼å¾—çµæ´»æ€§å’Œå¯è¯»æ€§ã€‚</p>

<ol>
  <li>
    <p>è¾“å…¥è®¾ç½®å¥½çš„æ¨¡ç‰ˆç®€å†™ï¼Œåœ¨è‡ªåŠ¨è¡¥å…¨åˆ—è¡¨ä¸­é€‰ä¸­æ¨¡ç‰ˆ</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/Screen Shot 2022-02-17 at 2.04.53 AM.png" alt="Screen Shot 2022-02-17 at 2.04.53 AM" /></p>
  </li>
  <li>
    <p>æŒ‰å›è½¦ï¼Œæ¨¡ç‰ˆè¢«è‡ªåŠ¨æ’å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œå…‰æ ‡è‡ªåŠ¨ç§»åŠ¨åˆ°æŒ‡å®šçš„ä½ç½®</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/Screen Shot 2022-02-17 at 2.04.59 AM.png" alt="Screen Shot 2022-02-17 at 2.04.59 AM" /></p>
  </li>
</ol>

<p>è¦è®¾ç½®è¿™æ ·çš„æ¨¡ç‰ˆï¼Œåœ¨ VSCode æ‰“å¼€çš„ LaTeX æ–‡ä»¶å¤¹ä¸­ï¼ˆworkspaceï¼‰æ–°å»ºä¸€ä¸ªå« <code class="language-plaintext highlighter-rouge">.vscode</code> çš„æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ–°å»º <code class="language-plaintext highlighter-rouge">tex_snippet.code-snippets</code> æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨è¿™æ ·çš„æ ¼å¼ï¼ˆJSONæ ¼å¼ï¼‰ä¹¦å†™ï¼š</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
	</span><span class="nl">"Clean Equation Block"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latex"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"prefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EQ*"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"body"</span><span class="p">:[</span><span class="w">
			</span><span class="s2">"</span><span class="se">\\</span><span class="s2">begin{equation*}"</span><span class="p">,</span><span class="w">
			</span><span class="s2">"    $1"</span><span class="p">,</span><span class="w">
			</span><span class="s2">"</span><span class="se">\\</span><span class="s2">end{equation*}"</span><span class="w">
		</span><span class="p">]</span><span class="w">
	</span><span class="p">},</span><span class="w">
    </span><span class="nl">"æ–°çš„æ¨¡ç‰ˆæè¿°"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"latex"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">æˆ‘ä»¬çš„æ¨¡ç‰ˆåªåœ¨</span><span class="w"> </span><span class="err">LaTeX</span><span class="w"> </span><span class="err">æ–‡ä»¶ä¸­ç”Ÿæ•ˆ</span><span class="w">
        </span><span class="nl">"prefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WHATEVER"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">æ¨¡ç‰ˆçš„ç®€å†™ï¼Œä¸€èˆ¬ç”¨å…¨å¤§å†™å­—æ¯ï¼Œå‡å°è¯¯è§¦å‘å¯èƒ½</span><span class="w">
        </span><span class="nl">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"first line of template"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"    $1 &lt;- cursor will stop here after applying template"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"end the template"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="32-ä½¿ç”¨æ’ä»¶å†…ç½®çš„å¿«æ·é”®æ¨¡ç‰ˆ">3.2 ä½¿ç”¨æ’ä»¶å†…ç½®çš„å¿«æ·é”®/æ¨¡ç‰ˆ</h3>

<p>LaTeX workshop æ’ä»¶å†…ç½®äº†è®¸å¤šéå¸¸å¸¸ç”¨çš„å¿«æ·é”®å’Œä»£ç æ¨¡ç‰ˆï¼Œè¿™é‡Œæä¾›å…¶ä¸­ä¸€äº›å¸¸ç”¨çš„å¿«æ·é”®ï¼š</p>

<table>
  <thead>
    <tr>
      <th>æ¨¡ç‰ˆç®€å†™</th>
      <th>è§£é‡Š</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">BEN</code></td>
      <td>æœ‰åºåˆ—è¡¨ï¼ˆenumerate ç¯å¢ƒï¼‰</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">BIT</code></td>
      <td>æ— åºåˆ—è¡¨ï¼ˆitemize ç¯å¢ƒï¼‰</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>æŒ‡ä»¤</th>
      <th>å†…å®¹</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">@a</code></td>
      <td><code class="language-plaintext highlighter-rouge">\alpha</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">@A</code></td>
      <td><code class="language-plaintext highlighter-rouge">\Alpha</code></td>
    </tr>
    <tr>
      <td>â€¦</td>
      <td>â€¦ï¼ˆå¤§éƒ¨åˆ†å¸Œè…Šå­—æ¯éƒ½å¯ä»¥ç”¨ @ + å¯¹åº”è‹±æ–‡å­—æ¯æ‰“å‡ºæ¥ï¼‰</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">@6</code></td>
      <td><code class="language-plaintext highlighter-rouge">\partial</code> åå¾®åˆ†ç¬¦å·</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">@/</code></td>
      <td><code class="language-plaintext highlighter-rouge">\frac{}{}</code> åˆ†æ•°</td>
    </tr>
  </tbody>
</table>

<h2 id="4-åˆ›å»ºè‡ªå·±çš„æ¨¡ç‰ˆæ ·å¼">4 åˆ›å»ºè‡ªå·±çš„æ¨¡ç‰ˆ/æ ·å¼</h2>

<blockquote>
  <p>æŒ–ä¸ªå‘ï¼Œè¿™é‡Œæˆ‘è‡ªå·±ä¹Ÿä¸€çŸ¥åŠè§£çš„ï¼Œä»¥åå†å¡«å§</p>
</blockquote>

<!-- <div class="notification">æœ¬æŒ‡å—ä»…ä¾›å‚è€ƒï¼Œæœ¬äººæ— ä¹‰åŠ¡ä¹Ÿä¸ä¿è¯å¸®ä»»ä½•äººè§£å†³ LaTeX ç¯å¢ƒé…ç½®ç­‰é—®é¢˜ã€‚</div> -->]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Notes&quot;]" /><category term="Notes" /><summary type="html"><![CDATA[1 ç”¨ LaTeX, è€Œä¸æ˜¯ä¸ LaTeX ææ–—]]></summary></entry><entry><title type="html">The Fences | AR Web Application</title><link href="https://markchenyutian.github.io//blog/2022/the-fences.html" rel="alternate" type="text/html" title="The Fences | AR Web Application" /><published>2022-02-11T00:00:00+00:00</published><updated>2022-02-11T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2022/the-fences</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2022/the-fences.html"><![CDATA[<h2 id="in-a-sentence-what-is-it">In a Sentence, What is It?</h2>

<p>Our inspiration came from The Fence at CMU:</p>

<p>By providing a synchronized, immersive AR experience across different platforms, we aim to build a bond between virtual space and physical world, allowing people to share their ideas openly, just like role of The Fence.</p>

<h2 id="short-demo">Short Demo</h2>

<table>
  <thead>
    <tr>
      <th>iOS Application</th>
      <th>Web Application</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>&lt;img src="https://user-images.githubusercontent.com/47029019/152687716-21fb26b1-a8f5-4d14-b952-7df44f0b2eaa.gif" style="height: 25rem"/&gt;</td>
      <td>![web-demo-min](https://user-images.githubusercontent.com/47029019/152687732-d309165a-c033-444b-8bb8-8011d533efcf.gif)</td>
    </tr>
  </tbody>
</table>

<p>You can experience the web application here: <a href="https://the-fence-340405.web.app/frontend/viewer/">https://the-fence-340405.web.app/frontend/viewer/</a>.</p>

<div class="notification">
  <p>However, since the application requires specific QR-code to detect a board, you will not see any AR content unless you print the QR code denoting <code class="language-plaintext highlighter-rouge">UL-6d44ae39</code> and <code class="language-plaintext highlighter-rouge">DR-6d44ae39</code> and stick them on the wall.</p>

  <p>:warning: Our application relies on the QR-detector built in browser. However, it is known that <strong>QR-detector in Chrome on MacOS has a memory leak problem</strong>. So the webpage may use up to 7GB of memory if you leave it on for 2hrs.</p>
</div>

<h2 id="how-we-implement-these-magical-apps-brief-version">How We Implement These Magical Apps? (Brief Version)</h2>

<h3 id="mobile-application">Mobile Application</h3>

<p>For mobile application, we build upon <code class="language-plaintext highlighter-rouge">AR Kit</code>, <code class="language-plaintext highlighter-rouge">ML Core</code> and <code class="language-plaintext highlighter-rouge">Scene Kit</code>. With <code class="language-plaintext highlighter-rouge">ML Core</code> recognizing physical environment, <code class="language-plaintext highlighter-rouge">AR Kit</code> initializing AR space, and <code class="language-plaintext highlighter-rouge">Scene Kit</code> rendering AR content, our app provide user with a fluent and immersive AR experience.</p>

<p><img src="https://markdown-img-1304853431.cos.ap-guangzhou.myqcloud.com/152685412-22d75f03-0385-4552-8917-f785381ffb69.jpg" alt="Mobile Application" /></p>

<h3 id="web-application">Web Application</h3>

<p>For web application, we use the <code class="language-plaintext highlighter-rouge">WebRTC</code>, <code class="language-plaintext highlighter-rouge">OpenCV</code> and <code class="language-plaintext highlighter-rouge">WebAssembly</code> to create a chance to view experience for all mobile users without any need of installing application.</p>

<p><img src="https://markdown-img-1304853431.cos.ap-guangzhou.myqcloud.com/152671055-229ad26c-dadf-4f90-a28b-d92802374c21.jpg" alt="Web Application" /></p>

<p>Specifically, we use the QR Code not only to identify the current boardâ€™s ID, but also calculate the perspective matrix of current frame and use it to draw AR overlay on browser.</p>

<h3 id="serverless-backend">Serverless Backend</h3>

<p>For backend support, we deploy our product on <code class="language-plaintext highlighter-rouge">Firebase</code> and <code class="language-plaintext highlighter-rouge">Cloud Run</code> from Google Cloud Platform. The nature of cloud service allow our app to have low latency and high availability across different splatforms.</p>

<p><img src="https://markdown-img-1304853431.cos.ap-guangzhou.myqcloud.com/152683764-030f614c-e7c3-4dc1-8f72-7833ac1443a5.jpg" alt="Serverless Backend" /></p>

<h2 id="technical-details---ar-web-application">Technical Details - AR Web Application</h2>

<h3 id="why-we-call-this-pseudo-ar-experience">Why we call this <em>Pseudo-AR Experience</em>?</h3>

<p>The special nature of this project (showing AR-like content boards on the wall) makes it possible to create a real-time renderer purely through web technical stack (Javascript and WebAssembly).</p>

<p>Unlike the broad definition of AR objects (which may float in the 3D space around user or some â€œanchorâ€), the content we need to render is ensured to stay on a plane.</p>

<h3 id="how-we-render-actually">How We Render, Actually?</h3>

<p>Since we have an QR Code as anchor (Up-Left corner of content), we can calculate the <strong>perspective transform matrix</strong> using original dimension of QR code and detected contour of QR Code.</p>

<p>As the content is on the same plane as the QR Code, itâ€™s safe for us to assume that they share the same perspective transform matrix. Therefore, we can re-apply the resulted transformation on raw image to render it.</p>

<p><img src="https://markdown-img-1304853431.cos.ap-guangzhou.myqcloud.com/152671125-abfa8e38-0c09-423e-8637-7a2328dd5443.jpg" alt="Untitled Notebook-33" /></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getPerspectiveMatrix</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">,</span> <span class="nx">p4</span><span class="p">,</span> <span class="nx">bboxW</span><span class="p">,</span> <span class="nx">bboxH</span><span class="p">)</span>
<span class="c1">// Originally p1, p2, p3, p4 in QR detected.</span>
<span class="p">{</span>
    <span class="kd">let</span> <span class="nx">corner1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">corner2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">corner3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nx">p3</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p3</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">corner4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nx">p4</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p4</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">perspectiveArray</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">corner1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">corner1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> 
        <span class="nx">corner2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">corner2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="nx">corner3</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">corner3</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="nx">corner4</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">corner4</span><span class="p">.</span><span class="nx">y</span>
    <span class="p">];</span>
    <span class="kd">let</span> <span class="nx">srcArray</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">bboxW</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">bboxW</span><span class="p">,</span> <span class="nx">bboxH</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="nx">bboxH</span>
    <span class="p">];</span>
    <span class="kd">let</span> <span class="nx">perspectiveMat</span> <span class="o">=</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">matFromArray</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">CV_32FC2</span><span class="p">,</span> <span class="nx">perspectiveArray</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">srcMat</span> <span class="o">=</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">matFromArray</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">CV_32FC2</span><span class="p">,</span> <span class="nx">srcArray</span><span class="p">);</span>
    <span class="nx">T</span> <span class="o">=</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">getPerspectiveTransform</span><span class="p">(</span><span class="nx">srcMat</span><span class="p">,</span> <span class="nx">perspectiveMat</span><span class="p">);</span>
    <span class="nx">srcMat</span><span class="p">.</span><span class="k">delete</span><span class="p">();</span> <span class="nx">perspectiveMat</span><span class="p">.</span><span class="k">delete</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">renderPerspective</span><span class="p">(</span><span class="nx">p0</span><span class="p">,</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">,</span> <span class="nx">bboxW</span><span class="p">,</span> <span class="nx">bboxH</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">boardMat</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isLoaded</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">board-src</span><span class="dl">"</span><span class="p">))){</span>
        <span class="nx">boardMat</span> <span class="o">=</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">imread</span><span class="p">(</span><span class="dl">"</span><span class="s2">board-src</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">boardMat</span> <span class="o">=</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">imread</span><span class="p">(</span><span class="dl">"</span><span class="s2">loading</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">T</span> <span class="o">=</span> <span class="nx">getPerspectiveMatrix</span><span class="p">(</span><span class="nx">p0</span><span class="p">,</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">,</span> <span class="nx">bboxW</span><span class="p">,</span> <span class="nx">bboxH</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">perspectiveMat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">Mat</span><span class="p">(</span><span class="nx">boardElem</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">boardElem</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">CV_8UC4</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">dsize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="nx">overlayElem</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">overlayElem</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="nx">cv</span><span class="p">.</span><span class="nx">warpPerspective</span><span class="p">(</span>
        <span class="nx">boardMat</span><span class="p">,</span> <span class="nx">perspectiveMat</span><span class="p">,</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">dsize</span><span class="p">,</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">INTER_LINEAR</span><span class="p">,</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">BORDER_CONSTANT</span><span class="p">,</span> <span class="k">new</span> <span class="nx">cv</span><span class="p">.</span><span class="nx">Scalar</span><span class="p">()</span>
    <span class="p">);</span>
    <span class="nx">cv</span><span class="p">.</span><span class="nx">imshow</span><span class="p">(</span><span class="nx">overlayElemID</span><span class="p">,</span> <span class="nx">perspectiveMat</span><span class="p">);</span>
    <span class="nx">boardMat</span><span class="p">.</span><span class="k">delete</span><span class="p">();</span> <span class="nx">T</span><span class="p">.</span><span class="k">delete</span><span class="p">();</span> <span class="nx">perspectiveMat</span><span class="p">.</span><span class="k">delete</span><span class="p">();</span>
    <span class="nx">calculateRatio</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By laying the original video, rendered output canvas, and HTML Document Elements in a stack, we can create a <em>pseudo-AR</em> experience for users, <strong>even when their device does not support standard WebXR APIs</strong>.</p>

<p><img src="https://markdown-img-1304853431.cos.ap-guangzhou.myqcloud.com/152671154-8bd10367-223d-455e-b1f5-823ea3a3d4d0.jpg" alt="Untitled Notebook-27" /></p>

<p>When a new detection result arrives, in two cases we donâ€™t need to update our render result:</p>

<ol>
  <li>No QR Code is detected at this frame (the QR Detector occationally miss QR codes in view) <strong>Countinuity Enhancement Intervened</strong></li>
  <li>The new perspective matrix is almost the same as previous one <strong>Stability Enhancement Intervened</strong></li>
</ol>

<h3 id="continuity-enhancement">Continuity Enhancement</h3>

<p>The <code class="language-plaintext highlighter-rouge">barcodeDetector</code> provided by Chrome is fast, but also unstable. Minor change in perspective or camera position may lead to a loss of 1-2 frames of detection result.</p>

<p>When there are only 1-2 frames with no QR code is detected, the renderer will Not clear the canvas at once. Instead, it will begin to count the number of frame without QR detection result. If the counter reach 10, the canvas will then be cleared. This can greatly relief the flickering problem in AR Content.</p>

<h3 id="stability-enhancement">Stability Enhancement</h3>

<p>If we render every frame based on the result of QR Scanner directly, the content will be highly unstable and have poor user experience.</p>

<table>
  <thead>
    <tr>
      <th>Before Stabilization</th>
      <th>After Stabilization</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>![BadExample-min](https://user-images.githubusercontent.com/47029019/152672103-b7260f7c-171b-4b82-894c-69c18187a250.gif)</td>
      <td>![GoodExample-min](https://user-images.githubusercontent.com/47029019/152672171-288b6b09-8fe7-4a75-8b52-c317f3769cdb.gif)</td>
    </tr>
  </tbody>
</table>

<p>When the new QR Code <code class="language-plaintext highlighter-rouge">P1</code> is within three pixels away from previos detection result (<code class="language-plaintext highlighter-rouge">P1'</code>), we will NOT update the AR Render. This can minimize the â€œshakingâ€ of AR content, and provide a better user experience.</p>

<table>
  <thead>
    <tr>
      <th>Illustration</th>
      <th>Explaination</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>![illustration](https://user-images.githubusercontent.com/47029019/152673584-0124049d-506e-456f-802f-09d08c06fbe7.jpeg)</td>
      <td>If the black square is detection result at frame <code class="language-plaintext highlighter-rouge">t</code>, the AR content will be re-rendered only in case of green frames. If the detection result at <code class="language-plaintext highlighter-rouge">t + 1</code> is the red bounding box, then AR content will NOT be re-rendered.</td>
    </tr>
  </tbody>
</table>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Frontend&quot;]" /><category term="Web" /><summary type="html"><![CDATA[In a Sentence, What is It?]]></summary></entry><entry><title type="html">Serverless File System based on AWS S3</title><link href="https://markchenyutian.github.io//blog/2022/serverless-file-system.html" rel="alternate" type="text/html" title="Serverless File System based on AWS S3" /><published>2022-01-19T00:00:00+00:00</published><updated>2022-01-19T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2022/serverless-file-system</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2022/serverless-file-system.html"><![CDATA[<p>This system is deployed on <a href="/blog/files.html">My blogâ€™s file Sharing Page</a> as a front-end application.</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/20220119171645.jpg" alt="Serverless-file-system" /></p>

<p>Reference Information:</p>

<ul>
  <li><a href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/s3-example-photos-view.html">Viewing Photo stored in S3 Buckets</a></li>
  <li><a href="https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/welcome.html">AWS SDK for JavaScript</a></li>
  <li><a href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/getting-started-browser.html#getting-started-browser-create-identity-pool">AWS Cognito Identity Pool</a></li>
</ul>

<h2 id="how-these-work">How these Work?</h2>

<p>A user identity pool is created using AWS Cognito. Any user authenticated / unauthenticated join this identity pool will be automatically assigned with an AWS role. Then, we create a AWS SDK key corresponding to this identity pool. Anyone access AWS Service using SDK and given key will get an role called <code class="language-plaintext highlighter-rouge">Cognito_MyBlogFilesUnAuth_Role</code>.</p>

<p>Using IAM, we can assign this role with permission to access some specific AWS Resource. In this case, we only allow users to access the S3 storage bucket <code class="language-plaintext highlighter-rouge">yutian-public</code> and allow them to <code class="language-plaintext highlighter-rouge">List</code> and <code class="language-plaintext highlighter-rouge">Get</code> objects from the bucket.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::yutian-public"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor1"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::yutian-public/*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Frontend&quot;]" /><category term="Web" /><summary type="html"><![CDATA[This system is deployed on My blogâ€™s file Sharing Page as a front-end application.]]></summary></entry><entry xml:lang="ch"><title type="html">NLP 101: Transformer Model</title><link href="https://markchenyutian.github.io//blog/2022/Transformers.html" rel="alternate" type="text/html" title="NLP 101: Transformer Model" /><published>2022-01-09T00:00:00+00:00</published><updated>2022-01-09T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2022/Transformers</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2022/Transformers.html"><![CDATA[<h2 id="0-èƒŒæ™¯çŸ¥è¯†">0 èƒŒæ™¯çŸ¥è¯†</h2>

<ol>
  <li>
    <p><a href="/blog/2021/Word-Embedding.html">è¯åµŒå…¥ - Word Embedding</a></p>

    <p>ä¸€ç§å°†è‡ªç„¶è¯­è¨€åœ¨è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºçš„åŒæ—¶ä¿ç•™è¯æ±‡åŸæœ‰çš„è¯­ä¹‰ä½™ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ–¹æ³•ï¼ˆå°†é«˜ç»´çš„è‡ªç„¶è¯­è¨€â€œåµŒå…¥â€åˆ°ä½ç»´å‘é‡ç©ºé—´ï¼‰</p>
  </li>
  <li>
    <p><a href="/blog/2021/Seq2Seq.html">ç¼–ç å™¨-è§£ç å™¨ç»“æ„ - Encoder-Decoder Architecture</a></p>

    <p>ç¼–ç å™¨-è§£ç å™¨ç»“æ„å°†ä»»åŠ¡åˆ†æˆä¸¤ä¸ªæ­¥éª¤ï¼šå…ˆç”±ç¼–ç å™¨å°†è¾“å…¥ç¼–ç /æ€»ç»“ï¼Œå†é€šè¿‡è§£ç å™¨å°†ç¼–ç ç»“æœè§£ææˆçœŸæ­£çš„è¾“å‡º</p>
  </li>
  <li>
    <p><a href="/blog/2022/Attention-Mechanism.html">æ³¨æ„åŠ›æœºåˆ¶ - Attention Mechanism</a></p>

    <p>ä¸€ç§é€šè¿‡åŠ¨æ€èµ‹äºˆç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€æƒé‡è®©è§£ç å™¨å……åˆ†ï¼Œæœ‰é‡ç‚¹çš„è·å–ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
  </li>
</ol>

<h2 id="1-self-attention-è‡ªæ³¨æ„åŠ›æœºåˆ¶">1 Self-Attention è‡ªæ³¨æ„åŠ›æœºåˆ¶</h2>

<h3 hide-toc="true">1.1 Self-Attention ä¸ Attention çš„åŒºåˆ«</h3>

<p>æ³¨æ„åŠ›æœºåˆ¶çš„æå‡ºæ˜¯ä½œä¸ºè§£å†³ Seq2Seq æ¨¡å‹ä¸­çš„ä¿¡æ¯ç“¶é¢ˆä¸ä¸­é—´çŠ¶æ€ä¸¢å¤±é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œåœ¨ Google 2018 å¹´å‘è¡¨çš„è®ºæ–‡ <em>Attention is All You Need</em> ä¸­ï¼Œç ”ç©¶äººå‘˜ä»¬åˆ›æ–°æ€§çš„æå‡ºäº†â€œè‡ªæ³¨æ„åŠ›æœºåˆ¶â€ã€‚åœ¨è¿™ç§æ³¨æ„åŠ›æœºåˆ¶çš„å˜ç§ä¸­ï¼Œæ³¨æ„åŠ›æœºåˆ¶ä¸å†ä½œä¸ºè¿æ¥æ¨¡å‹ä¸¤ä¸ªéƒ¨åˆ†çš„ä¸­é—´ä»¶å‡ºç°ã€‚</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_D6D1A983D5DF-1.jpeg" alt="IMG_D6D1A983D5DF-1" /></p>
  <figcaption>Fig 1. æ³¨æ„åŠ›æœºåˆ¶ vs. è‡ªæ³¨æ„åŠ›æœºåˆ¶</figcaption>
</figure>

<p>å¦‚ Fig 1 æ‰€ç¤ºï¼Œåœ¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬è®© $q_t = k_t = v_t = h_t$ï¼Œå¹¶å°†æ³¨æ„åŠ›æƒé‡åœ¨å„ä¸ªéšè—çŠ¶æ€ä¸Šçš„åŠ æƒå¹³å‡ç›´æ¥è¾“å‡ºã€‚è¿™ä¹Ÿæ˜¯è¿™ä¸ªç»“æ„åç§°â€œè‡ªæ³¨æ„åŠ›æœºåˆ¶â€çš„æ¥ç”± â€”â€” ç”¨æ¥è®¡ç®—æ³¨æ„åŠ›æƒé‡çš„ $q_i$ ä¸ $k_i$ éƒ½æ¥è‡ªäºåŒä¸€å±‚æ•°æ®ï¼ˆè‡ªå·±ï¼‰ã€‚</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_1E706864A324-1.jpeg" alt="IMG_1E706864A324-1" /></p>
  <figcaption> Fig 2. è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ $q$, $k$, $v$ éƒ½æ¥è‡ªäºâ€œè‡ªå·±â€</figcaption>
</figure>

<h3 hide-toc="true">1.2 åˆ å»ä¼ ç»Ÿ NLP æ¨¡å‹ä¸­çš„ RNN ç»“æ„ - Attention is All You Needï¼</h3>

<p>ä»”ç»†åˆ†æ Fig 2 ä¸­çš„ç»“æ„ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®é™…ä¸Šè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ç»“æ„è¿˜å¯ä»¥æ›´åŠ ç®€å•ã€‚æˆ‘ä»¬åœ¨ Seq2Seq æ¨¡å‹ä¸­ä½¿ç”¨ LSTM æ˜¯ä¸ºäº†è®©æ¨¡å‹è·çŸ¥æ•´ä¸ªè¾“å…¥åºåˆ—çš„ä¸Šä¸‹æ–‡å†…å®¹ã€‚ç„¶è€Œï¼Œåœ¨ Self-Attention æ¨¡å‹ä¸­ï¼Œè¿™ä¹ˆåšä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚å› ä¸ºæ³¨æ„åŠ›æœºåˆ¶å•ç‹¬å¯ä»¥ä¿è¯è¾“å‡ºå±‚å¯ä»¥è·å¾—æ•´ä¸ªè¾“å…¥åºåˆ—çš„ä¸Šä¸‹æ–‡ã€‚</p>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥ç›´æ¥åˆ å» Self-Attention ç»“æ„ä¸­çš„ RNN è€Œä¸å½±å“æ¨¡å‹è·å–çš„ä¿¡æ¯é‡ã€‚è¿™ä¹Ÿæ˜¯è®ºæ–‡é¢˜ç›® <strong><em>Attnetion is All You Need</em></strong>  çš„æ„æ€äº† â€”â€” æˆ‘ä»¬çš„æ¨¡å‹å®é™…ä¸Šå¯ä»¥åªä½¿ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®Œå…¨ä¸ä½¿ç”¨ä¹‹å‰åå¤šå¹´ä¸­å„ç±»è§£å†³ NLP é—®é¢˜çš„æ¨¡å‹çš„æ ¸å¿ƒç»“æ„ - é€’å½’ç¥ç»ç½‘ç»œ RNNã€‚</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_AB1D95A09BC4-1.jpeg" alt="IMG_AB1D95A09BC4-1" /></p>
  <figcaption> Fig 3. åˆ å» RNN è¿æ¥åçš„è‡ªæ³¨æ„åŠ›å±‚ï¼Œè¾“å‡ºä¾ç„¶å¯ä»¥è·å¾—æ•´ä¸ªè¾“å…¥åºåˆ—çš„ä¸Šä¸‹æ–‡</figcaption>
</figure>

<h3 hide-toc="true">1.3 è‡ªæ³¨æ„åŠ›æœºåˆ¶ vs å…¨è¿æ¥å±‚ï¼Ÿ</h3>

<p>è§‚å¯Ÿ Fig 2ï¼Œä¸éš¾å‘ç°è‡ªæ³¨æ„åŠ›ç»“æ„çš„è¾“å‡ºç»“æœå…¶å®å°±æ˜¯è¾“å…¥çš„çº¿æ€§ç»“åˆè€Œå·²ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£è‡ªæ³¨æ„åŠ›å±‚ä¸å…¨è¿æ¥å±‚æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿéš¾é“ç»è¿‡äº†åå¤šå¹´çš„å‘å±•ï¼Œç¥ç»ç½‘ç»œçš„ç ”ç©¶è€…ä»¬åˆç”¨ fancy çš„æ–¹æ³•é‡æ–°å‘æ˜äº†ä¸€æ¬¡å…¨è¿æ¥å±‚å—ï¼Ÿ</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_E4BF48EFE99F-1.jpeg" alt="IMG_E4BF48EFE99F-1" /></p>
  <figcaption> Fig 4. è‡ªæ³¨æ„åŠ›å±‚ä¸å…¨è¿æ¥å±‚éå¸¸ç›¸ä¼¼ â€”â€” ä»æŸç§æ„ä¹‰ä¸Šè¯´</figcaption>
</figure>

<p><strong>å®é™…ä¸Šè‡ªæ³¨æ„åŠ›æœºåˆ¶å¯ä»¥çœ‹æˆä¸€ç§æ›´åŠ é«˜çº§ï¼ŒæŠ½è±¡çš„å…¨è¿æ¥å±‚ã€‚</strong>ä¸å…¨è¿æ¥å±‚ç›´æ¥å­¦ä¹ ç¥ç»å…ƒä¹‹é—´çš„æƒé‡ä¸åŒï¼Œè‡ªæ³¨æ„åŠ›æœºåˆ¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šå­¦ä¹ å¦‚ä½•åˆ†é…ç¥ç»å…ƒä¹‹é—´æƒé‡ä½¿å¾—æŸå¤±å‡½æ•°æœ€å°åŒ–ã€‚ å¦‚æœè¯´å…¨è¿æ¥å±‚æ˜¯åœ¨ç›´æ¥å­¦ä¹  $y = Wx$ ä¸­çš„æƒé‡å‚æ•° $W$ï¼Œé‚£ä¹ˆè‡ªæ³¨æ„åŠ›æœºåˆ¶åˆ™æ˜¯åœ¨å­¦ä¹  $g: x \rightarrow W$ è¿™æ ·ä¸€ä¸ª<strong>æ ¹æ®è¾“å…¥åŠ¨æ€è®¡ç®—æƒé‡</strong>çš„å‡½æ•°ã€‚</p>

<p>åŒæ—¶ï¼Œå› ä¸ºè‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸æ˜¯ç›´æ¥å­¦ä¹ ç¥ç»å…ƒä¹‹é—´çš„æƒé‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å®šé•¿åº¦çš„è¾“å…¥ä¸Šä½¿ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚</p>

<h3 hide-toc="true">1.4 è‡ªæ³¨æ„åŠ›æœºåˆ¶ vs é€’å½’ç¥ç»ç½‘ç»œï¼Ÿ</h3>

<p>è‡ªæ³¨æ„åŠ›æœºåˆ¶åœ¨å»ºç«‹è¾“å‡ºä¸æ•´ä¸ªè¾“å…¥åºåˆ—ä¹‹é—´çš„è”ç³»çš„åŒæ—¶é¿å…äº†é€’å½’ç¥ç»ç½‘ç»œçš„è®¸å¤šç¼ºç‚¹ï¼š</p>

<p>å› ä¸ºåœ¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­æ²¡æœ‰é€’å½’è°ƒç”¨è‡ªèº«å‚æ•°ï¼Œæˆ‘ä»¬ä¸ä¼šæœ‰æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸é—®é¢˜ã€‚</p>

<p>åŒæ—¶ï¼Œå› ä¸ºåœ¨é€’å½’ç¥ç»ç½‘ç»œä¸­ï¼Œæ¯ä¸€ä¸ªæ—¶åˆ»ç½‘ç»œçš„çŠ¶æ€éƒ½ç”±è¯¥æ—¶åˆ»å‰ç½‘ç»œçš„çŠ¶æ€æ‰€å†³å®šï¼Œæˆ‘ä»¬<em>ä¸èƒ½å¹¶è¡Œ</em>çš„å¤„ç†è¾“å…¥åºåˆ—ã€‚åœ¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œå› ä¸ºè¾“å‡ºä¸­çš„æ¯ä¸€ä¸ªåˆ†é‡éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¹¶è¡Œçš„è®¡ç®—æ‰€æœ‰è¾“å‡ºåˆ†é‡ã€‚è¿™å¯ä»¥è®©æ¨¡å‹çš„è®¡ç®—é€Ÿåº¦å¤§å¹…å¢åŠ ã€‚</p>

<p>åœ¨è®ºæ–‡ä¸­ï¼Œä½œè€…æ¯”è¾ƒäº† è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œé€’å½’ç¥ç»ç½‘ç»œå’Œå·ç§¯çš„æ—¶é—´å¤æ‚åº¦ä¸å¹¶è¡Œè¿ç®—æ—¶é—´ ï¼ˆå‡è®¾è¯å‘é‡ç»´åº¦ä¸º $d$ï¼Œè¾“å…¥åºåˆ—é•¿åº¦ä¸º $n$ï¼Œå·ç§¯æ ¸å°ºå¯¸ä¸º $k\times k$ï¼‰</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Â </th>
      <th style="text-align: center">Time Complexity</th>
      <th style="text-align: center">Work Span</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">Self-Attention</td>
      <td style="text-align: center">$O(n^2\cdot d)$</td>
      <td style="text-align: center">$O(1)$</td>
    </tr>
    <tr>
      <td style="text-align: right">Recurrent NN</td>
      <td style="text-align: center">$O(n\cdot d^2)$</td>
      <td style="text-align: center">$O(n)$</td>
    </tr>
    <tr>
      <td style="text-align: right">Convolution</td>
      <td style="text-align: center">$O(k\cdot n\cdot d^2)$</td>
      <td style="text-align: center">$O(1)$</td>
    </tr>
  </tbody>
</table>

<p>å¯ä»¥å‘ç°ï¼Œåœ¨è¾“å…¥åºåˆ—é•¿åº¦ä¸è¶…è¿‡è¯å‘é‡ç»´åº¦çš„æƒ…å†µä¸‹ï¼Œè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„æ—¶é—´å¤æ‚åº¦ä¸å¹¶è¡Œè¿ç®—æ—¶é—´éƒ½æ˜¯ä¸‰ç§æ¨¡å‹ä¸­æœ€å°çš„ã€‚</p>
<h2 id="2-multi-head-attention-å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶">2 Multi-Head Attention å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</h2>

<p>ç°åœ¨æˆ‘ä»¬å°†ä¸Šæ–‡æåˆ°çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶å°è£…æˆä¸€ä¸ªæ¨¡å— - å‘è¿™ä¸ªæ¨¡å—è¾“å…¥é•¿åº¦ç›¸åŒçš„å‘é‡ $K$ï¼Œ$V$ å’Œ $Q$ï¼Œæ¨¡å—ä¼šè¾“å‡ºé•¿åº¦ç›¸åŒçš„ä¸€ä¸ªç»“æœ $Y$ã€‚</p>

<figure>
    <img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_60993124ACDA-1.jpeg" style="zoom: 20%" />
    <figcaption> Fig 5. ä¸ºäº†æ–¹ä¾¿ä¸‹æ–‡è®¨è®ºï¼Œæˆ‘ä»¬å°†è‡ªæ³¨æ„åŠ›å±‚å°è£…æˆä¸€ä¸ªæ¨¡å—è®¨è®º</figcaption>
</figure>

<p>è™½ç„¶åœ¨ä¸Šæ–‡å…³äºè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè®© $q_i = k_i = v_i = x_i$ï¼Œåœ¨å®é™…çš„ Self-Attention æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ†åˆ«å¯¹ $x$ è¿›è¡Œä¸åŒçš„æ“ä½œå¾—åˆ°ä¸åŒçš„ $Q$, $K$, $V$ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ“ä½œç”¨çŸ©é˜µ $W$ è¡¨ç¤ºï¼š</p>

<p>$$
Q = W_q X,\quad K = W_k X,\quad V = W_v X
$$</p>

<p>å…¶ä¸­ï¼Œè¿™ä¸‰ä¸ª $W$ çŸ©é˜µéƒ½æ˜¯æ¨¡å‹ä¸­<strong>å¯å­¦ä¹ çš„å‚æ•°</strong>ã€‚è€Œæˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ä¸­åˆ™ä½¿ç”¨çš„æ˜¯ $W_q = W_k = W_v = I$ çš„ä¸€ä¸ªç‰¹æ®Šæƒ…å†µã€‚æˆ‘ä»¬æŠŠè¿™æ ·ä¸€ä¸ªè‡ªæ³¨æ„åŠ›å±‚ + Qï¼ŒKï¼ŒV åˆ†åˆ«çš„çº¿æ€§å˜æ¢æ“ä½œåˆç§°ä¸ºä¸€ä¸ªâ€œå•å¤´æ³¨æ„åŠ›â€ã€‚</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_2893.jpg" alt="IMG_2893" /></p>
  <figcaption> Fig 6. å•å¤´æ³¨æ„åŠ›æ¨¡å‹ç”±ä¸€ä¸ªè‡ªæ³¨æ„åŠ›å±‚ä¸ä¸‰ä¸ªå¯¹è¾“å…¥çš„çº¿æ€§å˜æ¢æ„æˆ</figcaption>
</figure>

<p>å°†å¤šä¸ªå•å¤´æ³¨æ„åŠ›åˆå¹¶åœ¨åŒä¸€å±‚ä¸Šï¼Œå°±å½¢æˆäº†ä¸€ä¸ªâ€œå¤šå¤´æ³¨æ„åŠ›å±‚(Multi-head Attention)â€ã€‚ ç†è®ºä¸Šï¼Œå¤šå¤´æ³¨æ„åŠ›ä¸­çš„æ¯ä¸€ä¸ªè‡ªæ³¨æ„åŠ›å±‚ä¼šå­¦ä¹ åˆ°ä¸åŒçš„æƒé‡å‚æ•°ï¼Œä»è€Œæé«˜ç¼–ç å™¨çš„è¡¨è¾¾åŠ›ã€‚</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_F444A7C83CF2-1.jpeg" alt="IMG_F444A7C83CF2-1" /></p>
  <figcaption> Fig 7. å¤šå¤´æ³¨æ„åŠ›ç”±å¤šä¸ªå•å¤´æ³¨æ„åŠ›å †å è€Œæˆ </figcaption>
</figure>

<h2 id="3-transformer-çš„ç»“æ„">3 Transformer çš„ç»“æ„</h2>

<h3 id="31-ç¼–ç å™¨-encoder">3.1 ç¼–ç å™¨ Encoder</h3>

<p>åœ¨ Transformer ä¸­ï¼Œä¸€ä¸ªç¼–ç å™¨æ¨¡å—ç”±ä¸€ä¸ªå¤šå¤´æ³¨æ„åŠ›ä¸ä¸€ä¸ªå‰é¦ˆç½‘ç»œæ„æˆã€‚å‰é¦ˆç¥ç»ç½‘ç»œä¼šå•ç‹¬å¤„ç†å¤šå¤´æ³¨æ„åŠ›çš„æ¯ä¸€ä¸ªè¾“å‡º tokenã€‚</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_CE1493F0D6C6-1.jpeg" alt="IMG_CE1493F0D6C6-1" /></p>
  <figcaption> Fig 8. Transformer ä¸­çš„æ¯ä¸€ä¸ªè§£ç å™¨æ¨¡å—éƒ½ç”±ä¸¤ä¸ªéƒ¨åˆ†æ„æˆï¼Œä¸¤ä¸ªéƒ¨åˆ†å„å¸å…¶èŒã€‚åŒæ—¶ï¼Œæ¨¡å—å†…éƒ¨çš„ç»„ä»¶ä¹‹é—´æœ‰ Shortcut Connection ä¿è¯æ¢¯åº¦çš„ä¼ é€’</figcaption>
</figure>

<p>è¿™æ ·ï¼Œåœ¨è§£ç å™¨çš„æ¯ä¸€ä¸ªæ¨¡å—ä¸­å…¶å®å¯¹è¾“å…¥ä¿¡æ¯åšäº†ä¸¤æ­¥å¤„ç†ï¼š</p>

<ol>
  <li>
    <p>å°†è¾“å…¥çš„ tokens é€šè¿‡å¤šå¤´æ³¨æ„åŠ›â€œæ··åˆâ€èµ·æ¥ï¼Œä½¿å¾—æ¯ä¸€ä¸ªè¾“å‡ºtokenéƒ½å¾—åˆ°äº†æ‰€æœ‰è¾“å…¥ä¸­æ‰€éœ€çš„ä¿¡æ¯</p>
  </li>
  <li>
    <p>å°†â€œæ··åˆâ€åçš„ token é€šè¿‡å‰é¦ˆç¥ç»ç½‘ç»œè¿›è¡Œç‰¹å¾æå–ï¼Œå¯¹æ¯ä¸€ä¸ª token è¿›è¡ŒçœŸæ­£çš„â€œè§£è¯»â€</p>
  </li>
</ol>

<p>ä¸æ­¤åŒæ—¶ï¼Œä½œè€…ä¸ºäº†é˜²æ­¢é‡å¤å †å ç¼–ç å™¨æ¨¡å—å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸ï¼Œæ¨¡ä»¿ ResNet çš„åšæ³•åœ¨æ¯ä¸€ä¸ªæ¨¡å—çš„ä¸¤ä¸ªç»„ä»¶ä¹‹é—´éƒ½æ·»åŠ äº†çŸ­è·¯è¿æ¥æ¥å¸®åŠ©æ¢¯åº¦åå‘ä¼ æ’­ã€‚</p>

<p>åœ¨è¾“å…¥åºåˆ—è¿›å…¥å †å çš„ç¼–ç å™¨æ¨¡å—å‰è¦å…ˆç»è¿‡è¯åµŒå…¥å±‚ä¸ä½ç½®ç¼–ç å±‚ã€‚è¯åµŒå…¥å±‚é€šè¿‡ç±»ä¼¼æŸ¥è¡¨çš„æ–¹å¼å°†è‡ªç„¶è¯­è¨€è¾“å…¥è½¬åŒ–ä¸º $\mathbb{R}^n$ å‘é‡ç©ºé—´ä¸­å¯ä»¥è®¡ç®—çš„å‘é‡å½¢å¼ã€‚ä½ç½®ç¼–ç å±‚åˆ™å°†è¾“å…¥tokenä¹‹é—´çš„<strong>ç»å¯¹ä½ç½®å…³ç³»</strong>é€šè¿‡åŠ æ³•çš„å½¢å¼å†™å…¥åˆ°tokenä¸­ä¼ é€’ç»™ç¼–ç å™¨ã€‚</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_0D1DA4A8EBFD-1.jpeg" style="width: 50%;" /></p>
  <figcaption> Fig 9. Transformer çš„ç¼–ç å™¨ç»“æ„</figcaption>
</figure>

<h3 id="32-è§£ç å™¨-decoder">3.2 è§£ç å™¨ Decoder</h3>

<p>Transformer çš„è§£ç å™¨ä¸ç¼–ç å™¨ç±»ä¼¼ï¼Œä¹Ÿç”±é‡å¤å †å çš„è§£ç æ¨¡å—æ„æˆã€‚æ¯ä¸€ä¸ªè§£ç æ¨¡å—çš„ç»“æ„å¦‚ä¸‹</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_B6E42D58B414-1.jpeg" style="width: 80%;" /></p>
  <figcaption> Fig 10. Transformer çš„è§£ç æ¨¡å—ä¸­æœ‰ä¸€ä¸ª Masked Multi-head Attentionï¼Œä¸€ä¸ª Multi-head Attention å’Œ å‰é¦ˆç¥ç»ç½‘ç»œ</figcaption>
</figure>

<p>åœ¨è§£ç å™¨ä¸­å‡ºç°äº†ä¸€ä¸ªä¹‹å‰æ²¡æœ‰æåŠçš„â€œMasked Multi-head Attentionâ€ã€‚è¿™é‡Œçš„â€œMaskedâ€æŒ‡çš„æ˜¯åŠ åœ¨åŸå§‹æ³¨æ„åŠ›æƒé‡ $g(q, k)$ ä¸Šçš„ä¸€ä¸ªçŸ©é˜µã€‚</p>

<figure>
<img src="https://markdown-img-1304853431.file.myqcloud.com/20220111153841.png" style="width: 33%" />
<figcaption> Fig 11. Masked Multihead Attention çš„è®¡ç®—å›¾ï¼Œå¯ä»¥çœ‹åˆ°é®ç½©æ˜¯æ”¾åœ¨ Qï¼ŒK çš„è¿ç®—ç»“æœï¼ˆåŸå§‹æ³¨æ„åŠ›æƒé‡ï¼‰ä¸Šçš„</figcaption>
</figure>

<p>è¿™ä¸ªé®ç½©å¯ä»¥é˜²æ­¢è§£ç å™¨åˆ©ç”¨â€œæœªæ¥â€çš„ä¿¡æ¯ã€‚æ¯”å¦‚è§£ç å™¨å·²ç»è¾“å‡ºäº† â€œI / am / fine / .â€ï¼Œæˆ‘ä»¬ç°åœ¨å°†è¿™äº›tokenè¾“å…¥åˆ°è§£ç å™¨ä¸­ï¼Œè®©è§£ç å™¨é¢„æµ‹ä¸‹ä¸€ä¸ªtokenã€‚ç”±äºè§£ç å™¨è¾“å‡º â€œIâ€ çš„æ—¶å€™ â€œam / fine / .â€ è¿˜æ²¡æœ‰ç”Ÿæˆï¼ŒI å’Œè¿™äº› token æ²¡æœ‰å…³ç³»ã€‚é€šè¿‡é®ç½©ï¼Œæˆ‘ä»¬å¯ä»¥â€œæ‰‹åŠ¨â€å°†è¿™äº›æ²¡æœ‰å› æœå…³ç³»çš„æ³¨æ„åŠ›æƒé‡è®¾ç½®ä¸º0.</p>

<figure>
<img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_80BF9CA01C03-1.jpeg" style="width: 50%" />
<figcaption> Fig 12. Masked Multihead Attention ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é®ç½©æ‰‹åŠ¨ï¼Œæ˜¾å¼çš„ç§»é™¤è¿™ä¸ª token ä¸è§£ç å™¨åœ¨æœªæ¥çš„è¾“å‡ºä¹‹é—´çš„å…³ç³»</figcaption>
</figure>

<h3 id="33-æ•´ä½“">3.3 æ•´ä½“</h3>

<p>å°†ç¼–ç å™¨ä¸è§£ç å™¨åˆå¹¶èµ·æ¥ï¼Œæˆ‘ä»¬å°±çš„åˆ°äº† Transformer çš„æ¨¡å‹ï¼š</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_B24E2B3D67CF-1.jpeg" alt="IMG_B24E2B3D67CF-1" /></p>

<h2 id="4-å‚è€ƒæ¥æº-sources">4 å‚è€ƒæ¥æº Sources</h2>

<ul>
  <li>
    <p><a href="https://arxiv.org/abs/1706.03762">Attention is All You Need</a></p>
  </li>
  <li>
    <p><a href="https://mediaservices.cmu.edu/media/Deep+Learning+%28Fall+2021%29_Introduction+to+Transformers/1_49anpe1e/223190053">CMU 11-785 21 Fall Lecture 19: Transformer &amp; GNN</a></p>
  </li>
  <li>
    <p><a href="https://towardsdatascience.com/illustrated-guide-to-transformers-step-by-step-explanation-f74876522bc0">Illustrated Guide to Transformers Neural Network</a></p>
  </li>
  <li>
    <p><a href="https://stackoverflow.com/questions/58127059/how-to-understand-masked-multi-head-attention-in-transformer">Stack Overflow - How to Understand Masked Multi-head Attention in Transformer</a></p>
  </li>
  <li>
    <p><a href="https://stackoverflow.com/questions/64218678/whats-the-difference-between-self-attention-mechanism-and-full-connection-l">Stack Overflow - Difference between Self-attention and Fully Connection Layer</a></p>
  </li>
</ul>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Neural Network&quot;]" /><category term="NLP" /><category term="Neural Network" /><summary type="html"><![CDATA[0 èƒŒæ™¯çŸ¥è¯†]]></summary></entry><entry xml:lang="ch"><title type="html">NLP 101: Attention Mechanism</title><link href="https://markchenyutian.github.io//blog/2022/Attention-Mechanism.html" rel="alternate" type="text/html" title="NLP 101: Attention Mechanism" /><published>2022-01-04T00:00:00+00:00</published><updated>2022-01-04T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2022/Attention-Mechanism</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2022/Attention-Mechanism.html"><![CDATA[<h2 id="seq2seq-æ¨¡å‹çš„é—®é¢˜">Seq2Seq æ¨¡å‹çš„é—®é¢˜</h2>

<p>åœ¨ä¹‹å‰å…³äº <code class="language-plaintext highlighter-rouge">Seq2Seq</code> æ¨¡å‹çš„<a href="/blog/2021/Seq2Seq.html">æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬åœ¨æœ€åæåˆ°äº†ç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´çš„ä¿¡æ¯ç“¶é¢ˆé—®é¢˜</p>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_82F6020DAD92-1.jpeg" alt="IMG_82F6020DAD92-1" /></p>
  <figcaption>Fig 1. Seq2Seq æ¨¡å‹ä¸­ç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´çš„â€œç“¶é¢ˆâ€</figcaption>
</figure>

<ol>
  <li>ç”±äºç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´åªä½¿ç”¨æ€»ç»“å‘é‡è¿æ¥ï¼Œå½“å‘ç¼–ç å™¨è¾“å…¥é•¿åºåˆ—æ—¶ï¼Œæ€»ç»“å‘é‡ç”±äºç»´åº¦é™åˆ¶å¯èƒ½æ— æ³•åŒ…æ¶µè¾“å…¥åºåˆ—ä¸­çš„æ‰€æœ‰ä¿¡æ¯ã€‚</li>
  <li>åŒæ—¶ï¼Œå› ä¸ºæˆ‘ä»¬åªå°†ç¼–ç å™¨çš„æœ€åæ—¶åˆ»çš„éšè—çŠ¶æ€ä½œä¸ºæ€»ç»“å‘é‡ä¼ é€’ç»™äº†è§£ç å™¨ï¼Œç¼–ç å™¨ä¸­é—´éšè—çŠ¶æ€çš„ä¿¡æ¯ä¸å¯é¿å…çš„è¢«ä¸¢å¤±äº†ã€‚</li>
</ol>

<p>Attention Mechanism æœ€å¼€å§‹è¢«æå‡ºå°±æ˜¯ä¸ºäº†è§£å†³ Seq2Seq æ¨¡å‹çš„è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p>

<h2 id="ä½¿ç”¨å¹³å‡éšè—çŠ¶æ€ä½œä¸ºæ€»ç»“å‘é‡">ä½¿ç”¨å¹³å‡éšè—çŠ¶æ€ä½œä¸ºæ€»ç»“å‘é‡ï¼Ÿ</h2>

<figure>
  <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_95D1E32E6D0D-1.jpeg" alt="IMG_95D1E32E6D0D-1" /></p>
  <figcaption>Fig 2. å°†ç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€å–å¹³å‡ååœ¨æ¯ä¸€ä¸ªæ—¶åˆ»ä½œä¸ºè¾“å…¥çš„ä¸€éƒ¨åˆ†ä¼ é€’ç»™è§£ç å™¨</figcaption>
  <figure />

  <p>åœ¨è¿™æ ·çš„ä¸€ä¸ªæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–ç å™¨çš„æ‰€æœ‰éšè—çŠ¶æ€å–å¹³å‡åé€šè¿‡ä¸è§£ç å™¨çš„è¾“å…¥ç›´æ¥æ‹¼æ¥å°†ç¼–ç å™¨çš„ä¿¡æ¯ä¼ é€’ç»™è§£ç å™¨ã€‚é€šè¿‡è®¡ç®—ç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€çš„å¹³å‡å€¼ï¼Œæˆ‘ä»¬è§£å†³äº†é—®é¢˜2 - ç°åœ¨ä¼ é€’çš„â€œæ€»ç»“å‘é‡â€ $h_{avg}$ åŒ…æ¶µäº†ç¼–ç å™¨ä¸­æ‰€æœ‰éšè—çŠ¶æ€çš„ä¿¡æ¯ã€‚</p>

  <p>è™½ç„¶åœ¨ä¸Šå›¾ä¸­ç¼–ç å™¨ä¸è§£ç å™¨ä¸­çœ‹èµ·æ¥æœ‰å¤§é‡çš„è¿æ¥ï¼Œä½†æ˜¯<strong>ä¿¡æ¯ç“¶é¢ˆçš„é—®é¢˜å¹¶æ²¡æœ‰åœ¨è¿™ä¸ªæ¨¡å‹ä¸­å¾—åˆ°è§£å†³</strong>ã€‚å› ä¸ºåœ¨ç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´æ‰€æœ‰çš„ä¿¡æ¯ä¼ é€’è¿˜æ˜¯ç”±ä¸€ä¸ªå•ç‹¬çš„å‘é‡ $h_{avg}$ å®Œæˆçš„ã€‚å®é™…ä¸Šï¼Œç”±äºè¿™ä¸ªæ€»ç»“å‘é‡è¦ç°åœ¨è¦ä¼ é€’çš„ä¿¡æ¯å˜å¾—æ›´å¤šäº†ï¼ˆä»¥å‰åªç”¨ä¼ é€’æ—¶åˆ» $t$ çš„éšè—çŠ¶æ€ä¸­çš„ä¿¡æ¯ï¼Œç°åœ¨è¦ä¼ é€’æ—¶åˆ» $0$ åˆ° $t$ æ‰€æœ‰éšè—çŠ¶æ€ä¸­çš„ä¿¡æ¯ï¼‰ï¼Œåœ¨è¿™ä¸ªæ¨¡å‹ä¸­<strong>ä¿¡æ¯ç“¶é¢ˆé—®é¢˜åè€Œå˜å¾—æ›´åŠ æ˜¾è‘—äº†</strong>ã€‚</p>

  <p>è¿™ä¸ªæ¨¡å‹è¿˜æœ‰ä¸€ä¸ªç¼ºé™· - å› ä¸ºæˆ‘ä»¬ç›´æ¥å¯¹æ‰€æœ‰æ—¶åˆ»çš„éšè—çŠ¶æ€å–å¹³å‡å€¼ï¼Œç¼–ç å™¨æ¯ä¸ªæ—¶åˆ»çš„éšè—çŠ¶æ€æƒé‡éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™å¹¶ä¸ç¬¦åˆå®é™…è§£å†³é—®é¢˜æ—¶çš„ç»éªŒ - å½“æˆ‘ä»¬åœ¨ç¿»è¯‘å¥å­çš„ç¬¬ $i$ ä¸ªè¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€åªä¼šå…³å¿ƒåŸå¥ä¸­ç‰¹å®šçš„ä¸€ä¸¤ä¸ªè¯ã€‚</p>

  <p><strong>æ€»ç»“ï¼š</strong></p>

  <p>å¯¹äºç›´æ¥å°†ç¼–ç å™¨éšè—çŠ¶æ€å–å¹³å‡åä¼ é€’ç»™è§£ç å™¨çš„æ¨¡å‹ï¼Œæœ‰ä»¥ä¸‹è¿™äº›ä¼˜ç¼ºç‚¹ï¼š</p>

  <ul>
    <li>:+1: è§£ç å™¨æ¥æ”¶åˆ°äº†ç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€çš„ä¿¡æ¯</li>
    <li>:-1: ç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´çš„ä¿¡æ¯ç“¶é¢ˆé—®é¢˜å˜å¾—æ›´åŠ æ˜¾è‘—</li>
    <li>:-1: ç¼–ç å™¨æ¯ä¸ªæ—¶åˆ»çš„éšè—çŠ¶æ€æƒé‡ä¸€æ ·ï¼Œè§£ç å™¨åœ¨è§£ç æ—¶æ²¡æœ‰â€œé‡ç‚¹â€ã€‚</li>
  </ul>

  <h2 id="attention-mechanism--">Attention Mechanism ï½œ æ³¨æ„åŠ›æœºåˆ¶</h2>

  <p>æ—¢ç„¶ç›´æ¥å¯¹æ‰€æœ‰ç¼–ç å™¨éšè—çŠ¶æ€ç›´æ¥å–å¹³å‡ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ä¹ˆæœ‰å¯èƒ½ç»™è§£ç å™¨åœ¨æ¯ä¸€æ—¶åˆ»éƒ½è¾“å…¥ä¸€ä¸ªç‹¬ç‰¹çš„ï¼Œæ‰€æœ‰ç¼–ç å™¨éšè—çŠ¶æ€çš„åŠ æƒå¹³å‡å€¼å‘¢ï¼Ÿè¿™ç§åŠ¨æ€åŠ æƒå¹³å‡å°±æ˜¯ Attention æœºåˆ¶çš„æ ¸å¿ƒæ€è·¯</p>

  <figure>
    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_485EC646512E-1.jpeg" alt="IMG_485EC646512E-1" /></p>
    <figcaption>Fig 3. å‡å¦‚è§£ç å™¨ç”Ÿæˆçš„åºåˆ—é•¿åº¦ä¸º$n$ï¼Œæˆ‘ä»¬ç”Ÿæˆ $n$ ä¸ªä¸åŒçš„æ€»ç»“å‘é‡ï¼Œæ¯ä¸€ä¸ªæ€»ç»“å‘é‡éƒ½æ˜¯å¯¹ç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€çš„åŠ æƒå¹³å‡</figcaption>
  </figure>

  <p>å¯¹äºè§£ç å™¨çš„æ¯ä¸€ä¸ªæ—¶åˆ» $t$ ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨ä¸åŒçš„æƒé‡è®¡ç®—ç¼–ç å™¨ä¸­æ‰€æœ‰éšè—çŠ¶æ€çš„åŠ æƒå¹³å‡ï¼Œå¹¶å°†è®¡ç®—ç»“æœ $c_t$ ä¸è§£ç å™¨åœ¨ $t - 1$ æ—¶åˆ»çš„è¾“å‡º $y_{t-1}$ æ‹¼æ¥ ( concatenate) åä½œä¸ºè§£ç å™¨åœ¨è¯¥æ—¶åˆ»çš„è¾“å…¥ã€‚</p>

  <p>å‡è®¾è¾“å…¥åºåˆ—é•¿åº¦ä¸º $N$ï¼Œåœ¨æ—¶åˆ» $t$ è¾“å…¥åˆ°è§£ç å™¨ä¸­çš„æ€»ç»“å‘é‡ $c_t$ å¯ä»¥è¿™æ ·è¡¨ç¤º</p>

  <p>$$
c_t = \sum_{i=0}^{N}{w_i\cdot h_i}
$$</p>

  <p>å…¶ä¸­ $w_i$ è¢«ç§°ä¸º <strong>æ³¨æ„åŠ›æƒé‡</strong>ï¼ˆAttention Weightï¼‰ã€‚å› ä¸º $w_i$ ä¼šâ€œå¸®åŠ©â€è§£ç å™¨åœ¨è§£ç è¿‡ç¨‹ä¸­â€œé›†ä¸­æ³¨æ„â€åˆ°ç¼–ç å™¨çš„ç‰¹å®šéšè—çŠ¶æ€ä¸Šã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®©æ¨¡å‹å°† â€œæˆ‘æ˜¨å¤©åƒäº†ä¸€ä¸ªè‹¹æœâ€ ç¿»è¯‘ä¸ºè‹±æ–‡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªè‰¯å¥½è®­ç»ƒçš„æ¨¡å‹ä¼šé€šè¿‡æ³¨æ„åŠ›æƒé‡å¸®åŠ©è§£ç å™¨å°†å…¶â€œæ³¨æ„åŠ›â€â€œèšç„¦â€åˆ°ç¼–ç å™¨ç‰¹å®šçš„éšè—çŠ¶æ€ä¸Šã€‚</p>

  <figure>
    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_C6C26F5222FB-1.jpeg" alt="IMG_C6C26F5222FB-1" /></p>
    <figcaption>Fig 4. æ³¨æ„åŠ›æƒé‡å¸®åŠ©è§£ç å™¨åœ¨ç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€ä¸­â€œé€‰æ‹©æ€§è·å–â€æ‰€éœ€çš„ä¿¡æ¯</figcaption>
  </figure>

  <blockquote>
    <p>ä¸Šå›¾çš„ä¸€äº›è§£é‡Šï¼š</p>

    <p><code class="language-plaintext highlighter-rouge">&lt;SOS&gt;</code> è¡¨ç¤º â€œStart of Sequenceâ€ - æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ª token å‘æ¨¡å‹è¡¨ç¤ºâ€œå¯ä»¥å¼€å§‹è§£ç äº†â€ã€‚</p>

    <p>ä¸ºäº†å¾—åˆ°è‹±æ–‡ç¿»è¯‘ç»“æœçš„ä¸»è¯­ â€œIâ€ ï¼Œæ¨¡å‹è·å–<strong>åªéœ€è¦ä¸­æ–‡è¾“å…¥çš„ä¸»è¯­ â€œæˆ‘â€</strong> å°±æœ‰è¶³å¤Ÿçš„ä¿¡æ¯äº†ï¼Œæ‰€ä»¥ $c_0$ çš„æ³¨æ„åŠ›æƒé‡åªåœ¨ â€œæˆ‘â€ è¾“å…¥çš„éšè—çŠ¶æ€ $h_0$ ä¸Šæœ‰è¾ƒå¤§æƒé‡</p>

    <p>è¦å¾—åˆ°è‹±æ–‡ç¿»è¯‘ç»“æœä¸­çš„è°“è¯­ â€œateâ€ï¼Œè§£ç å™¨<strong>ä¸ä½†è¦çŸ¥é“ä¸­æ–‡çš„è°“è¯­ â€œåƒâ€</strong> ï¼Œè¿˜è¦çŸ¥é“ <strong>ä¸­æ–‡è¾“å…¥çš„æ—¶æ€ â€œæ˜¨å¤©â€ï¼ˆè¿‡å»ï¼‰ï¼Œâ€œäº†â€ï¼ˆåŠ¨ä½œå·²ç»å®Œæˆï¼‰</strong>ã€‚æ‰€ä»¥ $c_1$ çš„æ³¨æ„åŠ›æƒé‡è™½ç„¶åœ¨ $h_2$ - â€œåƒâ€ ä¸Šæœ€é«˜ï¼Œåœ¨ $h_1$ ï¼ˆâ€œæ˜¨å¤©â€ï¼‰ä¸ $h_3$ ï¼ˆâ€œäº†â€ï¼‰ ä¹Ÿæ˜¾è‘—å¤§äºå…¶å®ƒå€¼ã€‚</p>
  </blockquote>

  <p>æ³¨æ„åŠ›æœºåˆ¶å¯ä»¥åŒæ—¶è§£å†³ <code class="language-plaintext highlighter-rouge">Seq2Seq</code> æ¨¡å‹ä¸­çš„ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š</p>

  <ol>
    <li>
      <p><em>ä¿¡æ¯ç“¶é¢ˆé—®é¢˜</em> - é€šè¿‡ä¸åŒçš„æ³¨æ„åŠ›æƒé‡ï¼Œç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´ä¼šä¼ é€’ $n$ ä¸ªä¸åŒçš„æ€»ç»“å‘é‡ã€‚è¿™å¤§å¤§æ‹“å®½äº†ç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´çš„ä¿¡æ¯é€šé“ã€‚</p>
    </li>
    <li>
      <p><em>ä¸­é—´ä¿¡æ¯ä¸¢å¤±é—®é¢˜</em> - æ³¨æ„åŠ›æƒé‡æœºåˆ¶ç†è®ºä¸Šå…è®¸è§£ç å™¨è·å¾—ç¼–ç å™¨ä¸­çš„ä»»æ„éšè—çŠ¶æ€ã€‚</p>
    </li>
  </ol>

  <p>é‚£ä¹ˆï¼Œè¿™ä¸ªèƒ½å¤Ÿå¸®åŠ©è§£ç å™¨â€œé›†ä¸­æ³¨æ„â€çš„ç¥å¥‡â€œæ³¨æ„åŠ›æƒé‡â€åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>

  <h2 id="attention-mechanism-q-k-v">Attention Mechanism çš„å®ç°ä¸q, K, Vè¡¨ç¤ºæ³•</h2>

  <p>è™½ç„¶åœ¨ç¬¬ä¸€ä¸ªæå‡ºæ³¨æ„åŠ›æœºåˆ¶çš„è®ºæ–‡ <a href="https://arxiv.org/pdf/1409.0473.pdf"><em>Neural Machine Translation by Jointly Learning to Align and Translate</em></a> ä¸­ï¼Œä½œè€…å¹¶æ²¡æœ‰ä½¿ç”¨ query-Key-Value (q, K, V)çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå°†æ³¨æ„åŠ›æœºåˆ¶çœŸæ­£å‘æ‰¬å…‰å¤§çš„è®ºæ–‡ <a href="https://proceedings.neurips.cc/paper/2017/file/3f5ee243547dee91fbd053c1c4a845aa-Paper.pdf"><em>Attention is All You Need</em></a> ä¸­æå‡ºçš„ q, K, V è¡¨ç¤ºæ–¹æ³•ä¸€å®šç¨‹åº¦ä¸Šæˆä¸ºäº†äº‹å®ä¸Šçš„â€œæ ‡å‡†â€ã€‚</p>

  <p>Fig 4. ä¸­çš„æ¨¡å‹å®é™…ä¸Šæ˜¯ä¸€ç§ç®€åŒ–çš„è¡¨ç¤ºæ–¹æ³•ã€‚åœ¨å®é™…å®ç°æ³¨æ„åŠ›æœºåˆ¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šè®©ç¼–ç å™¨åœ¨å¯¹æ¯ä¸€ä¸ªè¾“å…¥ $x_t$ è¾“å‡ºä¸€å¯¹ Key-value pair $K_t$ ä¸ $V_t$ã€‚å¯¹äºè§£ç å™¨
çš„æ¯ä¸€ä¸ªéšè—çŠ¶æ€ $s_t$ï¼Œæˆ‘ä»¬ä¼šè®©è§£ç å™¨åœ¨è¾“å‡º $y_t$ çš„åŒæ—¶è¾“å‡ºä¸€ä¸ª query å€¼ $q_{t + 1}$ã€‚</p>

  <p>å‡å¦‚æˆ‘ä»¬åœ¨è§£ç å™¨è¾“å‡ºå®Œç¬¬ $t-1$ ä¸ªtokenåæœ‰</p>

  <p>$$
K = \left\langle K_0, K_1, \cdots, K_m \right\rangle
$$</p>

  <p>$$
V = \left\langle V_0, V_1, \cdots, V_m \right\rangle
$$</p>

  <p>$$
e^t_i = g(K_i, q_t)
$$</p>

  <p>é‚£ä¹ˆ $c_t$ å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼è®¡ç®—ï¼š</p>

  <p>$$
e^t = \left\langle g(k_0, q_t), g(k_1, q_t), \cdots, g(k_m, q_t)\right\rangle
$$</p>

  <p>$$
w^t = Softmax (e^t)
$$</p>

  <p>$$
c_t = w^t\cdot V
$$</p>

  <p>å†™æˆä¼ªä»£ç çš„å½¢å¼ï¼Œæˆ‘ä»¬æœ‰</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func compute_context(q: Mat, K: Vec&lt;Mat&gt;, V: Vec&lt;Mat&gt;)
    e = new Vec&lt;float&gt;(m)
    for t = 1:m
        e[t] = raw_attention(q, K[t])   # Function 'g' in math above
    end

    w = softmax(e)

    c = new Mat&lt;float&gt;  # Initialize c as a zero tensor
    for t = 1:m
        c += w[t] * V[t]
    end
    return c
end
</code></pre></div>  </div>
  <figure>
    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_536CF3684689-1.jpeg" alt="IMG_536CF3684689-1" /></p>
    <figcaption>Fig 5. ä½¿ç”¨ qï¼ŒKï¼ŒV ç»“æ„å®ç°çš„ Attention æ¨¡å‹</figcaption>
  </figure>

  <p>ç°åœ¨æˆ‘ä»¬ç¦»å®Œå…¨å®ç°ä¸€ä¸ªæ³¨æ„åŠ›ç»“æ„åªå‰©ä¸‹ä¸€æ­¥ä¹‹é¥äº† - åœ¨ä¸Šé¢çš„ä¼ªä»£ç ä¸­æœ‰ä¸€ä¸ªç¥å¥‡çš„å‡½æ•° <code class="language-plaintext highlighter-rouge">raw_attention</code> - ç»™å®šä¸€ä¸ª query å¼ é‡ä¸ Key å¼ é‡ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°è¡¨ç¤ºåˆ†é…åˆ°è¿™ä¸ª Key æ‰€å¯¹åº”çš„ Value å¼ é‡ä¸Šçš„æ³¨æ„åŠ›æƒé‡ã€‚</p>

  <p>è¿™ä¸ªå‡½æ•°çš„å®ç°å‡ºäººæ„æ–™çš„ç®€å•ï¼šå¯¹äºä¸¤ä¸ªå‘é‡ $K$ ä¸ $q$ï¼Œå®ƒä¼šè¿”å›è¿™ä¸¤ä¸ªå‘é‡çš„ç‚¹ä¹˜ç»“æœã€‚</p>

  <p>$$
g(K, q) = \frac{k_i\cdot q}{\sqrt{\dim{k_i}}}
$$</p>

  <div class="notification">
    <h4 hide-toc="true" style="margin-top: 0">2021/01/11 Update</h4>

    <p>è¿™é‡Œæˆ‘ä»¬åœ¨ä¹˜æ³•è¿ç®—å®Œäº†ä»¥åè¿˜è¦å¯¹ç»“æœè¿›è¡Œä¸€ä¸ªç¼©æ”¾ - i.e. ä¸Šé¢å…¬å¼ä¸­é™¤ä»¥ $\sqrt{\dim{k_i}}$ çš„æ­¥éª¤ã€‚è¿™æ˜¯ä¸ºäº†å¾—åˆ°æ›´åŠ å¹³æ»‘çš„å‚æ•°æ¢¯åº¦ã€‚<a href="https://towardsdatascience.com/illustrated-guide-to-transformers-step-by-step-explanation-f74876522bc0">Source</a></p>

    <p>å¯¹ Raw Attention Score è¿›è¡Œ Softmax è€Œä¸æ˜¯ç›´æ¥æ­£åˆ™åŒ– ($w_i = \frac{w_i}{\sum_{w}}$) åˆ™æ˜¯ä¸ºäº†è®©æ­£åˆ™åŒ–åçš„ç»“æœâ€œå¤§çš„å€¼æ›´å¤§ï¼Œå°çš„å€¼æ›´å°â€ï¼Œè®©æ¨¡å‹æ›´åŠ ç¨³å®šï¼ˆè¾“å‡ºçš„ç»“æœæ›´åŠ ç¡®å®šï¼‰ã€‚<a href="https://towardsdatascience.com/illustrated-guide-to-transformers-step-by-step-explanation-f74876522bc0">Source</a></p>
  </div>

  <div class="notification">
    <h4 hide-toc="true" style="margin-top: 0;">2021/01/09 Update</h4>

    <p>ç›´æ¥å°† $K$ ä¸ $q$ ç‚¹ä¹˜æ˜¯æœ€ç®€å•çš„ Attention Weight è®¡ç®—å‡½æ•°ï¼Œå…¶å®ƒå‡½æ•°åŒ…æ‹¬</p>

    <p>$$
g(k_i, q) = q^{\top}Wk_i
$$</p>

    <p>å…¶ä¸­ï¼Œ$W$ æ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„å‚æ•°æƒé‡çŸ©é˜µã€‚</p>
  </div>

  <h2 id="section">æ³¨æ„åŠ›æƒé‡çš„åˆ†å¸ƒï¼šè‹±è¯­-æ³•è¯­ç¿»è¯‘æ¨¡å‹ä¸­çš„ä¾‹å­</h2>

  <p>åœ¨ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°æ³¨æ„åŠ›æƒé‡çš„å€¼ä¸»è¦åˆ†å¸ƒåœ¨å¯¹è§’çº¿ä¸Š â€”â€” è¿™æ˜¯å› ä¸ºè‹±è¯­å’Œæ³•è¯­å¥å­ä¸­çš„è¯­åºåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç›¸ä¼¼çš„ã€‚è¿™ä¹Ÿè¯æ˜æ³¨æ„åŠ›æƒé‡ç¡®å®å¯ä»¥å­¦ä¹ åˆ°è¾“å…¥ä¸è¾“å‡ºä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p>

  <figure>
    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/20220105120525.png" alt="20220105120525" /></p>
    <figcaption>Fig 6. è‹±è¯­-æ³•è¯­ æœºå™¨ç¿»è¯‘æ¨¡å‹ä¸­çš„æ³¨æ„åŠ›æƒé‡</figcaption>
  </figure>
</figure>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Neural Network&quot;]" /><category term="NLP" /><category term="Neural Network" /><summary type="html"><![CDATA[Seq2Seq æ¨¡å‹çš„é—®é¢˜]]></summary></entry><entry xml:lang="ch"><title type="html">NLP 101: Seq2Seq æ¨¡å‹</title><link href="https://markchenyutian.github.io//blog/2021/Seq2Seq.html" rel="alternate" type="text/html" title="NLP 101: Seq2Seq æ¨¡å‹" /><published>2021-12-28T00:00:00+00:00</published><updated>2021-12-28T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2021/Seq2Seq</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2021/Seq2Seq.html"><![CDATA[<h2 id="0-å››ç§æ—¶é—´åºåˆ—é—®é¢˜">0 å››ç§æ—¶é—´åºåˆ—é—®é¢˜</h2>

<p>åœ¨ä¸æ—¶é—´åºåˆ—ç›¸å…³çš„é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡â€œæ—¶åºå¯¹é½ï¼ˆAlignmentï¼‰â€ä¸â€œæ—¶åºåŒæ­¥æ€§ï¼ˆSynchronousï¼‰â€ä¸¤ä¸ªç»´åº¦å°†æ‰€æœ‰é—®é¢˜åˆ†ä¸ºå››ä¸ªä¸åŒçš„ç±»å‹</p>

<table>
  <tbody>
    <tr>
      <td>Â </td>
      <td>**å¯¹é½**</td>
      <td>**ä¸å¯¹é½**</td>
    </tr>
    <tr>
      <td>Â </td>
      <td>&lt;img src="https://markdown-img-1304853431.file.myqcloud.com/Screen%20Shot%202021-12-29%20at%2011.41.39%20AM.png" style="height: 100px;"/&gt;</td>
      <td>\</td>
    </tr>
    <tr>
      <td>**åŒæ­¥**</td>
      <td>è¾“å…¥æ—¶åŒæ—¶è¾“å‡ºï¼Œä¸€å¸§è¾“å…¥ä¸ä¸€å¸§è¾“å‡ºå¯¹åº”ï¼ˆè§†é¢‘æ ‡æ³¨ï¼‰</td>
      <td>\</td>
    </tr>
    <tr>
      <td>Â </td>
      <td>æ¨¡å‹ï¼šLSTMï¼ŒNaive RNN</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>Â </td>
      <td>&lt;img src="https://markdown-img-1304853431.file.myqcloud.com/Screen%20Shot%202021-12-29%20at%2011.45.28%20AM.png" style="height: 100px"/&gt;</td>
      <td>&lt;img src="https://markdown-img-1304853431.file.myqcloud.com/Screen%20Shot%202021-12-29%20at%2011.43.43%20AM.png" style="height: 100px;"/&gt; \</td>
    </tr>
    <tr>
      <td>**ä¸åŒæ­¥**</td>
      <td>è¾“å…¥ä¸è¾“å‡ºçš„é¡ºåºç›¸åŒï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰</td>
      <td>è¾“å…¥ä¸€ä¸ªåºåˆ—ï¼Œåœ¨æ•´ä¸ªè¾“å…¥å®Œæˆåè¾“å‡ºä¸€ä¸ªé¡ºåºä¸ä¸€å®šå¯¹åº”çš„åºåˆ— ï¼ˆæœºå™¨ç¿»è¯‘ï¼‰ \</td>
    </tr>
    <tr>
      <td>Â </td>
      <td>æ¨¡å‹ï¼šConnectionist Temporal Classification (CTC)</td>
      <td>æ¨¡å‹ï¼š**Seq2Seq**</td>
    </tr>
  </tbody>
</table>

<p>ä¸‹æ–‡æåˆ°çš„ Seq2Seq æ¨¡å‹æ˜¯å¤„ç†â€œä¸å¯¹é½ï¼Œä¸åŒæ­¥â€åºåˆ—é—®é¢˜çš„ä¸€ç§æ¨¡å‹ã€‚ä¸€ä¸ªå…¸å‹çš„ä¸å¯¹é½ä¸åŒæ­¥é—®é¢˜æ˜¯æœºå™¨ç¿»è¯‘ã€‚</p>

<p>å‡å¦‚æˆ‘ä»¬è¦è®©æ¨¡å‹å°†è‹±è¯­ â€œI ate an appleâ€ ç¿»è¯‘ä¸ºå¾·è¯­ â€œIch habe einen apfel gegessenâ€ï¼Œæˆ‘ä»¬ä¼šå‘ç°ç¿»è¯‘ç»“æœä¸­çš„è¯­åºå’ŒåŸæ¥å¹¶ä¸ç›¸åŒï¼ŒåŒæ—¶ï¼Œä¸€äº›ç¿»è¯‘ç»“æœå¹¶ä¸èƒ½ä¸è‹±è¯­ä¸­çš„è¯æ±‡ä¸€ä¸€å¯¹åº”åˆ°ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/Screen%20Shot%202021-12-29%20at%2011.52.07%20AM.png" alt="Screen Shot 2021-12-29 at 11.52.07 AM" style="zoom:50%;" /></p>

<center>Fig 1. æœºå™¨ç¿»è¯‘è¾“å…¥ä¸è¾“å‡ºå¹¶æ²¡æœ‰ç®€å•çš„ä¸€ä¸€å¯¹åº”å…³ç³» ï½œ å›¾ç‰‡æ¥æºï¼šCMU 11-785 Lecture 18 page 5</center>

<h2 id="1-å¦‚ä½•ç¡®ä¿æ¨¡å‹è·å¾—äº†æ‰€éœ€çš„ä¿¡æ¯">1 å¦‚ä½•ç¡®ä¿æ¨¡å‹è·å¾—äº†æ‰€éœ€çš„ä¿¡æ¯ï¼Ÿ</h2>

<p>åœ¨ä¸å¯¹é½ä¸åŒæ­¥é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨LSTMè¿™æ ·çš„æ¨¡å‹ï¼Œå› ä¸ºåœ¨æ—¶é—´åºåˆ—çš„ $t$ æ—¶åˆ»ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šæ­¤æ—¶çš„æ¨¡å‹æ˜¯å¦å·²ç»è·å¾—äº†æ‰€æœ‰è¾“å‡ºæ­£ç¡®ç»“æœæ‰€éœ€è¦çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š<strong>å…ˆå¤„ç†å®Œæ‰€æœ‰çš„è¾“å…¥ï¼Œå°†æ‰€æœ‰è¾“å…¥ç¼–ç ï¼ˆencodeï¼‰åˆ°ä¸€ä¸ªéšè—çŠ¶æ€ï¼ˆHidden Stateï¼‰ï¼Œç„¶åå†é€æ­¥å¯¹è¿™ä¸ªéšè—çŠ¶æ€è¿›è¡Œè§£ç ï¼ˆdecodeï¼‰</strong>ã€‚</p>

<p>é€šè¿‡è¿™æ ·çš„ç»“æ„ï¼Œæˆ‘ä»¬èƒ½ç¡®å®šåœ¨è§£ç è¿‡ç¨‹ä¸­æ¨¡å‹ä¸€å®šæ”¶åˆ°äº†æ‰€æœ‰æ‰€éœ€çš„ä¿¡æ¯ã€‚</p>

<p>åœ¨è¿è¡Œè¿™ä¸ªæ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸¤ä¸ªå°é—®é¢˜æ²¡æœ‰è§£å†³</p>

<ol>
  <li>å¦‚ä½•è®©æ¨¡å‹çŸ¥é“å½“å‰çš„è¾“å…¥å·²ç»ç»“æŸäº†ï¼Œå¯ä»¥å¼€å§‹è§£ç éšè—çŠ¶æ€äº†</li>
  <li>ä¸€ä¸ªé€’å½’ç¥ç»ç½‘ç»œç†è®ºä¸Šå¯ä»¥ç»™å‡ºæ— é™é•¿çš„è¾“å‡ºåºåˆ—ï¼Œæˆ‘ä»¬åº”è¯¥æ€æ ·è·çŸ¥æ¨¡å‹å·²ç»å®Œæˆäº†å¯¹éšè—çŠ¶æ€çš„è§£ç ï¼Œå¹¶åœæ­¢æ¥å—æ¨¡å‹çš„è¾“å‡ºï¼Ÿ</li>
</ol>

<p>å®é™…ä¸Šè¿™ä¸¤ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸€è‡´çš„ - æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡å‹çš„è¯æ±‡è¡¨ä¸­æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„ token - <code class="language-plaintext highlighter-rouge">&lt;EOS&gt;</code> è¿™ä¸ª token ä»£è¡¨â€œEnd Of Sentenceâ€ã€‚å½“æˆ‘ä»¬å‘æ¨¡å‹è¾“å…¥ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">&lt;EOS&gt;</code> æ—¶ï¼Œæ¨¡å‹å°±çŸ¥é“å½“å‰è¾“å…¥å·²ç»ç»“æŸï¼Œå¹¶å¼€å§‹è¾“å‡ºéšè—çŠ¶æ€çš„è§£ç ç»“æœã€‚</p>

<p>å½“æ¨¡å‹åœ¨è§£ç é˜¶æ®µè¾“å‡º <code class="language-plaintext highlighter-rouge">&lt;EOS&gt;</code> æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·çŸ¥æ¨¡å‹å·²ç»å®Œæˆäº†å¯¹éšè—çŠ¶æ€çš„è§£ç ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_46AF89134238-1.jpeg" alt="IMG_46AF89134238-1" /></p>

<center>Fig 2. ä¸€ç§èƒ½å¤Ÿç¡®ä¿æ¨¡å‹åœ¨è¾“å‡ºé˜¶æ®µè·å¾—äº†æ‰€æœ‰æ‰€éœ€ä¿¡æ¯çš„æ¨¡å‹</center>

<h2 id="2-ç¡®ä¿è§£ç ç»“æœçš„ä¸Šä¸‹æ–‡ç›¸å…³æ€§">2 ç¡®ä¿è§£ç ç»“æœçš„ä¸Šä¸‹æ–‡ç›¸å…³æ€§</h2>

<p>ä¸Šé¢çš„æ¨¡å‹åœ¨è§£å†³äº†è¾“å…¥ä¿¡æ¯å®Œæ•´æ€§çš„åŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºé™·ï¼šåœ¨è§£ç é˜¶æ®µä¸­ï¼Œ<strong>æ¯ä¸€ä¸ªè¾“å‡ºåªå’Œå½“å‰éšè—çŠ¶æ€æœ‰å…³ï¼Œä¸ä¹‹å‰çš„è¾“å‡ºæ²¡æœ‰è”ç³»</strong>ã€‚</p>

<p>åœ¨ç°å®é—®é¢˜ä¸­ï¼Œæ¨¡å‹è¾“å‡ºçš„åºåˆ—ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸Šä¸‹æ–‡ç›¸å…³æ€§ - ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŸ¥é“æ¨¡å‹åœ¨ $t - 1$ æ—¶åˆ»çš„è¾“å‡ºä¼šæ”¹å˜æ¨¡å‹åœ¨ $t$ æ—¶åˆ»è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒ - $P(w_t \mid w_{t-1}) \neq P(w_t)$ã€‚æ¯”å¦‚åœ¨æœºå™¨ç¿»è¯‘çš„ä»»åŠ¡ä¸­ï¼Œå¦‚æœç¬¬ $t - 1$ ä¸ªè¯æ˜¯ â€œanâ€ï¼Œé‚£ä¹ˆç¬¬ $t$ ä¸ªè¯æ˜¯ $dark$ çš„æ¦‚ç‡å°±åº”è¯¥å¾ˆå¾ˆä½ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¨¡å‹åœ¨ $t-1$ æ—¶åˆ»çš„è¾“å‡ºä½œä¸ºæ¨¡å‹çš„è¾“å…¥ä¼ é€’åˆ° $t$ æ—¶åˆ»ã€‚è¿™æ ·å¸¦æ¥çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š</p>

<ol>
  <li>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ $t$ æ—¶åˆ»ä¸ $t - 1$ æ—¶åˆ»å»ºç«‹è”ç³»</li>
  <li>åœ¨è§£ç è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹åœ¨è¿‡å»æ—¶åˆ»çš„è¾“å‡ºä¹Ÿä¼šè¢«ç¼–ç åˆ°æ¨¡å‹çš„hidden stateä¸­ï¼Œæ‰€ä»¥æ¨¡å‹å¯ä»¥â€œçŸ¥é“â€è‡ªå·±åœ¨æ•´ä¸ªè§£ç é˜¶æ®µä¸­æ›¾ç»è¾“å‡ºè¿‡ä»€ä¹ˆå†…å®¹ã€‚</li>
</ol>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_C2214BB4110E-1.jpeg" alt="IMG_C2214BB4110E-1" /></p>

<center>Fig 3. ä¸€ç§èƒ½å¤Ÿè€ƒè™‘åˆ°è§£ç ç»“æœä¸Šä¸‹æ–‡ç›¸å…³æ€§çš„ Encoder-Decoder æ¨¡å‹</center>

<p>åœ¨å›¾ä¸‰è¿™ç§æ¨¡å‹ä¸­ï¼Œæ¥å—è¾“å…¥çš„éƒ¨åˆ†è¢«ç§°ä¸º<strong>ç¼–ç å™¨ï¼ˆEncoderï¼‰</strong>ã€‚ç¼–ç å™¨ä¼šâ€œæ€»ç»“â€è¾“å…¥å†…å®¹å¹¶å°†ç»“æœæ€»ç»“åˆ°è‡ªå·±çš„éšè—çŠ¶æ€ä¸­ã€‚å½“ç¼–ç å™¨æ¥å—å®Œæ•´ä¸ªè¾“å…¥åï¼Œå…¶éšè—çŠ¶æ€è¢«ç§°ä¸º â€œSummary Vectorâ€ï¼Œå› ä¸ºè¿™ä¸ªå¼ é‡åŒ…å«äº†æ•´ä¸ªè¾“å…¥çš„è¯­ä¹‰ã€‚</p>

<p>æ¥ç€ï¼ŒSummary Vector è¢«ä¼ é€’åˆ°äº†<strong>è§£ç å™¨ï¼ˆDecoderï¼‰</strong>çš„éšè—çŠ¶æ€ã€‚è§£ç å™¨ä¼šè§£æä¼ å…¥çš„éšè—çŠ¶æ€å¹¶ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼‰ç»™å‡ºç¿»è¯‘ç»“æœã€‚</p>

<p>è¿™æ ·ä¸€ç§ç”± Encoder å’Œ Decoder æ„æˆçš„æ¨¡å‹å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ Seq2Seq æ¨¡å‹äº†ã€‚</p>

<h2 id="3-seq2seq-æ¨¡å‹ä¸è¯åµŒå…¥---æˆ‘ä»¬å¦‚ä½•è§£è¯»è§£ç ç»“æœ">3 Seq2Seq æ¨¡å‹ä¸è¯åµŒå…¥ - æˆ‘ä»¬å¦‚ä½•è§£è¯»è§£ç ç»“æœï¼Ÿ</h2>

<blockquote>
  <p>Partially Adapted from 11-785 Lec. 18 Notes P45 - P56</p>
</blockquote>

<blockquote>
  <p><a href="/blog/2021/Word-Embedding.html">è¯åµŒå…¥ (Word Embedding)</a> æ˜¯ä¸€ç§å°†é«˜ç»´åº¦çš„ï¼Œä½¿ç”¨ One-hot ç¼–ç çš„è¯æ±‡è¡¨åµŒå…¥åˆ°ä½ç»´ç©ºé—´çš„æ–¹æ³•ã€‚è¿™é‡Œæ³›æŒ‡ç”¨å‘é‡è¡¨ç¤ºè‡ªç„¶è¯­è¨€ã€‚</p>
</blockquote>

<p>è§£ç å™¨åœ¨è¿è¡Œæ—¶ä¼šè¾“å‡ºå‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œæŸ¥è¡¨â€çš„æ–¹æ³•å°†è‡ªç„¶è¯­è¨€è½¬åŒ–ä¸ºå‘é‡ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•å»è§£è¯»è§£ç å™¨è¾“å‡ºçš„ç»“æœæ¥å°†å‘é‡è½¬åŒ–å›è‡ªç„¶è¯­è¨€å‘¢ï¼Ÿ</p>

<p><em>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬åœ¨ä¸‹æ–‡ä¸­å…ˆå‡è®¾æ‰€æœ‰è¯æ±‡éƒ½æ˜¯é€šè¿‡ one-hot æ–¹å¼ç¼–ç çš„ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ $y_t^{A}$ æè¿°åœ¨æ—¶åˆ»æ¨¡å‹åœ¨æ—¶åˆ» $t$ è¾“å‡ºçš„å‘é‡ä¸­è¡¨è¿°è¯æ±‡ä¸º $A$ çš„æ¦‚ç‡</em>ã€‚</p>

<p>ä»»æ„ä¸€ç§è§£è¯»è§£ç ç»“æœçš„ç›®æ ‡éƒ½æ˜¯ä¸€æ ·çš„ - å¯¹äºè§£ç å™¨ç»™å‡ºçš„ä¸€ä¸²å‘é‡è¾“å‡º $y_1, \cdots, y_t$ï¼Œæˆ‘ä»¬è¦ä»ä¸­æ‰¾åˆ°å¯¹åº”çš„è¯æ±‡ $O_1, \cdots, O_n$ ä½¿å¾— $P(O_1, \cdots, O_n \mid x_1,\cdots, x_m)$ æœ€å¤§åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›è§£è¯»æ–¹æ³•èƒ½å¤Ÿåšåˆ°ä¸‹é¢è¿™æ ·çš„æ•ˆæœï¼š</p>

<p>$$
\text{argmax}_{O_1, \cdots, O_n}(y_1^{O_1}\cdots y_n^{O_n})
$$</p>

<h3 id="31-è´ªå¿ƒç®—æ³•è§£è¯»è§£ç ç»“æœ">3.1 è´ªå¿ƒç®—æ³•è§£è¯»è§£ç ç»“æœ</h3>

<p>ä¸€ç§ç®€å•çš„æ€è·¯æ˜¯ä½¿ç”¨<strong>è´ªå¿ƒç®—æ³•</strong> - åœ¨æ¯ä¸€æ—¶åˆ» $t$ï¼Œæˆ‘ä»¬éƒ½é€‰æ‹©å½“å‰è¾“å‡ºå‘é‡ $y_t$ æ‰€ä»£è¡¨çš„ï¼Œï¼ˆç›¸ä¼¼åº¦ï¼‰æ¦‚ç‡æœ€é«˜çš„è¯å‘é‡ $O$ ä½œä¸º $O_t$ çš„è§£è¯»ç»“æœã€‚</p>

<p>$$
\DeclareMathOperator*{\argmax}{argmax}
O_t = \argmax_{O_t}(y_t^{O_t})
$$</p>

<p>ç„¶è€Œï¼Œè¿™æ ·çš„æ–¹æ³•æœ‰ä¸€ä¸ªå¼Šç«¯ï¼šå¦‚æœåœ¨æ—¶åˆ» $t$ æ¨¡å‹çš„æœ€ä¼˜è¾“å‡ºå¹¶ä¸æ˜¯æ­£ç¡®çš„ç»“æœï¼Œä» $t + 1$ å¼€å§‹çš„æ¯ä¸ªæ—¶åˆ»ï¼Œæ¨¡å‹éƒ½ä¼šå—åˆ°è¿™æ ·ä¸€ä¸ªé”™è¯¯è¾“å‡ºçš„å½±å“ï¼Œæœ€åå¯¼è‡´æ¨¡å‹â€œè¶Šèµ°è¶Šåâ€ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_917415594339-1.jpeg" alt="" /></p>

<center>Fig 4.  ç›´æ¥ä½¿ç”¨è´ªå¿ƒç®—æ³•å¯¹è§£ç å™¨è¾“å‡ºè¿›è¡Œè§£è¯»å¯èƒ½å¯¼è‡´æœªæ¥çš„åºåˆ—è¢«â€œè¯¯å¯¼â€</center>

<h3 id="32-æ—¢ç„¶ä¸å¤Ÿä¿¡æ¯åšé€‰æ‹©æˆ‘å…¨éƒ½è¦">3.2 æ—¢ç„¶ä¸å¤Ÿä¿¡æ¯åšé€‰æ‹©ï¼Œæˆ‘å…¨éƒ½è¦ï¼</h3>

<p>å¦‚æœå› ä¸ºè´ªå¿ƒç®—æ³•å­˜åœ¨ä¸Šä¸€æ®µæè¿°çš„ç¼ºé™·å°±æ‹’ç»ä½¿ç”¨è´ªå¿ƒç®—æ³•ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š<strong>åœ¨ $t$ æ—¶åˆ»åšå‡ºé”™è¯¯çš„é€‰æ‹©ä¸€å®šä¼šå¯¼è‡´æ•´ä¸ªåºåˆ—çš„é”™è¯¯ä¸åå·®ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ $t$ æ—¶åˆ»å¹¶ä¸çŸ¥é“å“ªä¸ªé€‰æ‹©æ˜¯é”™è¯¯çš„</strong>ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>

<blockquote>
  <p>å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„å¤§è„‘æ¯æ—¶æ¯åˆ»éƒ½åœ¨å¤„ç†åŒæ ·çš„é—®é¢˜ - è‡ªç„¶è¯­è¨€ä¸­å……æ–¥ç€æ¨¡ç³Šæ€§ï¼Œè¿™ç§æ¨¡ç³Šæ€§æ¥è‡ªäºè¯æ³•(Lexical Ambiguity)ï¼Œç»“æ„(Structural Ambiguity) å’Œ è¯­éŸ³(Acoustic Ambiguity) ã€‚è€Œå¤§è„‘åœ¨æ—¥å¸¸äº¤æµä¸­åœ¨æ— æ—¶æ— åˆ»çš„è¿›è¡Œå»æ¨¡ç³ŠåŒ–çš„åŠ¨ä½œã€‚ç”¨äºå»æ¨¡ç³ŠåŒ–çš„ä¿¡æ¯ä¸»è¦æ¥è‡ªäºå¯¹è¯çš„ä¸Šä¸‹æ–‡å’Œåœºæ™¯ã€‚</p>

  <p>ä¹Ÿå°±æ˜¯è¯´ - åœ¨æ—¥å¸¸äº¤æµçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬çš„å¤§è„‘ä¼šå…ˆä¿ç•™æ—¶åˆ» $t$ çš„è¯­è¨€æ¨¡ç³Šæ€§ï¼Œç­‰åˆ°ç§¯ç´¯äº†è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡åå†å¯¹ $t$ æ—¶åˆ»çš„ç»“æœè¿›è¡Œå»æ¨¡ç³ŠåŒ–æ“ä½œã€‚</p>
</blockquote>

<p><strong>ä¹Ÿè®¸ç›¸ä¼¼çš„è¿‡ç¨‹ä¹Ÿèƒ½ç”¨åœ¨æˆ‘ä»¬å¯¹ Seq2Seq æ¨¡å‹çš„è¾“å‡ºè§£è¯»ä¸Šï¼</strong></p>

<p>æ—¢ç„¶æˆ‘ä»¬åœ¨æ—¶åˆ» $t$ æ— æ³•å¾—çŸ¥è¶³å¤Ÿçš„ä¿¡æ¯æ¥åšå‡ºé€‰æ‹©ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±<em>ä¸åšå‡ºé€‰æ‹©</em> - ç›´åˆ°æˆ‘ä»¬ç§¯ç´¯äº†è¶³å¤Ÿå¤šçš„ä¿¡æ¯æ¥åšå‡ºé€‰æ‹©æˆ‘ä»¬å†è¿”å›æ¥ $t$ æ—¶åˆ»è¿›è¡Œå†³æ‹©ã€‚åœ¨æ¯ä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬é€‰æ‹©<strong>æ¦‚ç‡æœ€é«˜çš„$n$ä¸ªè¯å‘é‡</strong>ä½œä¸ºå¯¹è§£ç å™¨åœ¨ $t$ æ—¶åˆ»è¾“å‡ºçš„è§£è¯»ã€‚æˆ‘ä»¬å°†è§£ç å™¨ â€œåˆ†å‰åˆ°ä¸åŒçš„æ—¶é—´çº¿â€ä¸Š - åœ¨æ¯ä¸ªåˆ†å‰ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„è¯å‘é‡ä½œä¸º $t + 1$ æ—¶åˆ»çš„è§£ç å™¨è¾“å…¥ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_3B1063339A5F-1.jpeg" alt="IMG_3B1063339A5F-1" /></p>

<center>Fig 5. æ¯ä¸€ä¸ªæ—¶åˆ»ï¼Œå¦‚æœæ¦‚ç‡æœ€é«˜çš„ä¸¤ä¸ªè§£è¯»ç»“æœæ¦‚ç‡å·®è·ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥å°†è§£ç å™¨â€œåˆ†å‰â€ï¼Œåœ¨ä¸åŒçš„assumption ä¸Šç»§ç»­æ¨ç†å¹¶åœ¨æœªæ¥å›æº¯è‡³è¯¥æ—¶åˆ»è¿›è¡Œé€‰æ‹©</center>

<p>å½“æ¨¡å‹åœ¨æŸä¸ªåˆ†æ”¯ä¸Šè¾“å‡ºäº† <code class="language-plaintext highlighter-rouge">&lt;EOS&gt;</code> è¿™ä¸ªç‰¹æ®Šçš„tokenæ—¶ï¼Œè¿™ä¸ªåˆ†æ”¯å°±ç»“æŸäº†ã€‚å› ä¸º <code class="language-plaintext highlighter-rouge">&lt;EOS&gt;</code> æ˜¯çº¦å®šçš„ç»“æŸè§£ç å™¨è¾“å‡ºåºåˆ—çš„æ ‡å¿—ç¬¦ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_007491957EB3-1.jpeg" alt="IMG_007491957EB3-1" style="zoom: 25%;" /></p>

<center>Fig 6. è§£ç å™¨æ¯ä¸ªæ—¶åˆ»å› ä¸ºå¯¹è§£ç ç»“æœçš„ä¸åŒè§£è¯»äº§ç”Ÿä¸åŒçš„åˆ†å‰ã€‚æ¯ä¸ªåˆ†å‰åœ¨è¾“å‡º<code>&lt;EOS&gt;</code>æ—¶ç»“æŸ</center>

<p>å½“è§£ç å™¨æ‰€æœ‰çš„åˆ†æ”¯éƒ½ç»“æŸè¾“å‡ºä»¥åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸€ä¸ªåˆ†æ”¯è¾“å‡ºçš„åºåˆ—è¿›è¡Œè¯„ä¼°å¹¶åœ¨å…¶ä¸­é€‰æ‹©æœ€ä¼˜çš„åºåˆ—ã€‚</p>

<blockquote>
  <p>å› ä¸ºåˆ†æ”¯çš„æ•°é‡éšåºåˆ—é•¿åº¦æˆæŒ‡æ•°ä¸Šå‡ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨è¯„ä¼°æ—¶ä½¿ç”¨ä¸€ç§å« <a href="https://en.wikipedia.org/wiki/Beam_search">Beam Search</a> çš„å¯å‘å¼æœç´¢ç®—æ³•å¯¹éœ€è¦è¯„ä¼°çš„åˆ†æ”¯è¿›è¡Œå‰ªæã€‚</p>
</blockquote>

<h2 id="4-seq2seq-æ¨¡å‹çš„è®­ç»ƒ">4 Seq2Seq æ¨¡å‹çš„è®­ç»ƒ</h2>

<p>åœ¨è®­ç»ƒ Seq2Seq æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬ä¸ç”¨å¯¹æ¨¡å‹åœ¨ç¼–ç é˜¶æ®µçš„è¾“å‡ºåšä»»ä½•è¯„ä¼°ã€‚æˆ‘ä»¬åªéœ€è¦å¯¹æ¯”æ¨¡å‹åœ¨è§£ç é˜¶æ®µç»™å‡ºçš„è¾“å‡ºå³å¯ã€‚</p>

<p>åœ¨è®­ç»ƒé˜¶æ®µï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šå°†è§£ç å™¨åœ¨ $t - 1$ æ—¶åˆ»çš„è¾“å‡ºä½œä¸ºè¾“å…¥ä¼ è¾“ç»™ $t$ æ—¶åˆ»ï¼ˆæˆ‘ä»¬åœ¨æ¨¡å‹æ¨ç†é˜¶æ®µä¼šè¿™ä¹ˆåšæ¥å»ºç«‹æ¨¡å‹è¾“å‡ºçš„ä¸Šä¸‹æ–‡è”ç³»ï¼‰ã€‚æˆ‘ä»¬ä¼šç›´æ¥å°†æ­£ç¡®çš„ ground truth  ä¸­çš„ç¬¬ $t - 1$ æ—¶åˆ»çš„å†…å®¹ä½œä¸ºè¾“å…¥ä¼ è¾“ç»™ $t$ æ—¶åˆ»ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_58B92A9252D3-1.jpeg" alt="IMG_58B92A9252D3-1" /></p>

<center>Fig 7. è®­ç»ƒé˜¶æ®µçš„ Seq2Seq æ¨¡å‹ï¼Œæ¢¯åº¦æ²¿ç´«è‰²ç®­å¤´è·¯çº¿åå‘ä¼ æ’­</center>

<p>åœ¨è®­ç»ƒé˜¶æ®µä¸­ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹© SGD ä½œä¸ºä¼˜åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®­ç»ƒæ¨¡å‹ï¼š</p>

<ol>
  <li>éšæœºåœ¨è®­ç»ƒé›†ä¸­é€‰æ‹©ä¸€ä¸ª (input, output) æ•°æ®</li>
  <li>ä½¿ç”¨è¿™ä¸ªæ•°æ®è®©æ¨¡å‹è¿›è¡Œå‰å‘è®¡ç®—</li>
  <li>éšæœºé€‰æ‹©æ¨¡å‹åœ¨è§£ç é˜¶æ®µçš„ä¸€ä¸ªè¾“å‡ºè¿›è¡Œ Loss è®¡ç®—å¹¶è¿›è¡Œåå‘ä¼ æ’­</li>
  <li>æ›´æ–°æ¨¡å‹æƒé‡å‚æ•°</li>
</ol>

<h2 id="5-seq2seq-çš„ç¼ºé™·ä¸æ”¹è¿›æ–¹æ³•">5 Seq2Seq çš„ç¼ºé™·ä¸æ”¹è¿›æ–¹æ³•</h2>

<p>Seq2Seq æ¨¡å‹åˆ°ç°åœ¨ä¾ç„¶æ˜¯è§£å†³éåŒæ­¥éå¯¹é½åºåˆ—é¢„æµ‹é—®é¢˜çš„ç»å…¸æ¨¡å‹ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œå®ƒçš„ç»“æ„å­˜åœ¨ä¸€ä¸ªç¼ºé™· - è¿™ä¸ªç¼ºé™·ä¼šåœ¨æ¨¡å‹æ¥å—é•¿è¾“å…¥åºåˆ—æ—¶è¢«æš´éœ²æ— é—ã€‚æ³¨æ„åˆ°å›¾3ä¸­çš„ç¼–ç å™¨-è§£ç å™¨æ¨¡å‹ã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œç¼–ç å™¨ä¸è§£ç å™¨åªé€šè¿‡éšè—çŠ¶æ€ï¼ˆæ€»ç»“å‘é‡ï¼‰è¿æ¥èµ·æ¥ã€‚è¿™ç›´æ¥å¯¼è‡´äº†ä¸¤ä¸ªé—®é¢˜ï¼š</p>

<ol>
  <li>å½“è¾“å…¥åºåˆ—è¾ƒé•¿æ—¶ï¼Œè¿™ä¸ªéšè—çŠ¶æ€å¯èƒ½æ— æ³•å®Œå…¨å®¹çº³è¾“å…¥ä¸­è•´å«çš„æ‰€æœ‰ä¿¡æ¯é‡ï¼Œä»è€Œå¯¼è‡´æ¨¡å‹æ¥å—ä¿¡æ¯çš„æŸå¤±ã€‚<strong>ã€ç¼–ç å™¨ä¸è§£ç å™¨ä¹‹é—´çš„è¿æ¥å¤ªç‹­çª„ï¼Œæ— æ³•ä¼ é€’æ‰€æœ‰ä¿¡æ¯ã€‘</strong></li>
  <li>å¦‚æœè¾“å…¥åºåˆ—è¾ƒé•¿ï¼Œä¸€äº›ä¿¡æ¯å¯èƒ½ä¼šåœ¨ç¼–ç å™¨æ¥å—æ–°ä¿¡æ¯çš„è¿‡ç¨‹ä¸­è¢«â€œç¨€é‡Šâ€ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è§£ç å™¨é—æ¼è¾“å…¥ä¸­çš„å…³é”®ä¿¡æ¯ã€‚<strong>ã€ç¼–ç å™¨ä¸­æ‰€æœ‰çš„éšè—çŠ¶æ€éƒ½å«æœ‰ç‹¬ç‰¹çš„ä¿¡æ¯ï¼Œä½†æ˜¯åªæœ‰æœ€ç»ˆçŠ¶æ€è¢«ä¼ é€’ç»™äº†è§£ç å™¨ã€‘</strong></li>
</ol>

<p>è€Œè¿™ä¸¤ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆåˆ™æ˜¯ç›®å‰å¤§æœ‰ä¸€ç»Ÿ CNNï¼ŒRNNï¼Œå¤šæ¨¡æ€å­¦ä¹  ä¹‹åŠ¿çš„ Transformer æ¨¡å‹çš„åº•å±‚ç»“æ„ - æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰</p>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Neural Network&quot;]" /><category term="NLP" /><category term="Neural Network" /><summary type="html"><![CDATA[0 å››ç§æ—¶é—´åºåˆ—é—®é¢˜]]></summary></entry><entry xml:lang="ch"><title type="html">Batch Normalization æµ…å…¥æ·±å‡º</title><link href="https://markchenyutian.github.io//blog/2021/Batch-Normalization.html" rel="alternate" type="text/html" title="Batch Normalization æµ…å…¥æ·±å‡º" /><published>2021-12-26T00:00:00+00:00</published><updated>2021-12-26T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2021/Batch-Normalization</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2021/Batch-Normalization.html"><![CDATA[<h2 id="0-ç¬¦å·è¡¨">0 ç¬¦å·è¡¨</h2>

<table>
  <thead>
    <tr>
      <th>ç¬¦å·</th>
      <th>æ„ä¹‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>$\nabla_{W}f$</td>
      <td>å‡½æ•° $f$ å…³äºå˜é‡ï¼ˆé›†åˆï¼‰$W$ çš„æ¢¯åº¦</td>
    </tr>
    <tr>
      <td>$N$</td>
      <td>è®­ç»ƒé›†ä¸­æ•°æ®æ€»é‡</td>
    </tr>
    <tr>
      <td>$C$</td>
      <td>æŸå¤±å‡½æ•°ï¼ˆCost Functionï¼‰ï¼Œå¯¹äºç»™å®šæ¨¡å‹è¾“å‡º $\hat{y}$ ä¸ç›®æ ‡è¾“å‡º $y$ è¿›è¡Œå·®è·è¯„ä¼°</td>
    </tr>
    <tr>
      <td>$f(x, W)$</td>
      <td>æ‹¥æœ‰æƒé‡å‚æ•° $W$ ç¥ç»ç½‘ç»œå¯¹äºè¾“å…¥ $x$ çš„è¾“å‡º</td>
    </tr>
    <tr>
      <td>$D$</td>
      <td>ç›®æ ‡å‡½æ•°ï¼ˆGround Truthï¼‰</td>
    </tr>
    <tr>
      <td>$X$</td>
      <td>è®­ç»ƒæ•°æ®é›†</td>
    </tr>
    <tr>
      <td>$Xâ€™$</td>
      <td>è®­ç»ƒæ•°æ®é›†ä¸­çš„ä¸€ä¸ª mini-batchï¼Œ $Xâ€™\subseteq X$</td>
    </tr>
  </tbody>
</table>

<h2 id="1-mini-batch-å¢é‡è®­ç»ƒæ³•ä¸åæ–¹å·®é—®é¢˜">1 Mini-Batch å¢é‡è®­ç»ƒæ³•ä¸åæ–¹å·®é—®é¢˜</h2>

<p>åœ¨è¿›è¡Œç¥ç»ç½‘ç»œè®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—ç¥ç»ç½‘ç»œçš„æƒé‡å‚æ•°æ¢¯åº¦</p>

<p>$$
\nabla_{W} L(W) = \frac{1}{N}\sum_{x}{\nabla_{W}C(f(x, W), D(x))}
$$</p>

<p>å¯¹äºè®­ç»ƒé›†ä¸­çš„æ¯ä¸€ä¸ªæ•°æ® $x$ï¼Œæˆ‘ä»¬éƒ½è®¡ç®—å‡ºæƒé‡å‚æ•°çš„æ¢¯åº¦ï¼Œå°†ä»–ä»¬ç›¸åŠ åé™¤ä»¥$N$å¾—åˆ°ä¸€ä¸ªâ€œå¹³å‡æ¢¯åº¦â€ã€‚</p>

<p>å› ä¸ºï¼ˆæˆ‘ä»¬å‡è®¾ï¼‰<strong>è®­ç»ƒé›†ä¸­çš„æ•°æ®åˆ†å¸ƒäºç”Ÿäº§/æµ‹è¯•ç¯å¢ƒä¸€è‡´</strong>ï¼Œå½“ä½¿ç”¨æ•´ä¸ªè®­ç»ƒé›†çš„ç»“æœè¿›è¡Œæ¢¯åº¦è®¡ç®—å’Œå‚æ•°æ›´æ–°æ—¶ï¼Œç½‘ç»œ $f$ èƒ½å¤Ÿæ›´åŠ å‡†ç¡®çš„æ‹Ÿåˆåˆ°å®Œæ•´çš„ç›®æ ‡å‡½æ•° $D$ ä¸Šï¼Œè€Œéç›®æ ‡å‡½æ•° $D$ ä¸€éƒ¨åˆ†ç‰¹æ®Šçš„å®šä¹‰åŸŸä¸Šã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_B72671CFC736-1.jpeg" alt="IMG_B72671CFC736-1" /></p>

<center>Fig 1. å½“è®­ç»ƒé›†æ•°æ®åˆ†å¸ƒä¸æµ‹è¯•é›†ä¸åŒæ—¶ï¼ˆå³å›¾ï¼‰ï¼Œæ¨¡å‹æ‹Ÿåˆç»“æœä¼šæ˜¾è‘—é™ä½</center>

<p>ç„¶è€Œï¼Œè¿™æ ·çš„å‚æ•°æ›´æ–°æ–¹æ³•è™½ç„¶èƒ½å¤Ÿæœ€å¤§åŒ–æ¨¡å‹çš„æ‹Ÿåˆå‡†ç¡®ç‡ï¼Œç”±äºæ¯æ¬¡è¿›è¡Œå‚æ•°æ›´æ–°å‰å¿…é¡»å¾—çŸ¥è®­ç»ƒé›†ä¸­æ‰€æœ‰çš„è¾“å…¥ $x$ å¯¹åº”çš„æŸå¤±å‡½æ•° $C(f(x, W), D(x))$ å’Œæƒé‡æ¢¯åº¦ $\nabla_{W}C$ï¼Œæ¨¡å‹çš„æƒé‡æ›´æ–°é€Ÿåº¦ä¼šéå¸¸ç¼“æ…¢ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Mini-batch å¢é‡è®­ç»ƒæ–¹æ³•ã€‚æ¯æ¬¡æˆ‘ä»¬ä»ä¸€ä¸ªæ‹¥æœ‰ $N$ ä¸ªæ•°æ®çš„è®­ç»ƒé›†ä¸­éšæœºï¼Œä¸é‡å¤çš„é€‰æ‹© $B$ ä¸ªæ•°æ®ä½œä¸ºä¸€ä¸ª Batchã€‚å¾—åˆ°è¿™ $B$ ä¸ªæ•°æ®çš„æŸå¤±å‡½æ•°å’Œå¯¹åº”çš„æ¢¯åº¦åï¼Œæˆ‘ä»¬é©¬ä¸Šå¯¹æ¨¡å‹è¿›è¡Œä¸€æ¬¡å‚æ•°æ›´æ–°ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_BF395E0F0FEB-1.jpeg" alt="IMG_BF395E0F0FEB-1" /></p>

<center>Fig 2. ä½¿ç”¨ mini-batch æ–¹æ³•è®­ç»ƒçš„æ¨¡å‹æ›´æ–°å‚æ•°çš„é¢‘ç‡æœ‰æ˜¾è‘—æå‡</center>

<p>å¯æƒœï¼Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ mini-batch æ¥è®­ç»ƒç¥ç»ç½‘ç»œçš„æ—¶å€™å®é™…ä¸Šæˆ‘ä»¬æœ‰ä¸€ä¸ªéšå«çš„å‡è®¾ï¼š<strong>mini-batch ä¸­çš„æ•°æ®åˆ†å¸ƒäºè®­ç»ƒé›†ç›¸åŒ</strong>ã€‚</p>

<p>$$
\text{argmin}<em>{W}{\left(
	\sum</em>{x\in Xâ€™}{C(f(x, W), D(x))}
\right)}</p>

<p>\Leftrightarrow</p>

<p>\text{argmin}<em>{W}{\left(
	\sum</em>{x\in X}{C(f(x, W), D(x))}
\right)}
$$</p>

<p>ä¸Šé¢è¿™ä¸¤ä¸ªæœ€ä¼˜åŒ–ç›®æ ‡åªæœ‰åœ¨ $Xâ€™$ ï¼ˆMini-batch ä¸­çš„æ•°æ®ï¼‰ ä¸ $X$ ï¼ˆTraining Set ä¸­çš„æ•°æ®ï¼‰ çš„æ•°æ®åˆ†å¸ƒä¸€è‡´æ—¶æ‰æ˜¯ä¸€è‡´çš„ã€‚</p>

<p><strong>ç„¶è€Œè¿™ä¸ªå‡è®¾åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯ä¸æˆç«‹çš„</strong>ã€‚mini-batch ä¸­çš„æ•°æ®å¯èƒ½ä¼šæœ‰è¾ƒå¤§çš„åæ–¹å·® (Covariance) - ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰ mini-batch çš„æ•°æ®åˆ†å¸ƒä¸è®­ç»ƒé›†çš„æ•°æ®åˆ†å¸ƒå¹¶ä¸ç›¸åŒã€‚</p>

<p>æ•°æ®åˆ†å¸ƒçš„å·®å¼‚ä¼šå¯¼è‡´æ¨¡å‹åœ¨ä¼˜åŒ–æƒé‡å‚æ•°æ—¶çš„ç›®æ ‡ â€œæœ€ä¼˜åŒ–æ¨¡å‹åœ¨å½“å‰ mini-batch ä¸Šçš„è¡¨ç°â€ è¿™ä¸ªç›®æ ‡ä¸æˆ‘ä»¬çœŸæ­£çš„ç›®æ ‡ â€”â€” â€œæœ€ä¼˜åŒ–æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„è¡¨ç°â€ä¹‹é—´çš„åå·®ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_FD5CF492EE8A-1.jpeg" alt="IMG_FD5CF492EE8A-1" /></p>

<center>Fig 3. å½“æˆ‘ä»¬è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬æ„å»ºçš„é€»è¾‘é“¾æ¡</center>

<h2 id="2-batch-normalization-ç†è®º">2 Batch Normalization ç†è®º</h2>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSergey Ioffe å’Œ Christian Szegedy åœ¨ 2015 å¹´æå‡ºäº† Batch Normalization ï¼ˆä¸‹æ–‡ç®€ç§°BNï¼‰çš„æ–¹æ³•ã€‚BN çš„ç†è§£å®é™…ä¸Šå¾ˆç®€å• - æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„ mini-batch ç§»åŠ¨åˆ°ä¸€ä¸ªç‰¹æ®Šçš„ä½ç½® ($\mu = 0$, $\sigma =1$)ï¼Œæ¥â€œæ­£åˆ™åŒ–ï¼ˆNormalizeï¼‰â€ mini-batchï¼Œè®©æ‰€æœ‰çš„ mini-batch æ‹¥æœ‰ä¸€è‡´çš„æ•°æ®åˆ†å¸ƒã€‚</p>

<p>ç„¶è€Œï¼Œå¦‚æœ BN åªæœ‰è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¼šä¸å¯é¿å…çš„ä¸¢å¤±æ•°æ®æœ¬èº«çš„éƒ¨åˆ†ä¿¡æ¯ - è®­ç»ƒé›†æœ¬èº«çš„å¹³å‡å€¼ä¸æ–¹å·®ã€‚å¯¹äºä¸€ä¸ªè®­ç»ƒé›† $X$ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å‡ºå…¶å¹³å‡å€¼ $\mu_X$ ä¸æ–¹å·® $\sigma_X$ã€‚è¿™ä¸¤ä¸ªæ•°æ®æœ¬èº«ä¹Ÿæ˜¯æ•°æ®é›†çš„ä¿¡æ¯ä¹‹ä¸€ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦å‘BNä¸­æ·»åŠ ä¸¤ä¸ª<strong>å¯è®­ç»ƒçš„å‚æ•°</strong> $\gamma$ ä¸ $\beta$ã€‚åœ¨å°†mini-batchæ­£åˆ™åŒ–åï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®— $\gamma x + \beta$ æŠŠæ‰€æœ‰çš„ batch ç»Ÿä¸€ç§»åŠ¨åˆ° $\mu = \beta$ï¼Œ$\sigma = \gamma$ çš„ä½ç½®ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211227115058717.png" alt="image-20211227115058717" /></p>

<center>Fig 4. Batch Normalization çš„æ­£åˆ™åŒ–è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š1. Centering ï¼ˆ$\mu=0$ï¼‰2. Scaling ($\sigma = 1$) 3. Moving ï¼ˆ$\mu = \beta$, $\sigma = \gamma$)
</center>

<p>é€šè¿‡BNçš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°½å¯èƒ½å‡å° mini-batch ä¸­æ•°æ®åˆ†å¸ƒä¸è®­ç»ƒé›†çš„ä¸ä¸€è‡´æ€§ï¼Œa.k.a mini-batch çš„åæ–¹å·®ã€‚</p>

<h2 id="3-batch-normalization-å®ç°">3 Batch Normalization å®ç°</h2>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211227123210186.png" alt="image-20211227123210186" /></p>

<center>Fig 5. ä¸€ä¸ªä½¿ç”¨äº†BNçš„ç¥ç»å…ƒï¼Œå¯ä»¥çœ‹åˆ°BNå®é™…ä¸Šæ˜¯åœ¨æ¯ä¸ªç¥ç»å…ƒä¸­å¯¹è¾“å…¥åŠ æƒ&amp;åç½®çš„å€¼è¿›è¡Œæ­£åˆ™åŒ–</center>

<p>å¯ä»¥å°† BN çœ‹ä½œæ’å…¥åœ¨ç¥ç»å…ƒä¸­çš„ä¸€ä¸ªä¸­é—´ä»¶ã€‚å›¾5ä¸­çš„è“è‰²å˜é‡éƒ½æ˜¯ç¥ç»ç½‘ç»œ $f(x, W)$ ä¸­å¯è®­ç»ƒçš„å‚æ•°é›†åˆ $W$ ä¸­çš„å˜é‡ã€‚å¦‚æœæˆ‘ä»¬ç”¨è®¡ç®—å›¾çš„å½¢å¼è¡¨ç°å˜é‡ä¹‹é—´ç›¸äº’ä¾èµ–çš„å…³ç³»ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸‹é¢è¿™æ ·ä¸€å¼ è®¡ç®—å›¾ï¼š</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_4E0BC0496AB3-1.jpeg" alt="IMG_4E0BC0496AB3-1" style="zoom: 33%;" /></p>

<p>å…¶ä¸­ï¼Œæˆ‘ä»¬æœ‰</p>

<p>$$
\mu_B = \frac{1}{B}\sum_{i=1}^B{z_i}
$$</p>

<p>$$
\sigma^2<em>B = \frac{1}{B}\sum</em>{i=1}^B{(z_i - \mu_B)^2}
$$</p>

<p>$$
u_i = \frac{z_i - u_B}{\sqrt{\sigma^2_B + \epsilon}},\quad\text{Where }\epsilon\text{ is a smooth factor}
$$</p>

<p>$$
\hat{z}_i = \gamma u_i + \beta
$$</p>

<h2 id="4-batch-normalization-åå‘ä¼ æ’­æ•°å­¦æ¨å¯¼">4 Batch Normalization åå‘ä¼ æ’­æ•°å­¦æ¨å¯¼</h2>

<blockquote>
  <p>Adapted from CMU 11785 Lecture 8 Notes</p>
</blockquote>

<p>å‡è®¾æˆ‘ä»¬ç°åœ¨å·²çŸ¥ $\nabla_{\hat{z}} C(f(x, W), D(x))$ï¼Œæˆ‘ä»¬å¸Œæœ›è®©è¿™ä¸ªæ¢¯åº¦é€šè¿‡å«æœ‰ Batch Normalization çš„ç¥ç»å…ƒï¼Œåå‘ä¼ æ’­åˆ° $\nabla_x C(f(x, W), D(x))$ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è®¡ç®— $\frac{\partial C}{\partial x_1}$ï¼Œâ€¦ ï¼Œ$\frac{\partial C}{\partial x_n}$ã€‚</p>

<p>æ ¹æ®åå¾®åˆ†çš„é“¾å¼æ³•åˆ™ï¼Œæˆ‘ä»¬çŸ¥é“</p>

<p>$$
\frac{\partial C}{\partial x_1} = \sum_{i=1}^{n}{\frac{\partial C}{\partial \hat{z}_i}\frac{\partial \hat{z}_i}{\partial x_1}}
$$</p>

<p>ä¸å¤±ä¸€èˆ¬æ€§çš„ï¼Œå› ä¸ºåœ¨ç¥ç»å…ƒçš„è®¡ç®—ä¸­ï¼Œæ¯ä¸€ä¸ª $x$ åˆ†é‡çš„è®¡ç®—éƒ½æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®— $\frac{\partial C}{\partial x_1}$å¾—å‡ºè®¡ç®— $\frac{\partial C}{\partial x_i}$ çš„é€šé¡¹å…¬å¼ã€‚æ‰€ä»¥åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šä»¥è®¡ç®— $x_1$ çš„æ¢¯åº¦ä¸ºä¾‹å­è¿›è¡Œè®¡ç®—ä¸æ¨å¯¼ã€‚</p>

<p>å› ä¸ºä» $u_i$ å¼€å§‹ï¼Œå‘é‡ä¸­çš„æ¯ä¸ªåˆ†é‡éƒ½æ˜¯å•ç‹¬è®¡ç®—çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥å¯¹äºä»»æ„ $i\neq j$ï¼Œæˆ‘ä»¬æœ‰ $\partial \hat{z}_i /\partial u_j = 0$ï¼š</p>

<p>$$
\frac{\partial C}{\partial u_i} = \sum_{j=1}^n{\frac{\partial C}{\partial \hat z_j}\frac{\partial \hat z_j}{\partial u_i}} = \frac{\partial C}{\partial \hat z_i}\frac{\partial \hat z_i}{\partial u_i} = \frac{\partial C}{\partial \hat z_i}\cdot \gamma
$$</p>

<h3 id="41--bnä¸­çš„ç›´æ¥è¿æ¥åå‘ä¼ æ’­å…¬å¼æ¨å¯¼">4.1  BNä¸­çš„ç›´æ¥è¿æ¥åå‘ä¼ æ’­å…¬å¼æ¨å¯¼</h3>

<p>é‡æ–°å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„BNè®¡ç®—å›¾ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç° $z_1$ çš„å€¼è®¡ç®—åˆ° $u_1$ æœ‰ä¸‰æ¡ä¸åŒçš„è·¯çº¿ã€‚æˆ‘ä»¬éœ€è¦è®¡ç®— $\partial {u_i}/{\partial z_i}$ æ—¶ï¼Œéœ€è¦è®¡ç®—ä¸‰æ¡è·¯çº¿ä¸Šçš„å¾®åˆ†å¹¶ç›¸åŠ èµ·æ¥ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_614F94CA4D21-1.jpeg" alt="IMG_614F94CA4D21-1" style="zoom:25%;" /></p>

<p>$$
\frac{\partial u_1}{\partial z_1} = \frac{\partial u_1}{\partial z_1} + \frac{\partial u_1}{\partial \mu_B}\frac{\partial \mu_B}{\partial z_1} + \frac{\partial u_1}{\partial \sigma^2_B}\frac{\partial \sigma^2_B}{\partial z_1}
$$</p>

<p>å¯¹äºä¸Šå¼<strong>ç¬¬ä¸€é¡¹ï¼ˆè®¡ç®—å›¾ä¸­çš„é»‘è‰²è·¯çº¿ï¼‰</strong>ï¼Œ$\partial u_1/\partial z_1$ï¼Œè¿™é‡Œçš„ç›´æ¥è¿æ¥æ¥è‡ªäºå…¬å¼</p>

<p>$$
u_i = \frac{z_i - u_B}{\sqrt{\sigma^2_B + \epsilon}}
$$</p>

<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¡ç®—å‡º</p>

<p>$$
\frac{\partial u_1}{\partial z_1} = \frac{1}{\sqrt{\sigma^2_B + \epsilon}}
$$</p>

<p>å¯¹äº<strong><font color="blue">ç¬¬äºŒé¡¹ï¼ˆè®¡ç®—å›¾ä¸­çš„è“è‰²è·¯çº¿ï¼‰</font></strong>ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«è®¡ç®—å•ç‹¬ä¸€ä¸ª $z_1$ å¯¹æ•´ä¸ª Mini-batch çš„å¹³å‡æ•° $\mu_B$ çš„åå¯¼æ•°ä»¥åŠå¹³å‡æ•° $\mu_B$ å¯¹äºBNç»“æœ $u_1$ çš„åå¯¼æ•°ã€‚</p>

<p>å› ä¸ºæˆ‘ä»¬æœ‰</p>

<p>$$
\mu_B = \frac{1}{B}\sum_{i=1}^B{z_i}
$$</p>

<p>ä¸éš¾å¾—å‡º</p>

<p>$$
\frac{\partial \mu_B}{\partial z_1} = \frac{1}{B}
$$</p>

<p>åŒæ—¶ï¼Œå¯¹äº $\partial \mu_B/\partial u_1$ï¼Œæˆ‘ä»¬æœ‰</p>

<p>$$
u_i = \frac{z_i - u_B}{\sqrt{\sigma^2_B + \epsilon}}
$$</p>

<p>æ‰€ä»¥æœ‰</p>

<p>$$
\frac{\partial u_1}{\partial \mu_B} = -\frac{1}{\sqrt{\sigma_B^2 + \epsilon}}
$$</p>

<p>å°†ä¸¤ä¸ªåå¯¼æ•°ä¹˜èµ·æ¥ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°è®¡ç®—å›¾ä¸­è“è‰²è·¯çº¿çš„åå‘ä¼ æ’­å…¬å¼ï¼š</p>

<p>$$
-\frac{1}{B\sqrt{\sigma_B^2 + \epsilon}}
$$</p>

<p>å¯¹äº<strong><font color="purple">ç¬¬ä¸‰é¡¹ï¼ˆè®¡ç®—å›¾ä¸­çš„ç´«è‰²è·¯çº¿ï¼‰</font></strong>ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«è®¡ç®—ä¸¤æ¡â€œæ”¯è·¯â€çš„åå¾®åˆ†ä¹‹å’Œ</p>

<p>$$
\frac{\partial u_i}{\partial \sigma^2_B}\frac{\partial \sigma^2_B}{\partial z_1} = \frac{\partial u_i}{\partial \sigma^2_B}\left(
	\frac{\partial \sigma^2_B}{\partial z_1} + \frac{\partial \sigma^2_B}{\partial \mu_B}\frac{\partial \mu_B}{\partial z_1}
\right)
$$</p>

<p>ä» $u_i$ çš„è®¡ç®—å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥</p>

<p>$$
\frac{\partial u_1}{\partial \sigma^2B} = \frac{\partial }{\partial \sigma^2_B}\frac{z_1 - u_B}{\sqrt{\sigma^2_B + \epsilon}} = -\frac{z_1 - \mu_B}{2(\sigma_B^2 + \epsilon)^{3/2}}
$$</p>

<p>å› ä¸ºæœ‰æ–¹å·®$\sigma_B^2$çš„è®¡ç®—å…¬å¼</p>

<p>$$
\sigma^2<em>B = \frac{1}{B}\sum</em>{i=1}^B{(z_i - \mu_B)^2}
$$</p>

<p>æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ $\partial \sigma_B^2 / \partial z_1$</p>

<p>$$
\frac{\partial \sigma_B^2}{\partial z_1} = \frac{\partial }{\partial z_1}\frac{(z_1 - \mu_B)^2}{B} = 2\frac{z_1 - \mu_B}{B}
$$</p>

<p>åŒæ—¶ï¼Œæˆ‘ä»¬æœ‰</p>

<p>$$
\frac{\partial \sigma_B^2}{\partial \mu_B}
 = \frac{1}{B}\sum_{i=1}^B{-2(z_i - \mu_B) = -\frac{2}{B}\left(\sum_{i=1}^B{z_i} - \sum_{i=1}^B{\mu_B}\right)} = 0
$$</p>

<p>å› æ­¤ï¼Œè®¡ç®—å›¾ä¸­çš„ç´«è‰²è·¯çº¿çš„åå‘ä¼ æ’­å…¬å¼æ˜¯ï¼š</p>

<p>$$
-\frac{z_1 - \mu_B}{2(\sigma_B^2 + \epsilon)^{3/2}} \cdot 2\frac{z_1 - \mu_B}{B} = -\frac{(z_1 - \mu_B)^2}{(\sigma_B^2 + \epsilon)^{3/2}B}
$$</p>

<p>å°†ä¸‰æ¡è·¯çº¿çš„åå‘ä¼ æ’­å…¬å¼ç›¸åŠ ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°â€œç›´æ¥è¿æ¥â€œçš„åå‘ä¼ æ’­å…¬å¼</p>

<p>$$
\frac{\partial u_i}{\partial z_i} = \frac{1}{\sqrt{\sigma^2_B + \epsilon}} -\frac{1}{B\sqrt{\sigma_B^2 + \epsilon}} -\frac{(z_1 - \mu_B)^2}{B(\sigma_B^2 + \epsilon)^{3/2}}
$$</p>

<h3 id="42-bn-ä¸­çš„è·¨è¶Šè¿æ¥åå‘ä¼ æ’­å…¬å¼æ¨å¯¼">4.2 BN ä¸­çš„è·¨è¶Šè¿æ¥åå‘ä¼ æ’­å…¬å¼æ¨å¯¼</h3>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211227162304898.png" alt="image-20211227162304898" style="zoom:25%;" /></p>

<p>å¯¹äºè·¨è¶Šè¿æ¥ï¼ˆ$\partial u_i/\partial z_j$, where $i\neq j$ï¼‰ï¼Œè®¡ç®—å›¾ä¸­åªæœ‰è“è‰²ä¸ç´«è‰²ä¸¤æ¡è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰</p>

<p>$$
\frac{\partial u_i}{\partial z_j} = \begin{cases}
\frac{1}{\sqrt{\sigma^2_B + \epsilon}} -\frac{1}{B\sqrt{\sigma_B^2 + \epsilon}} -\frac{(z_1 - \mu_B)^2}{B(\sigma_B^2 + \epsilon)^{3/2}} &amp; i=j<br />
-\frac{1}{B\sqrt{\sigma_B^2 + \epsilon}} -\frac{(z_1 - \mu_B)^2}{B(\sigma_B^2 + \epsilon)^{3/2}} &amp; i\neq j
\end{cases}
$$</p>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Neural Network&quot;]" /><category term="Neural Network" /><summary type="html"><![CDATA[0 ç¬¦å·è¡¨]]></summary></entry><entry xml:lang="ch"><title type="html">NLP 101: Word Embedding è¯åµŒå…¥</title><link href="https://markchenyutian.github.io//blog/2021/Word-Embedding.html" rel="alternate" type="text/html" title="NLP 101: Word Embedding è¯åµŒå…¥" /><published>2021-11-24T00:00:00+00:00</published><updated>2021-11-24T00:00:00+00:00</updated><id>https://markchenyutian.github.io//blog/2021/Word-Embedding</id><content type="html" xml:base="https://markchenyutian.github.io//blog/2021/Word-Embedding.html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯è¯åµŒå…¥">ä»€ä¹ˆæ˜¯è¯åµŒå…¥</h2>

<p>åœ¨å¤„ç†è‡ªç„¶è¯­è¨€æ—¶ï¼Œæ¨¡å‹çš„è¾“å…¥æ˜¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œç„¶è€Œï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½å¯¹å­—ç¬¦ä¸²è¿›è¡Œè¿ç®—æ“ä½œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°è¯•å°†è‡ªç„¶è¯­è¨€çš„è¯æ±‡è½¬æ¢ä¸ºä¸€ä¸ªè¿ç»­å‘é‡ç©ºé—´ä¸­çš„å‘é‡ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œ<strong>è¯åµŒå…¥</strong>â€œã€‚ç”¨æ›´åŠ å½¢å¼åŒ–çš„è¯­è¨€æ¥æè¿°ï¼Œè¯åµŒå…¥çš„è¿‡ç¨‹å¯ä»¥è¿™æ ·è¡¨è¾¾ï¼š</p>

<p>$$
\text{Natural Language} \rightarrow \mathbb{R}^n
$$</p>

<h2 id="ç”¨-one-hot-ç¼–ç è¿›è¡Œè¯åµŒå…¥">ç”¨ One-hot ç¼–ç è¿›è¡Œè¯åµŒå…¥ï¼Ÿ</h2>

<p>ä¸€ç§ç¬¦åˆç›´è§‰ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„è¯åµŒå…¥æ–¹æ³•æ˜¯ä½¿ç”¨ One-hot ç¼–ç ã€‚One-hot ç¼–ç æŒ‡ä¸€ä¸ª $1\times n$ å‘é‡ä¸­åªæœ‰ä¸€ä¸ªåˆ†é‡ä¸º1ï¼Œå…¶å®ƒåˆ†é‡éƒ½æ˜¯0ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬ç°åœ¨æƒ³å°†å››ä¸ªå•è¯æ„æˆçš„è¯æ±‡è¡¨è½¬åŒ–ä¸ºå‘é‡ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p>

<p>$$
\begin{aligned}
\text{Nice} &amp;\rightarrow [1, 0, 0, 0]\<br />
\text{to} &amp;\rightarrow [0, 1, 0, 0]\<br />
\text{meet} &amp;\rightarrow [0, 0, 1, 0]\<br />
\text{you} &amp;\rightarrow [0, 0, 0, 1]
\end{aligned}
$$</p>

<p>ä½†æ˜¯è¿™æ ·æœ‰å‡ ä¸ªå¾ˆæ˜æ˜¾çš„åå¤„ï¼š</p>

<ul>
  <li>å¦‚æœæˆ‘ä»¬çš„è¯æ±‡è¡¨ä¸­æœ‰ 10,000 ä¸ªå•è¯ï¼Œä½œä¸ºæ˜ å°„ç›®æ ‡çš„å‘é‡ç©ºé—´ä¼šæ‹¥æœ‰ 10,000 ä¸ªç»´åº¦ã€‚è¿™ä¼šå¯¼è‡´ä»»ä½•è¯•å›¾å¯¹è¯å‘é‡è¿›è¡Œè¿ç®—çš„å°è¯•éƒ½éœ€è¦æå¤§çš„è®¡ç®—é‡ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„â€œç»´åº¦ç¾éš¾â€é—®é¢˜</li>
  <li>åœ¨è¿›è¡Œå®Œè¯åµŒå…¥åï¼Œè¯è¯­çš„â€œæ„æ€â€è¢«å®Œå…¨ä¸¢å¤±äº†ã€‚åœ¨è¿›è¡Œå®Œæ˜ å°„åï¼Œä»»ä½•è¯è¯­ä¹‹é—´çš„å‘é‡è·ç¦»éƒ½æ˜¯ç›¸åŒçš„ã€‚ä¸€ä¸ªç†æƒ³çš„æ˜ å°„åº”è¯¥åœ¨è¿›è¡Œå®Œè¯åµŒå…¥åå°½å¯èƒ½çš„ä¿ç•™è¯æ±‡æœ¬èº«çš„ä¿¡æ¯ã€‚æ¯”å¦‚æˆ‘ä»¬ä¼šå¸Œæœ›ä»£è¡¨ â€œmyâ€ å’Œ â€œmeâ€ çš„è¯å‘é‡ä¹‹é—´çš„è·ç¦»å°äºä»£è¡¨ â€œmeâ€ å’Œ â€œsunâ€ çš„è¯å‘é‡ä¹‹é—´çš„è·ç¦»ã€‚</li>
</ul>

<h2 id="ä½¿ç”¨ç¥ç»ç½‘ç»œæ‹Ÿåˆè¯åµŒå…¥å‡½æ•°">ä½¿ç”¨ç¥ç»ç½‘ç»œâ€œæ‹Ÿåˆâ€è¯åµŒå…¥å‡½æ•°</h2>

<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§æ–°çš„ approachã€‚<strong>å‡è®¾å­˜åœ¨ä¸€ä¸ªç†æƒ³çš„å‡½æ•° $f$ èƒ½å¤Ÿå°†è‡ªç„¶è¯æ±‡æ˜ å°„ä¸ºä¸€ä¸ªæœ‰æ„ä¹‰çš„è¯å‘é‡ã€‚æˆ‘ä»¬å¯ä»¥è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œæ¥æ‹Ÿåˆè¿™ä¸ªå‡½æ•°</strong></p>

<p>ä½†æ˜¯è¿™å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ - ç¥ç»ç½‘ç»œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„æŸå¤±å‡½æ•°æ¥è¿›è¡Œåå‘ä¼ æ’­ä¸å‚æ•°æ›´æ–°ã€‚ç„¶è€Œ<strong>æˆ‘ä»¬æ˜¯ä¸çŸ¥é“æœ€ä½³è¯åµŒå…¥å‡½æ•°çš„è¾“å‡ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœç›´æ¥æ‹Ÿåˆè¯åµŒå…¥å‡½æ•°çš„è¯æˆ‘ä»¬æ²¡æœ‰ Ground Truth / Labeled Data</strong></p>

<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•éå¸¸ç®€å•ï¼šæˆ‘ä»¬<strong>å…ˆç»™ç¥ç»ç½‘ç»œä¸€ä¸ªå·²ç» well-defined çš„é—®é¢˜æ¥è¿›è¡Œè®­ç»ƒï¼Œç„¶åä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹åœ¨æ¨ç†é˜¶æ®µæ¥åˆ›å»ºè‡ªç„¶è¯­è¨€åˆ°è¯å‘é‡ç©ºé—´ä¹‹é—´çš„æ˜ å°„</strong>ã€‚åœ¨å¯»æ‰¾è¯åµŒå…¥è¿™ä¸ªé—®é¢˜ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®­ç»ƒé˜¶æ®µç»™å®šæ¨¡å‹ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰è®©æ¨¡å‹é¢„æµ‹åœ¨ä¸€ä¸ªç‰¹å®šä½ç½®çš„è¯çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>

<h2 id="nnlm---ç¬¬ä¸€æ‰¹è¯•å›¾è§£å†³nlpé—®é¢˜çš„ç¥ç»ç½‘ç»œ">NNLM - ç¬¬ä¸€æ‰¹è¯•å›¾è§£å†³NLPé—®é¢˜çš„ç¥ç»ç½‘ç»œ</h2>

<h3 id="ç”¨nnlmé¢„æµ‹è¯æ±‡åºåˆ—">ç”¨NNLMé¢„æµ‹è¯æ±‡åºåˆ—</h3>

<p>NNLM æ˜¯ â€œNeural Net Language Modelâ€ çš„ç¼©å†™ã€‚è¿™æ˜¯ç¬¬ä¸€æ‰¹ç”¨æ¥è§£å†³è‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜çš„ç¥ç»ç½‘ç»œæ¨¡å‹ä¹‹ä¸€ã€‚NNLM ä¸€å¼€å§‹çš„ç›®çš„æ˜¯<strong>ç»™å®šç¬¬$n$ä¸ªåˆ°ç¬¬$n + k - 1$ä¸ªè¯æ±‡ ï¼Œé¢„æµ‹ç¬¬ $n + k$ ä¸ªè¯æ±‡çš„æ¦‚ç‡åˆ†å¸ƒ</strong>ã€‚</p>

<p>ä¸€ä¸ªNNLMæ¨¡å‹ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>

<ol>
  <li>
    <p>ä½¿ç”¨ä¸€ä¸ªå‚æ•°çŸ©é˜µ $C$ å°† One-hot ç¼–ç çš„è¯å‘é‡è½¬æ¢ä¸º $\mathbb{R}^n$ å‘é‡ç©ºé—´ä¸­çš„ä¸€ä¸ªå‘é‡</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125121222905.png" alt="image-20211125121222905" style="width:500px" /></p>
  </li>
  <li>
    <p>å°†ä¸Šä¸€æ­¥å¾—åˆ°çš„è¯å‘é‡æ‹¼æ¥èµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªâ€œä¸Šä¸‹æ–‡â€å‘é‡ $x$ã€‚é€šè¿‡ä¸€ä¸ªéçº¿æ€§çš„éšè—å±‚ $b + Wx + \tanh{(b_2 + W_2x)}$çš„è®¡ç®—ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°åœ¨ $n + k$ ä½ç½®çš„è¯æ±‡â€œæ¦‚ç‡åˆ†å¸ƒâ€ã€‚è¿™é‡Œçš„â€œæ¦‚ç‡åˆ†å¸ƒâ€æ‰“äº†å¼•å·å› ä¸ºè¿™æ—¶å€™çš„å‘é‡å¹¶ä¸æ»¡è¶³ä¸€äº›æ¦‚ç‡åˆ†å¸ƒçš„ç‰¹å¾ï¼šæ¯”å¦‚å„ä¸ªåˆ†é‡éƒ½ä¸ºéè´Ÿæ•°ä¸”ç›¸åŠ ä¹‹å’Œä¸º1ã€‚</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125121235835.png" alt="image-20211125121235835" /></p>
  </li>
  <li>
    <p>ä¸ºäº†å°†æœ€åè¾“å‡ºçš„å‘é‡å˜æˆçœŸæ­£çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæˆ‘ä»¬éœ€è¦ç”¨ Softmax å‡½æ•°å¤„ç†ï¼ˆæ­£åˆ™åŒ–ï¼‰è¿™ä¸ªå‘é‡</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125121729274.png" alt="image-20211125121729274" /></p>
  </li>
</ol>

<h3 id="nnlm-æ„å»ºè¯åµŒå…¥">NNLM æ„å»ºè¯åµŒå…¥</h3>

<p>ç„¶è€Œï¼Œæ­£å¦‚åœ¨å‰æ–‡æ‰€è¯´çš„ä¸€æ ·ï¼Œ<strong>è®­ç»ƒå¥½çš„NNLM å®é™…ä¸Šè¡¨ç¤ºç€ä¸€ç§åˆ›å»ºè¯åµŒå…¥çš„å‡½æ•°</strong>ã€‚å‡å¦‚æˆ‘ä»¬çš„è¯æ±‡è¡¨åªæœ‰å››ä¸ªå•è¯ â€œOnceâ€, â€œuponâ€, â€œaâ€, â€œtimeâ€ï¼Œæˆ‘ä»¬ç°åœ¨ç»™å®š â€œuponâ€ â€œaâ€ â€œtimeâ€ï¼Œæƒ³é¢„æµ‹ â€œthereâ€ è¿™ä¸ªä½ç½®çš„è¯æ±‡ã€‚</p>

<p>â€œOnce upon a time <strong>there</strong> â€¦â€</p>

<p>è¿™ä¸ªè¯æ±‡å¹¶ä¸åœ¨æˆ‘ä»¬çš„è¯æ±‡è¡¨ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè¯çš„è¯å‘é‡ä»¥â€œé¢„æµ‹ç»“æœçš„è¯å‘é‡çš„åŠ æƒå’Œâ€æ¥å®šä¹‰ï¼š</p>

<p>$$
C(j) \leftarrow \sum_{i\in V}{C(i)P(i \mid w_{t-n+1}^{t-1})}
$$</p>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæè¿°è¿™ç§æ„å»ºæ–¹æ³•çš„ toy demo</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125191009240.png" alt="image-20211125191009240" /></p>

<h2 id="word2vec-æ¨¡å‹">Word2Vec æ¨¡å‹</h2>

<p>åœ¨<a href="https://arxiv.org/pdf/1301.3781.pdf">Word2Vec è®ºæ–‡</a>ä¸­ï¼Œä½œè€…å»ºç«‹äº†ä¸¤ç§ä¸åŒçš„ç¥ç»ç½‘ç»œæ¨¡å‹æ¥è¿›è¡Œè¯åµŒå…¥ã€‚</p>

<h3 id="word2vec-cbow-æ¨¡å‹">Word2Vec CBOW æ¨¡å‹</h3>

<p>CBOW æ˜¯ â€œContinuous Bag of Wordsâ€ çš„ç¼©å†™ã€‚è¿™æ˜¯ä¸€ç§ç”¨ç›®æ ‡è¯æ±‡å‘¨å›´çš„å•è¯è¿›è¡Œé‡‡æ ·çš„è¯åµŒå…¥æ¨¡å‹ã€‚</p>

<p>è¿™ä¸ªæ¨¡å‹æ˜¯åŸºäº NNLM çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›å¾—åˆ°çš„ï¼Œå®ƒä¸NNLMä¸ä¸€æ ·çš„åœ°æ–¹ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p>

<ul>
  <li>
    <p>CBOWä¸ºäº†é¢„æµ‹ $t$ ä½ç½®çš„å•è¯ï¼Œè¿™ä¸ªæ¨¡å‹ä¼šæ¥å— $t$ å‘¨å›´çš„å•è¯ - $t-1$, $t-2$,â€¦, $t+2$ ä½ç½®çš„è¯æ±‡ï¼Œè€Œ NNLM åªä¼šæ¥å— $t$ ä¹‹å‰çš„å•è¯ã€‚</p>
  </li>
  <li>
    <p>NNLM ä¸­åœ¨ç¬¬äºŒéƒ¨é‡Œé¢ä¼šå°†æ‰€æœ‰çš„è¯å‘é‡æ‹¼æ¥èµ·æ¥ï¼Œè€Œ CBOW ä¼šå¯¹è¿™äº›è¯å‘é‡è¿›è¡ŒæŒ‰ä½ç›¸åŠ ã€‚å› ä¸ºåŠ æ³•æ˜¯æ»¡è¶³äº¤æ¢å¾‹çš„ï¼Œæ‰€ä»¥è¿™äº›è¾“å…¥çš„è¯æ±‡çš„é¡ºåºæ˜¯æ— å…³ç´§è¦çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæ¨¡å‹å«åš â€œBag of Wordâ€ - è¯æ±‡çš„é¡ºåºæ˜¯æ— å…³ç´§è¦çš„ã€‚</p>
  </li>
</ul>

<p>é€šè¿‡å’Œ NNLM ä¸€æ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä»è®­ç»ƒå¥½çš„ CBOW æ¨¡å‹ä¸­è·å¾—è‡ªç„¶è¯­è¨€ä¸è¯å‘é‡ç©ºé—´ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_EAF813800A83-1.jpeg" alt="IMG_EAF813800A83-1" /></p>

<h3 id="word2vec-skip-gram-æ¨¡å‹">Word2Vec Skip Gram æ¨¡å‹</h3>

<p>Skip Gram æ˜¯ä¸€ç§å’Œ CBOW å®Œå…¨ç›¸åçš„æ¨¡å‹ - ç»™å®šç¬¬ $k$ ä¸ªè¯ï¼ŒSkip gram æ¨¡å‹ä¼šé¢„æµ‹è¿™ä¸ªè¯å‘¨è¾¹çš„è¯çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_E465C9E1EBF7-1.jpeg" alt="IMG_E465C9E1EBF7-1" /></p>

<h3 id="cbow-è¿˜æ˜¯-skip-gram">CBOW è¿˜æ˜¯ Skip Gram?</h3>

<p>åœ¨è®ºæ–‡ä¸­ï¼Œä½œè€…è¡¨ç¤º Skip-gram æ¨¡å‹åœ¨å°æ•°æ®é›†ä¸Šè¡¨ç°æ›´å¥½ï¼Œè€Œä¸”å¯¹äºè¯é¢‘è¾ƒä½çš„è¯æ±‡ä¾ç„¶èƒ½å¤Ÿè¾ƒå¥½çš„æå–è¯å‘é‡ã€‚è€Œ CBOW çš„è®­ç»ƒé€Ÿåº¦æ™®éé«˜äº Skip-gram å¹¶ä¸”å¯¹äºé«˜è¯é¢‘è¯æ±‡çš„è¯å‘é‡ä¼°è®¡è´¨é‡æ›´é«˜ã€‚</p>

<h2 id="è¯åµŒå…¥çœŸçš„èƒ½å¤Ÿä¿ç•™è¯æ±‡çš„æ„æ€å—">è¯åµŒå…¥çœŸçš„èƒ½å¤Ÿä¿ç•™è¯æ±‡çš„æ„æ€å—ï¼Ÿ</h2>

<p>æˆ‘è®¤ä¸ºæ˜¯å¯ä»¥çš„ï¼è¿™é‡Œæ˜¯ä¸€ä¸ªè®ºæ–‡ä¸­ä¸¾çš„å¾ˆç¥å¥‡çš„demoï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vec("king") - vec("man") + vec("woman") = vec("queen")
</code></pre></div></div>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ å°† â€œkingâ€ çš„è¯å‘é‡ä¸ â€œmanâ€çš„è¯å‘é‡ç›¸å‡åï¼Œä½ ä¼šå¾—åˆ°ä¸€ç§è¡¨ç¤ºç±»ä¼¼â€ç‹æƒâ€œè¯­ä¹‰çš„è¯å‘é‡ï¼Œå½“åœ¨è¿™ä¸ªè¯­ä¹‰çš„åŸºç¡€ä¸ŠåŠ ä¸Šè¡¨ç¤ºå¥³æ€§çš„è¯å‘é‡ä½ å°±ä¼šå¾—åˆ° â€œqueenâ€ã€‚</p>

<h2 id="å‚è€ƒææ–™">å‚è€ƒææ–™</h2>

<p>https://arxiv.org/pdf/1301.3781.pdf</p>

<p>https://towardsdatascience.com/nlp-101-word2vec-skip-gram-and-cbow-93512ee24314</p>

<p>https://www.baeldung.com/cs/word-embeddings-cbow-vs-skip-gram</p>

<p>https://zhuanlan.zhihu.com/p/206878986</p>

<p>https://www.youtube.com/watch?v=kEMJRjEdNzM&amp;list=PLoROMvodv4rOhcuXMZkNm7j3fVwBBY42z</p>]]></content><author><name>Yutian (Mark) Chen</name></author><category term="[&quot;Neural Network&quot;]" /><category term="Machine Learning" /><category term="NLP" /><category term="Neural Network" /><summary type="html"><![CDATA[ä»€ä¹ˆæ˜¯è¯åµŒå…¥]]></summary></entry></feed>