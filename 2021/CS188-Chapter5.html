<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--<meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"></meta>--><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>CS188 Chapter 5 Adversarial Search | Yutian’s Blog</title>
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="CS188 Chapter 5 Adversarial Search">
<meta name="author" content="Yutian (Mark) Chen">
<meta property="og:locale" content="en_US">
<meta name="description" content="5.1 Games">
<meta property="og:description" content="5.1 Games">
<link rel="canonical" href="https://markchenyutian.github.io//blog/2021/CS188-Chapter5.html">
<meta property="og:url" content="https://markchenyutian.github.io//blog/2021/CS188-Chapter5.html">
<meta property="og:site_name" content="Yutian’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-04-22T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="CS188 Chapter 5 Adversarial Search">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yutian (Mark) Chen"},"dateModified":"2021-04-22T00:00:00+00:00","datePublished":"2021-04-22T00:00:00+00:00","description":"5.1 Games","headline":"CS188 Chapter 5 Adversarial Search","mainEntityOfPage":{"@type":"WebPage","@id":"https://markchenyutian.github.io//blog/2021/CS188-Chapter5.html"},"url":"https://markchenyutian.github.io//blog/2021/CS188-Chapter5.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/blog/assets/css/main.css">
  <script src="/blog/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="https://markchenyutian.github.io//blog/feed.xml" title="Yutian's Blog">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      skipTags:['script', 'noscript', 'style', 'textarea', 'pre'],
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>



















<header class="site-header site-header-transparent" role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<!-- | default: default_paths - --><span class="site-brand"><a class="site-brand-inner" rel="author" href="/blog/">
  <img class="site-favicon" title="Yutian's Blog" src="" onerror="this.style.display='none'">
  Yutian's Blog
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/blog/about.html">ABOUT</a><a class="page-link" href="/blog/posts.html">POSTS</a><a class="page-link" href="/blog/files.html">FILES</a>




<span class="page-link">

<div id="google_translate_element" style="display: none;">
</div>

<span class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="Franch">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</span>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: '',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</span>
</div>
        </nav>
</div>
  </div>
</header>

<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;documentElement.setAttribute("data-header-transparent", "");var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  })();
</script>











































  <section class="page-banner">
    <div class="page-banner-img">
      <div style="background-image: url(/blog/assets/images/banners/CS188Background.jpg)"></div>
    </div>
    <div class="wrapper">
      <div class="page-banner-inner">
<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">CS188 Chapter 5 Adversarial Search</h1>
  <h3 class="post-subtitle"></h3>

  <p class="post-meta">
    <time class="dt-published" datetime="2021-04-22T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Apr 22, 2021
    </time>

    
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 34 mins</span>

    <!-- Read Count Insert Here -->
  </p>
<div class="post-tags"><a class="post-tag" href="/blog/tags.html#Machine%20Learning">#Machine Learning</a></div></header>
</div>
    </div>
  </section><script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h3 id="51-games">5.1 Games</h3>

<p>This chapter describes the <strong>Competitive Environments</strong> for agents, where their goals are conflict. Such problem is called the <strong>adversarial search</strong> problems - often known as <strong>games</strong>.</p>

<p>In the field of AI, the most common games are a special kind of game - the <strong>Deterministic, Turn-taking, Two-player, Zero-sum games</strong> of <strong>Perfect Information</strong> (such as chess).</p>

<p>Games are interesting since they are hard to solve using direct search - the branching factor of game is too large that it is impossible to search through all possible states. Also, games penalize inefficiency severely, so the program should be as fast as possible.</p>

<p><strong>Pruning</strong> （剪枝） allows us to ignore portions of search tree that make no difference to the final choice. Heuristic <strong>Evaluation Functions</strong> allow us to approximate the true utility of a state without doing a complete search.</p>

<p>Suppose there are two agents - “MAX” and “MIN”. In a game, “MAX” move first, and they take turn to move until the game is over. The winner get points and loser get penalty.</p>

<h4 id="511-formally-defined-game">5.1.1 Formally Defined Game</h4>

<p>A game can be formally defined with these elements</p>

<table>
  <thead>
    <tr>
      <th>Element</th>
      <th>Explanation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>$S_0$</td>
      <td>The Initial State of game (the setup of game)</td>
    </tr>
    <tr>
      <td>$Player(s)$</td>
      <td>Defines which player has a move in the current state $s$</td>
    </tr>
    <tr>
      <td>$Actions(s)$</td>
      <td>Returns a list of legal actions in a state $s$</td>
    </tr>
    <tr>
      <td>$Result(s, a)$</td>
      <td>The <em>state transition model</em>, which defines the result of an action $a$</td>
    </tr>
    <tr>
      <td>$Terminal-Test(s)$</td>
      <td>Returns <code class="language-plaintext highlighter-rouge">true</code> if the game is over, <code class="language-plaintext highlighter-rouge">false</code> otherwise</td>
    </tr>
    <tr>
      <td>$Utility(s, p)$</td>
      <td>A utility function defines the numeric value for a game that ends in terminal state $s$ for player $p$</td>
    </tr>
  </tbody>
</table>

<p>The <strong>Zero-sum</strong> game is defined as one where the <mark>total payoff to all players is the same for every instance of the game</mark>.</p>

<p>The initial state $S_0$, $Action$ function and $Result$ function define the <strong>game tree</strong> for the game - a tree where the nodes are game states and the edges are actions.</p>

<p>In a game tree, we record the utility value of the terminal state from the point of view of $MAX$ agent.</p>

<p>Though a game tree is well-defined and has finite amount of nodes in it, it is better thought to be a theoretical construct we can’t realize in physical world as it has too many nodes in it (the Go has $10^40$ nodes, tic-tac-toe has more than $3\times 10^5$ nodes). We usually use term <strong>search tree</strong> to represent a tree that is extracted from the full game tree, and contains enough nodes to allow a player to determine what action to make.</p>

<h3 id="52-optimal-decision-in-games">5.2 Optimal Decision in Games</h3>

<p>In an adversarial search scene, the MAX agent must find a contingent <strong>strategy</strong>. An optimal strategy leads to outcomes at least as good as other strategy when one is playing an infallible opponent.</p>

<p><img src="https://gitee.com/MarkYutianChen/mark-markdown-imagebed/raw/master/20210422204817.png" alt="image-20210422204817496"></p>

<blockquote>
  <p>In the graph above, the maximum utility at node $A$ is 3, since the MAX agent can’t change the choice of MIN agent, and in the worst situation (no matter which action MAX agent choose, MIN will always select the successor with min utility for MAX), the maximum utility at $A$ is 3, when MAX takes action $a_1$.</p>
</blockquote>

<p>In game theory, we combine a move of MAX and a move of MIN as “one move”, and call two half-moves the “ply”.</p>

<p>Given a game tree, the optimal strategy can be determined from the <strong>mini-max value</strong> of each node. The mini-max value of a node is the utility for MAX at that state assuming that <em>both players play optimally from there to the end of the game</em>.</p>

<p>$$
MINMAX(s) = \begin{cases}
Utility(s) &amp; \text{if }TERMINAL-TEST(s)<br>
max_{a\in Action(s)}{MINIMAX(RESULT(s, a))} &amp; \text{if }Player(s) = MAX<br>
min_{a\in Action(s)}{MINIMAX(RESULT(s, a))} &amp; \text{if }Player(s) = MIN<br>
\end{cases}
$$</p>

<p>The image above shows the <strong>mini-max decision</strong> at the root of game tree: action $a_1$ is the optimal choice for MAX because it leads to the state with the highest mini-max value. The mini-max decision maximize the <em>worst-case</em> outcome for MAX.</p>

<p>Other strategies may do better than the mini-max strategy when playing with suboptimal agent, but in the worst case, they are necessarily worse than the mini-max decision.</p>

<h4 id="521-mini-max-algorithm">5.2.1 Mini-max Algorithm</h4>

<p>The <strong>mini-max algorithm</strong> computes the mini-max decision from the current state. The recursion proceeds all the way down to the leaves of the tree, and then back up through the tree as the recursion call back.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">minValue</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s">"""
    return the minimum utility that can achieve from state s assuming MAX agent is playing optimally
    we assume this is the utility that MIN agent's move will result to
    """</span>
    <span class="k">if</span> <span class="n">TERMINAL_TEST</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">UTILITY</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">minVal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">'inf'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ACTION</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">minVal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minVal</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">(</span><span class="n">RESULT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">minVal</span>

<span class="k">def</span> <span class="nf">maxValue</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s">"""
    return the maximum utility that can achieve from state s assuming MIN agent is playing optimally
    we assume this is the utility that MAX agent's move will result to
    """</span>
    <span class="k">if</span> <span class="n">TERMINAL_TEST</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">UTILITY</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">maxVal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="s">'inf'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ACTION</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">maxVal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxVal</span><span class="p">,</span> <span class="n">minValue</span><span class="p">(</span><span class="n">RESULT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">maxVal</span>

<span class="k">def</span> <span class="nf">mini</span><span class="o">-</span><span class="n">maxDecision</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Action</span><span class="p">:</span>
    <span class="s">"""
    Return the action that maximize the mini-max value at s
    """</span>
    <span class="n">resAction</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">maxMinimax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="s">'inf'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ACTION</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">minValue</span><span class="p">(</span><span class="n">RESULT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">maxMinimax</span><span class="p">:</span>
            <span class="n">maxMinimax</span> <span class="o">=</span> <span class="n">minValue</span><span class="p">(</span><span class="n">RESULT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
            <span class="n">resAction</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">resAction</span>
</code></pre></div></div>

<p>Though the game we discuss is zero-sum game, <strong>alliances</strong> is still a possible choice. Collaboration may emerge from purely selfish behavior.</p>

<h3 id="53-alpha-beta-pruning">5.3 Alpha-Beta Pruning</h3>

<p>When we are using mini-max decision algorithm, we have to travel through the game tree using DFS. The node we have to explore will grow exponentially as the depth of game tree grow. Though we can’t eliminate the exponential term in time complexity, <mark>we can effectively reduce its size by applying pruning methods</mark>.</p>

<p>Here, we will apply <strong>alpha-beta pruning</strong> on the standard mini-max tree. It will return the same move as mini-max decision algorithm would and prunes away branches that can’t possibly influence the final decision.</p>

<p><img src="https://gitee.com/MarkYutianChen/mark-markdown-imagebed/raw/master/20210423095210.png" alt="image-20210423095210359"></p>

<p>The idea of alpha-beta pruning comes from a very simple observation - in some cases, we don’t need to find all successors’ utilities to calculate the mini-max value at a node. For instance, in the fig above, when we see the maximum mini-max value at $C$ is 2, we know its mini-max value must be smaller than $B$’s mini-max value (which is 3) and we can ignore the other two nodes (dash line) under $C$.</p>

<p>If Player has a better choice than $n$, $n$ will <em>never be reached in actual play</em>. Therefore, once we find enough information about $n$ to reach this conclusion, we can prune it.</p>

<p>Below shows a general case for alpha-beta pruning:</p>

<p><img src="https://gitee.com/MarkYutianChen/mark-markdown-imagebed/raw/master/20210423101148.png" alt="image-20210423101148347"></p>

<p>$\alpha=$ the mini-max value of the best choice (max-value) we have found so far at any choice point along the path for MAX</p>

<p>$\beta=$ the mini-max value of the best choice (min-value) we have found so far at any choice point along the path for MIN</p>

<p>Alpha-beta pruning update the $\alpha$ and $\beta$ as it goes along and prunes the remaining branches at a node as soon as the value of the current node is known to be worse than the current $\alpha$ or $\beta$ for MAX and MIN respectively.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">maxValue</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s">"""
    returns an integer represent the mini-max value at current state (or the last value before the node is pruned)
    """</span>
    <span class="k">if</span> <span class="n">TERMINAL_TEST</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">UTILITY</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ACTION</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span><span class="p">,</span> <span class="n">minValue</span><span class="p">(</span><span class="n">RESULT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span> <span class="o">&gt;=</span> <span class="n">beta</span><span class="p">:</span>      <span class="c1"># Since the MIN agent is optimal, this scnerio will never occur
</span>            <span class="k">return</span> <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span>       <span class="c1"># the following expansion is pruned
</span>    <span class="k">return</span> <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span>

<span class="k">def</span> <span class="nf">minValue</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s">"""
    returns an integer represent the min mini-max value at current state (or the last value before the node is pruned)
    """</span>
    <span class="k">if</span> <span class="n">TERMINAL_TEST</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">UTILITY</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ACTION</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">(</span><span class="n">RESULT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mini</span><span class="o">-</span><span class="n">maxVal</span> <span class="o">&lt;=</span> <span class="n">alpha</span><span class="p">:</span>     <span class="c1"># Since the MAX agent is optimal, the MAX agent will never reach this node (as there exist better path)
</span>            <span class="k">return</span> <span class="n">mini</span><span class="o">-</span><span class="n">maxValue</span>     <span class="c1"># the following expansion is pruned
</span>    <span class="k">return</span> <span class="n">mini</span><span class="o">-</span><span class="n">maxValue</span>
</code></pre></div></div>

<p>To start searching from the root, use <code class="language-plaintext highlighter-rouge">maxValue(root, -1 * float("inf"), float("inf"))</code></p>

<h3 id="54-backtracking">5.4 Backtracking</h3>

<p>Backtracking is a way to prune the search space. When we are searching through a search space, sometimes we can make sure the current solution is impossible when we haven’t reached the end of action sequence.</p>

<p>Suppose a game need 4 actions to make up an action sequence, we can sometimes know we will lose when playing only 2 actions yet. In this case, we can stop searching and <strong>go back to previous step</strong> and choose another action to play. (this is the reason why it is called <em>Backtracking</em>)</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/20210511000544.png" alt="image-20210511000544052"></p>

<p>The effect of backtracking will be more significant if we can identify whether it is possible or not to get to goal node from a shallower node. In such situation, much of the search space will be pruned.</p>

<p>A famous problem that can be solved by Backtracking is the “eight queens” problem. Detailed description of a more general case (n-queen problem) is in this link: <a href="https://vjudge.net/problem/UVA-11195">UVA-11195 Another n-Queen Problem</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">nQueen</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">currCol</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">currCol</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>

    <span class="n">resultState</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">isValidState</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">candidate</span><span class="p">,</span> <span class="n">currCol</span><span class="p">):</span>
            <span class="n">newState</span> <span class="o">=</span> <span class="n">state</span><span class="p">[:]</span>
            <span class="n">newState</span><span class="p">[</span><span class="n">currCol</span><span class="p">]</span> <span class="o">=</span> <span class="n">candidate</span>
            <span class="n">resultState</span> <span class="o">+=</span> <span class="n">nQueen</span><span class="p">(</span><span class="n">newState</span><span class="p">,</span> <span class="n">currCol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultState</span>

<span class="k">def</span> <span class="nf">isValidState</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">candidate</span><span class="p">,</span> <span class="n">currColumn</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>     <span class="c1"># are queens on the same row
</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">currColumn</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">position</span> <span class="o">-</span> <span class="n">candidate</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">currColumn</span> <span class="o">-</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>                    <span class="c1"># are queens on the same diagonal
</span>    <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>



    </div>

</article>
<div class="post-nav">
<a class="previous" href="/blog/2021/CS188-Chapter3.html" title="CS188 Chapter 3 Searching Methods">CS188 Chapter 3 Searching Methods</a><a class="next" href="/blog/2021/R-CNN.html" title="物体检测模型 R-CNN">物体检测模型 R-CNN</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <!-- <ul>
        
        <li><a class="post-link" href="/blog/2022/clac-embeddable.html" title="物体检测模型 R-CNN">Embeddable Clac Execution Environment</a></li><li><a class="post-link" href="/blog/2022/Attention-Mechanism.html" title="物体检测模型 R-CNN">NLP 101: Attention Mechanism</a></li><li><a class="post-link" href="/blog/2021/Word-Embedding.html" title="物体检测模型 R-CNN">NLP 101: Word Embedding 词嵌入</a></li><li><a class="post-link" href="/blog/2021/Batch-Normalization.html" title="物体检测模型 R-CNN">Batch Normalization 浅入深出</a></li></ul> -->
      
      
      
      <ul>
        
          
          
          
            <li><a class="post-link" href="/blog/2022/Multi-heuristic-Astar.html" title="物体检测模型 R-CNN">A* Search and its Variants</a></li>
            
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
            <li><a class="post-link" href="/blog/2021/Word-Embedding.html" title="物体检测模型 R-CNN">NLP 101: Word Embedding 词嵌入</a></li>
            
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
          
        
          
          
          
            <li><a class="post-link" href="/blog/2021/2048-Project-1.html" title="物体检测模型 R-CNN">2048 Project (1)</a></li>
            
          
          
        
          
          
          
          
        
          
          
          
            <li><a class="post-link" href="/blog/2021/CS188-Chapter15.html" title="物体检测模型 R-CNN">CS188 Chapter 15 Probabilistic Reasoning over Time</a></li>
            
          
          
      </ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">目录</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      if (! h.getAttribute('hide-toc')){
        menuHTML += (
          '<li class="h-' + h.tagName.toLowerCase() + '">'
          + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
        }
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
      <div>Copyright © 2019-2022 @Yutian (Mark) Chen</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/blog/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
